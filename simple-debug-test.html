<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚·ãƒ³ãƒ—ãƒ«ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ - Issue #113</title>
    <style>
        body {
            margin: 20px;
            font-family: monospace;
            background: #f0f0f0;
        }
        
        #container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
        }
        
        #log {
            margin-top: 20px;
            background: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-info { color: #0066cc; }
        .log-error { color: #cc0000; font-weight: bold; }
        .log-success { color: #006600; }
        .log-warning { color: #cc6600; }
    </style>
</head>
<body>
    <div id="container">
        <h1>ğŸ” ã‚·ãƒ³ãƒ—ãƒ«ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</h1>
        <p>GameEngineã®èª­ã¿è¾¼ã¿ãƒ»ä½œæˆã‚’ã‚¹ãƒ†ãƒƒãƒ—åˆ¥ã«ãƒ†ã‚¹ãƒˆ</p>
        
        <canvas id="gameCanvas" width="400" height="300" style="border: 2px solid #333; background: #e8f4f8;"></canvas>
        
        <div>
            <button onclick="testStep1()">Step 1: åŸºæœ¬æ©Ÿèƒ½ç¢ºèª</button>
            <button onclick="testStep2()">Step 2: GameEngineãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿</button>
            <button onclick="testStep2a()">Step 2a: ä¾å­˜é–¢ä¿‚å€‹åˆ¥ãƒã‚§ãƒƒã‚¯</button>
            <button onclick="testStep3()">Step 3: GameEngineã‚¯ãƒ©ã‚¹ä½œæˆ</button>
            <button onclick="testStep4()">Step 4: ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç¢ºèª</button>
            <button onclick="testStep5()">Step 5: ç›´æ¥ãƒ­ã‚°ãƒ†ã‚¹ãƒˆ</button>
        </div>
        
        <div id="log"></div>
    </div>

    <script type="module">
        let testGameEngine = null;
        
        // ===== ãƒ­ã‚°æ©Ÿèƒ½ =====
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const div = document.createElement('div');
            div.className = `log-${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logElement.appendChild(div);
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // ===== ãƒ†ã‚¹ãƒˆé–¢æ•° =====
        window.testStep1 = function() {
            log('=== Step 1: åŸºæœ¬æ©Ÿèƒ½ç¢ºèª ===', 'info');
            
            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°å‡ºåŠ›ãƒ†ã‚¹ãƒˆ
            console.log('TEST: é€šå¸¸ã®console.log');
            console.log('[DEBUG] DEBUGãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ãconsole.log');
            console.log('EARLY_DEBUG: EARLY_DEBUGãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ãconsole.log');
            console.log('VERY_EARLY_DEBUG: VERY_EARLY_DEBUGãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ãconsole.log');
            
            log('âœ… ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ãƒ†ã‚¹ãƒˆå®Œäº† - ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'success');
            
            // Canvasç¢ºèª
            const canvas = document.getElementById('gameCanvas');
            if (canvas && canvas.getContext('2d')) {
                log('âœ… Canvasè¦ç´ åˆ©ç”¨å¯èƒ½', 'success');
            } else {
                log('âŒ Canvasè¦ç´ ã‚¨ãƒ©ãƒ¼', 'error');
            }
        };
        
        window.testStep2 = async function() {
            log('=== Step 2: GameEngineãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ ===', 'info');
            
            try {
                log('GameEngine.jsãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’é–‹å§‹...', 'info');
                console.log('IMPORT_TEST: GameEngine.jsã‚¤ãƒ³ãƒãƒ¼ãƒˆé–‹å§‹');
                
                // ã‚ˆã‚Šè©³ç´°ãªã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒãƒ³ã‚°
                let gameEngineModule;
                try {
                    gameEngineModule = await import('./src/core/GameEngine.js');
                } catch (importError) {
                    log(`âŒ GameEngine.jsç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ${importError.message}`, 'error');
                    log(`ã‚¨ãƒ©ãƒ¼è©³ç´°: ${importError.stack}`, 'error');
                    console.error('DETAILED_IMPORT_ERROR:', importError);
                    
                    // ã‚ˆã‚Šå…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼è§£æ
                    if (importError.message.includes('Failed to resolve')) {
                        log('ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®å•é¡Œã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™', 'warning');
                    } else if (importError.message.includes('Unexpected token')) {
                        log('JavaScriptæ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™', 'warning');
                    } else if (importError.message.includes('Cannot resolve module')) {
                        log('ä¾å­˜é–¢ä¿‚ã®å•é¡Œã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™', 'warning');
                    }
                    
                    throw importError;
                }
                
                console.log('IMPORT_TEST: GameEngine.jsã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ');
                log('âœ… GameEngine.jsãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿æˆåŠŸ', 'success');
                
                if (gameEngineModule.GameEngine) {
                    log('âœ… GameEngineã‚¯ãƒ©ã‚¹ã‚’ç¢ºèª', 'success');
                    console.log('IMPORT_TEST: GameEngineã‚¯ãƒ©ã‚¹ç¢ºèªå®Œäº†');
                } else {
                    log('âŒ GameEngineã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                }
                
                // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§VERY_EARLY_DEBUGãƒ­ã‚°ã‚’ç¢ºèª
                log('ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ "VERY_EARLY_DEBUG: GameEngine.js ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿é–‹å§‹" ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'info');
                
                // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°å±¥æ­´ã‚’ç¢ºèª
                log('=== ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ç¢ºèª ===', 'info');
                
                // ãƒ–ãƒ©ã‚¦ã‚¶ã®consoleå±¥æ­´ç¢ºèªã®ãŸã‚ã€ãƒ†ã‚¹ãƒˆãƒ­ã‚°ã‚’å‡ºåŠ›
                setTimeout(() => {
                    log('ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§VERY_EARLY_DEBUGãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®åŸå› :', 'warning');
                    log('1. ES Moduleã®é™çš„è§£ææ®µéšã§ã®ã‚¨ãƒ©ãƒ¼', 'info');
                    log('2. importæ–‡ã§ã®ã‚¨ãƒ©ãƒ¼ï¼ˆcatchæ¸ˆã¿ï¼‰', 'info');  
                    log('3. ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°', 'info');
                    log('4. console.logãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã®ã‚¨ãƒ©ãƒ¼', 'info');
                }, 500);
                
            } catch (error) {
                log(`âŒ GameEngine.jsèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                log(`ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—: ${error.name}`, 'error');
                log(`ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯: ${error.stack}`, 'error');
                console.error('IMPORT_ERROR:', error);
            }
        };
        
        window.testStep2a = async function() {
            log('=== Step 2a: ä¾å­˜é–¢ä¿‚å€‹åˆ¥ãƒã‚§ãƒƒã‚¯ ===', 'info');
            
            // GameEngine.jsã®ä¸»è¦ãªä¾å­˜é–¢ä¿‚ã‚’å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆ
            const dependencies = [
                './src/core/PlayerData.js',
                './src/managers/BubbleManager.js', 
                './src/managers/ScoreManager.js',
                './src/core/StageManager.js',
                './src/core/SceneManager.js',
                './src/core/ConfigurationManager.js',
                './src/utils/ErrorHandler.js',
                './src/core/game-engine/GameEngineInitializer.js'
            ];
            
            log(`${dependencies.length}å€‹ã®ä¸»è¦ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™...`, 'info');
            
            let successCount = 0;
            let errorCount = 0;
            
            for (const dep of dependencies) {
                try {
                    log(`ãƒã‚§ãƒƒã‚¯ä¸­: ${dep}`, 'info');
                    await import(dep);
                    log(`âœ… ${dep} - OK`, 'success');
                    successCount++;
                } catch (error) {
                    log(`âŒ ${dep} - ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    console.error(`DEPENDENCY_ERROR (${dep}):`, error);
                    errorCount++;
                }
            }
            
            log('=== ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯çµæœ ===', 'info');
            log(`æˆåŠŸ: ${successCount}/${dependencies.length}`, successCount === dependencies.length ? 'success' : 'warning');
            log(`å¤±æ•—: ${errorCount}/${dependencies.length}`, errorCount === 0 ? 'success' : 'error');
            
            if (errorCount === 0) {
                log('âœ… å…¨ã¦ã®ä¸»è¦ä¾å­˜é–¢ä¿‚ãŒæ­£å¸¸ã§ã™', 'success');
            } else {
                log(`âš ï¸ ${errorCount}å€‹ã®ä¾å­˜é–¢ä¿‚ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ`, 'warning');
                log('ã“ã‚ŒãŒGameEngine.jsèª­ã¿è¾¼ã¿å¤±æ•—ã®åŸå› ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™', 'info');
            }
        };
        
        window.testStep3 = async function() {
            log('=== Step 3: GameEngineã‚¯ãƒ©ã‚¹ä½œæˆ ===', 'info');
            
            try {
                const canvas = document.getElementById('gameCanvas');
                const { GameEngine } = await import('./src/core/GameEngine.js');
                
                log('GameEngineã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼å‘¼ã³å‡ºã—é–‹å§‹...', 'info');
                console.log('CONSTRUCTOR_TEST: GameEngineã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼é–‹å§‹');
                
                // ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒç”¨ã®ãƒªã‚¹ãƒŠãƒ¼
                const originalError = console.error;
                const errors = [];
                console.error = function(...args) {
                    errors.push(args.join(' '));
                    originalError.apply(console, args);
                };
                
                try {
                    testGameEngine = new GameEngine(canvas);
                    
                    console.log('CONSTRUCTOR_TEST: GameEngineã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼å®Œäº†');
                    log('âœ… GameEngineä½œæˆæˆåŠŸ', 'success');
                    
                    // åŸºæœ¬ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
                    log(`GameEngine.canvas: ${!!testGameEngine.canvas}`, 'info');
                    log(`GameEngine.context: ${!!testGameEngine.context}`, 'info');
                    log(`GameEngine.bubbleManager: ${!!testGameEngine.bubbleManager}`, 'info');
                    
                } catch (constructorError) {
                    console.log('CONSTRUCTOR_TEST: GameEngineã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã‚¨ãƒ©ãƒ¼');
                    log(`âŒ GameEngineä½œæˆã‚¨ãƒ©ãƒ¼: ${constructorError.message}`, 'error');
                    
                    if (errors.length > 0) {
                        log('ã‚­ãƒ£ãƒƒãƒã—ãŸã‚¨ãƒ©ãƒ¼:', 'warning');
                        errors.forEach(error => log(`  - ${error}`, 'warning'));
                    }
                } finally {
                    console.error = originalError;
                }
                
                // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§DEBUGãƒ­ã‚°ã‚’ç¢ºèª
                log('ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ "[DEBUG] GameEngine:" ã§å§‹ã¾ã‚‹ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'info');
                
            } catch (error) {
                log(`âŒ å…¨ä½“ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.testStep4 = function() {
            log('=== Step 4: ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç¢ºèª ===', 'info');
            
            // å„ç¨®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ãƒ†ã‚¹ãƒˆ
            console.log('NORMAL: é€šå¸¸ãƒ­ã‚°');
            console.info('INFO: æƒ…å ±ãƒ­ã‚°');
            console.warn('WARN: è­¦å‘Šãƒ­ã‚°');
            console.error('ERROR: ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°');
            console.debug('DEBUG_LEVEL: ãƒ‡ãƒãƒƒã‚°ãƒ¬ãƒ™ãƒ«ãƒ­ã‚°');
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ããƒ­ã‚°
            console.log('[DEBUG] ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ãDEBUGãƒ­ã‚°');
            console.log('EARLY_DEBUG: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ãEARLY_DEBUGãƒ­ã‚°');
            console.log('VERY_EARLY_DEBUG: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ãVERY_EARLY_DEBUGãƒ­ã‚°');
            
            log('âœ… å„ç¨®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
            log('ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„:', 'info');
            log('- Chrome: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¿ãƒ–ã®å³ä¸Šã®è¨­å®šã‚¢ã‚¤ã‚³ãƒ³', 'info');
            log('- ã€Œãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã€ã§è¡¨ç¤ºé …ç›®ã‚’èª¿æ•´å¯èƒ½', 'info');
        };
        
        window.testStep5 = async function() {
            log('=== Step 5: ç›´æ¥ãƒ­ã‚°ãƒ†ã‚¹ãƒˆ ===', 'info');
            
            // GameEngine.jsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥èª­ã¿è¾¼ã‚“ã§ã€console.logãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‹ãƒ†ã‚¹ãƒˆ
            try {
                log('ç›´æ¥çš„ãªãƒ­ã‚°ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...', 'info');
                
                // ä¸€æ™‚çš„ã«console.logã‚’ãƒ•ãƒƒã‚¯ã—ã¦ç¢ºèª
                const originalConsoleLog = console.log;
                const capturedLogs = [];
                
                console.log = function(...args) {
                    const message = args.join(' ');
                    capturedLogs.push(message);
                    originalConsoleLog.apply(console, args);
                };
                
                // GameEngine.jsã‚’å†åº¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ãŒã€ãƒ­ã‚°ã‚­ãƒ£ãƒ—ãƒãƒ£ã®ãŸã‚ï¼‰
                log('GameEngine.jsã‚’å†ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãƒ­ã‚°ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£...', 'info');
                
                // æ–°ã—ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¿ã‚°ã§ç›´æ¥èª­ã¿è¾¼ã‚€æ–¹æ³•ã‚’ãƒ†ã‚¹ãƒˆ
                const script = document.createElement('script');
                script.type = 'module';
                script.textContent = `
                    console.log('DIRECT_TEST: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã‹ã‚‰ç›´æ¥ãƒ­ã‚°');
                    import('./src/core/GameEngine.js').then(() => {
                        console.log('DIRECT_TEST: GameEngine.jsã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†å¾Œ');
                    }).catch(error => {
                        console.error('DIRECT_TEST: GameEngine.jsã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼', error);
                    });
                `;
                
                document.head.appendChild(script);
                
                setTimeout(() => {
                    console.log = originalConsoleLog;
                    
                    log('=== ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸãƒ­ã‚° ===', 'info');
                    if (capturedLogs.length > 0) {
                        capturedLogs.forEach(capturedLog => {
                            if (capturedLog.includes('VERY_EARLY_DEBUG') || capturedLog.includes('DEBUG') || capturedLog.includes('DIRECT_TEST')) {
                                log(`ã‚­ãƒ£ãƒƒãƒ: ${capturedLog}`, 'success');
                            }
                        });
                    } else {
                        log('ãƒ­ã‚°ãŒã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ', 'warning');
                    }
                    
                    // ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¿ã‚°ã‚’å‰Šé™¤
                    document.head.removeChild(script);
                }, 1000);
                
            } catch (error) {
                log(`âŒ ç›´æ¥ãƒ­ã‚°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        // ===== åˆæœŸåŒ– =====
        log('ã‚·ãƒ³ãƒ—ãƒ«ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†', 'info');
        log('Step 1ã‹ã‚‰é †ç•ªã«å®Ÿè¡Œã—ã¦ãã ã•ã„', 'info');
    </script>
</body>
</html>