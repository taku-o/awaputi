<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ®‹å­˜ã‚¨ãƒ©ãƒ¼è¨ºæ–­</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .log-container {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 14px;
        }
        .error { color: red; font-weight: bold; }
        .success { color: green; }
        .info { color: blue; }
        .warning { color: orange; }
        .step { margin: 10px 0; padding: 10px; background: #f9f9f9; border-left: 3px solid #007cba; }
        .code-snippet { 
            background: #f8f8f8; 
            padding: 10px; 
            border-radius: 4px; 
            margin: 5px 0; 
            font-family: monospace; 
            font-size: 12px; 
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>æ®‹å­˜ã‚¨ãƒ©ãƒ¼è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="step">
        <h3>ğŸ” è¨ºæ–­ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
        <button onclick="analyzePerformanceOptimizer()">PerformanceOptimizeråˆ†æ</button>
        <button onclick="analyzeAudioManager()">AudioManageråˆ†æ</button>
        <button onclick="testConfigurationPaths()">è¨­å®šãƒ‘ã‚¹æ¤œè¨¼</button>
        <button onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>
    
    <div class="log-container" id="logs">
        <div>æ®‹å­˜ã‚¨ãƒ©ãƒ¼è¨ºæ–­ãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†ã€‚</div>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.createElement('div');
            logElement.className = type;
            logElement.textContent = `[${timestamp}] ${message}`;
            document.getElementById('logs').appendChild(logElement);
            console.log(message);
            
            const container = document.getElementById('logs');
            container.scrollTop = container.scrollHeight;
        }

        function logCode(code, description = 'ã‚³ãƒ¼ãƒ‰') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.createElement('div');
            logElement.innerHTML = `<strong>[${timestamp}] ${description}:</strong><div class="code-snippet">${code}</div>`;
            document.getElementById('logs').appendChild(logElement);
            
            const container = document.getElementById('logs');
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '<div>ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†</div>';
        }

        // PerformanceOptimizeråˆ†æ
        async function analyzePerformanceOptimizer() {
            log('ğŸ§ª PerformanceOptimizeråˆ†æé–‹å§‹');
            
            try {
                log('ğŸ”„ PerformanceOptimizer.jsèª­ã¿è¾¼ã¿ä¸­...');
                const response = await fetch(`./src/utils/PerformanceOptimizer.js?t=${Date.now()}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const content = await response.text();
                log(`âœ… PerformanceOptimizer.jsèª­ã¿è¾¼ã¿æˆåŠŸ (${content.length} æ–‡å­—)`, 'success');
                
                // targetFPSé–¢é€£ã®ã‚³ãƒ¼ãƒ‰ã‚’æ¤œç´¢
                log('ğŸ” targetFPSé–¢é€£ã‚³ãƒ¼ãƒ‰æ¤œç´¢ä¸­...');
                const lines = content.split('\n');
                const targetFPSLines = lines.filter((line, index) => {
                    const trimmed = line.trim();
                    return trimmed.includes('targetFPS') && !trimmed.startsWith('//');
                }).slice(0, 10); // æœ€åˆã®10ä»¶
                
                if (targetFPSLines.length > 0) {
                    log(`ğŸ“‹ targetFPSé–¢é€£ã‚³ãƒ¼ãƒ‰ (${targetFPSLines.length}ä»¶ç™ºè¦‹):`);
                    targetFPSLines.forEach((line, index) => {
                        logCode(line.trim(), `targetFPS ã‚³ãƒ¼ãƒ‰ ${index + 1}`);
                    });
                } else {
                    log('âŒ targetFPSé–¢é€£ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                }
                
                // ConfigurationManagerä½¿ç”¨ç®‡æ‰€ã‚’æ¤œç´¢
                log('ğŸ” ConfigurationManagerä½¿ç”¨ç®‡æ‰€æ¤œç´¢ä¸­...');
                const configLines = lines.filter((line, index) => {
                    const trimmed = line.trim();
                    return (trimmed.includes('configManager') || trimmed.includes('getConfigurationManager')) 
                           && !trimmed.startsWith('//');
                }).slice(0, 5);
                
                if (configLines.length > 0) {
                    log(`ğŸ“‹ ConfigurationManagerä½¿ç”¨ç®‡æ‰€ (${configLines.length}ä»¶ç™ºè¦‹):`);
                    configLines.forEach((line, index) => {
                        logCode(line.trim(), `Configä½¿ç”¨ ${index + 1}`);
                    });
                } else {
                    log('âŒ ConfigurationManagerä½¿ç”¨ç®‡æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                }
                
            } catch (error) {
                log(`âŒ PerformanceOptimizeråˆ†æå¤±æ•—: ${error.message}`, 'error');
                console.error('PerformanceOptimizer analysis error:', error);
            }
        }

        // AudioManageråˆ†æ
        async function analyzeAudioManager() {
            log('ğŸ§ª AudioManageråˆ†æé–‹å§‹');
            
            try {
                log('ğŸ”„ AudioManager.jsèª­ã¿è¾¼ã¿ä¸­...');
                const response = await fetch(`./src/audio/AudioManager.js?t=${Date.now()}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const content = await response.text();
                log(`âœ… AudioManager.jsèª­ã¿è¾¼ã¿æˆåŠŸ (${content.length} æ–‡å­—)`, 'success');
                
                // renderé–¢é€£ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ¤œç´¢
                log('ğŸ” renderé–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰æ¤œç´¢ä¸­...');
                const renderMatches = content.match(/render\s*\([^)]*\)\s*{[^}]*}/g) || [];
                
                if (renderMatches.length > 0) {
                    log(`ğŸ“‹ renderãƒ¡ã‚½ãƒƒãƒ‰ (${renderMatches.length}ä»¶ç™ºè¦‹):`);
                    renderMatches.forEach((match, index) => {
                        logCode(match, `render ãƒ¡ã‚½ãƒƒãƒ‰ ${index + 1}`);
                    });
                } else {
                    log('âŒ renderãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'warning');
                }
                
                // ã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã—ã¦ã„ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ç®‡æ‰€ã‚’æ¤œç´¢
                const suspiciousPatterns = [
                    /\.render\(/g,
                    /render\s*:/g,
                    /render\s*=/g
                ];
                
                suspiciousPatterns.forEach((pattern, index) => {
                    const matches = content.match(pattern) || [];
                    if (matches.length > 0) {
                        log(`ğŸ” renderé–¢é€£ãƒ‘ã‚¿ãƒ¼ãƒ³ ${index + 1}: ${matches.length}ä»¶ç™ºè¦‹`);
                        
                        // ã‚ˆã‚Šè©³ç´°ãªè¡Œã‚’ç‰¹å®š
                        const lines = content.split('\n');
                        const matchingLines = lines.filter(line => pattern.test(line));
                        matchingLines.slice(0, 3).forEach((line, lineIndex) => {
                            logCode(line.trim(), `ãƒ‘ã‚¿ãƒ¼ãƒ³${index + 1} è¡Œ${lineIndex + 1}`);
                        });
                    }
                });
                
            } catch (error) {
                log(`âŒ AudioManageråˆ†æå¤±æ•—: ${error.message}`, 'error');
                console.error('AudioManager analysis error:', error);
            }
        }

        // è¨­å®šãƒ‘ã‚¹æ¤œè¨¼
        async function testConfigurationPaths() {
            log('ğŸ§ª è¨­å®šãƒ‘ã‚¹æ¤œè¨¼é–‹å§‹');
            
            try {
                log('ğŸ”„ ConfigurationManagerå‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ...');
                const configModule = await import(`./src/core/ConfigurationManager.js?t=${Date.now()}`);
                const configManager = configModule.getConfigurationManager();
                log('âœ… ConfigurationManagerå–å¾—æˆåŠŸ', 'success');
                
                // å•é¡Œã¨ãªã£ã¦ã„ã‚‹è¨­å®šãƒ‘ã‚¹ã‚’ãƒ†ã‚¹ãƒˆ
                const testPaths = [
                    { category: 'performance', key: 'targetFPS', description: 'Performance Target FPS' },
                    { category: 'performance', key: 'optimization.targetFPS', description: 'Performance Optimization Target FPS' },
                    { category: 'effects', key: 'quality.level', description: 'Effects Quality Level' },
                    { category: 'effects', key: 'quality.autoAdjust', description: 'Effects Quality Auto Adjust' },
                    { category: 'audio', key: 'volumes.master', description: 'Audio Master Volume' }
                ];
                
                log('ğŸ” è¨­å®šå€¤æ¤œè¨¼ä¸­...');
                for (const testPath of testPaths) {
                    try {
                        const value = configManager.get(testPath.category, testPath.key);
                        const status = value !== undefined ? 'âœ…' : 'âŒ';
                        log(`${status} ${testPath.description}: ${value}`, value !== undefined ? 'success' : 'error');
                    } catch (error) {
                        log(`âŒ ${testPath.description} ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    }
                }
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å­˜åœ¨ç¢ºèª
                log('ğŸ” ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ç¢ºèªä¸­...');
                if (configManager.defaultValues) {
                    const defaultKeys = Array.from(configManager.defaultValues.keys()).slice(0, 10);
                    log(`ğŸ“‹ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚­ãƒ¼ (æœ€åˆã®10ä»¶):`);
                    defaultKeys.forEach(key => {
                        const value = configManager.defaultValues.get(key);
                        logCode(`${key} = ${JSON.stringify(value)}`, 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤');
                    });
                } else {
                    log('âŒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤Mapã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“', 'error');
                }
                
            } catch (error) {
                log(`âŒ è¨­å®šãƒ‘ã‚¹æ¤œè¨¼å¤±æ•—: ${error.message}`, 'error');
                console.error('Configuration path test error:', error);
            }
        }

        // åˆæœŸå®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ æ®‹å­˜ã‚¨ãƒ©ãƒ¼è¨ºæ–­ãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†');
        });
    </script>
</body>
</html>