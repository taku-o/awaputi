<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€çµ‚ä¿®æ­£ç¢ºèª</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .log-container {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.4;
        }
        .error { color: red; font-weight: bold; }
        .success { color: green; }
        .info { color: blue; }
        .warning { color: orange; }
        .step { margin: 10px 0; padding: 10px; background: #f9f9f9; border-left: 3px solid #007cba; }
        .code-snippet { background: #f8f8f8; padding: 10px; border-radius: 4px; margin: 5px 0; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>æœ€çµ‚ä¿®æ­£ç¢ºèªãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="step">
        <h3>ğŸ” ãƒ†ã‚¹ãƒˆ</h3>
        <button onclick="testMainJsContent()">main.jsè©³ç´°å†…å®¹ç¢ºèª</button>
        <button onclick="testConfigurationManager()">ConfigurationManagerå‹•ä½œç¢ºèª</button>
        <button onclick="testGameEngineImport()">GameEngineå‹•ä½œç¢ºèª</button>
        <button onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>
    
    <div class="log-container" id="logs">
        <div>æœ€çµ‚ä¿®æ­£ç¢ºèªãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†ã€‚</div>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.createElement('div');
            logElement.className = type;
            logElement.textContent = `[${timestamp}] ${message}`;
            document.getElementById('logs').appendChild(logElement);
            console.log(message);
            
            // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            const container = document.getElementById('logs');
            container.scrollTop = container.scrollHeight;
        }

        function logCode(code, description = 'ã‚³ãƒ¼ãƒ‰') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.createElement('div');
            logElement.innerHTML = `<strong>[${timestamp}] ${description}:</strong><div class="code-snippet">${code}</div>`;
            document.getElementById('logs').appendChild(logElement);
            
            // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            const container = document.getElementById('logs');
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '<div>ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†</div>';
        }

        // main.jsã®è©³ç´°å†…å®¹ç¢ºèª
        async function testMainJsContent() {
            log('ğŸ§ª main.jsè©³ç´°å†…å®¹ç¢ºèªé–‹å§‹');
            
            try {
                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¿½åŠ 
                const timestamp = Date.now();
                log('ğŸ”„ main.jsèª­ã¿è¾¼ã¿ä¸­ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ï¼‰...');
                const response = await fetch(`./src/main.js?t=${timestamp}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const content = await response.text();
                log(`âœ… main.jsèª­ã¿è¾¼ã¿æˆåŠŸ (${content.length} æ–‡å­—)`, 'success');
                
                // ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡ã®ç¢ºèª
                log('ğŸ“¦ ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡ç¢ºèªä¸­...');
                const imports = content.match(/^import.*$/gm) || [];
                for (const imp of imports) {
                    if (imp.includes('getConfigurationManager')) {
                        log(`âœ… ConfigurationManagerã‚¤ãƒ³ãƒãƒ¼ãƒˆç™ºè¦‹`, 'success');
                        logCode(imp.trim(), 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡');
                    } else if (imp.includes('GameEngine')) {
                        log(`âœ… GameEngineã‚¤ãƒ³ãƒãƒ¼ãƒˆç™ºè¦‹`, 'success');
                        logCode(imp.trim(), 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡');
                    }
                }
                
                // åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ã®ç¢ºèª
                log('ğŸ”§ åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ç¢ºèªä¸­...');
                const initLines = content.split('\n').filter((line, index) => {
                    const trimmed = line.trim();
                    return trimmed.includes('ã‚¹ãƒ†ãƒƒãƒ—') || 
                           trimmed.includes('ConfigurationManager') ||
                           trimmed.includes('GameEngine') ||
                           trimmed.includes('getConfigurationManager()');
                });
                
                log(`ğŸ“‹ é‡è¦ãªåˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ï¼ˆ${initLines.length}è¡Œè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼‰:`);
                initLines.forEach((line, index) => {
                    logCode(line.trim(), `åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ ${index + 1}`);
                });
                
                // å…·ä½“çš„ãªä¿®æ­£é …ç›®ãƒã‚§ãƒƒã‚¯
                const checks = {
                    'getConfigurationManagerã‚¤ãƒ³ãƒãƒ¼ãƒˆ': /import.*getConfigurationManager.*from/,
                    'getConfigurationManagerå‘¼ã³å‡ºã—': /getConfigurationManager\(\)/,
                    'ã‚¹ãƒ†ãƒƒãƒ—2ConfigurationManager': /ã‚¹ãƒ†ãƒƒãƒ—2.*ConfigurationManager.*åˆæœŸåŒ–/,
                    'ã‚¹ãƒ†ãƒƒãƒ—3GameEngine': /ã‚¹ãƒ†ãƒƒãƒ—3.*ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³.*åˆæœŸåŒ–/,
                    'LoadingManagerã‚¹ãƒ†ãƒƒãƒ—é…åˆ—': /è¨­å®šã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­/
                };
                
                log('âœ… è©³ç´°ä¿®æ­£ãƒã‚§ãƒƒã‚¯çµæœ:');
                Object.entries(checks).forEach(([checkName, regex]) => {
                    const found = regex.test(content);
                    log(`  ${checkName}: ${found ? 'âœ… ç™ºè¦‹' : 'âŒ æœªç™ºè¦‹'}`, found ? 'success' : 'error');
                    
                    if (found) {
                        const match = content.match(regex);
                        if (match) {
                            logCode(match[0], `${checkName} ãƒãƒƒãƒéƒ¨åˆ†`);
                        }
                    }
                });
                
            } catch (error) {
                log(`âŒ main.jså†…å®¹ç¢ºèªå¤±æ•—: ${error.message}`, 'error');
                console.error('Main.js content check error:', error);
            }
        }

        // ConfigurationManagerå‹•ä½œç¢ºèª
        async function testConfigurationManager() {
            log('ğŸ§ª ConfigurationManagerå‹•ä½œç¢ºèªé–‹å§‹');
            
            try {
                log('ğŸ”„ ConfigurationManagerå‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...');
                const configModule = await import(`./src/core/ConfigurationManager.js?t=${Date.now()}`);
                log('âœ… ConfigurationManagerã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ', 'success');
                
                if (configModule.getConfigurationManager) {
                    log('âœ… getConfigurationManageré–¢æ•°å­˜åœ¨ç¢ºèª', 'success');
                    
                    const configManager = configModule.getConfigurationManager();
                    log('âœ… ConfigurationManagerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å–å¾—æˆåŠŸ', 'success');
                    
                    // APIãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª
                    const methods = ['get', 'set', 'has', 'reset'];
                    methods.forEach(method => {
                        if (typeof configManager[method] === 'function') {
                            log(`âœ… ${method}ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª`, 'success');
                        } else {
                            log(`âŒ ${method}ãƒ¡ã‚½ãƒƒãƒ‰ä¸åœ¨`, 'error');
                        }
                    });
                    
                    // é‡è¦è¨­å®šå€¤ã®ãƒ†ã‚¹ãƒˆ
                    const testConfigs = [
                        { category: 'performance', key: 'targetFPS', expected: 60 },
                        { category: 'performance', key: 'optimization.targetFPS', expected: 60 }
                    ];
                    
                    for (const config of testConfigs) {
                        try {
                            const value = configManager.get(config.category, config.key);
                            const isCorrect = value === config.expected;
                            log(`${isCorrect ? 'âœ…' : 'âš ï¸'} ${config.category}.${config.key} = ${value} (æœŸå¾…å€¤: ${config.expected})`, isCorrect ? 'success' : 'warning');
                        } catch (error) {
                            log(`âŒ ${config.category}.${config.key} å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                        }
                    }
                    
                } else {
                    log('âŒ getConfigurationManageré–¢æ•°ãŒå­˜åœ¨ã—ã¾ã›ã‚“', 'error');
                }
                
            } catch (error) {
                log(`âŒ ConfigurationManagerå‹•ä½œç¢ºèªå¤±æ•—: ${error.message}`, 'error');
                console.error('ConfigurationManager test error:', error);
            }
        }

        // GameEngineå‹•ä½œç¢ºèª
        async function testGameEngineImport() {
            log('ğŸ§ª GameEngineå‹•ä½œç¢ºèªé–‹å§‹');
            
            try {
                log('ğŸ”„ GameEngineå‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...');
                const gameEngineModule = await import(`./src/core/GameEngine.js?t=${Date.now()}`);
                log('âœ… GameEngineã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ', 'success');
                
                if (gameEngineModule.GameEngine) {
                    log('âœ… GameEngineã‚¯ãƒ©ã‚¹å­˜åœ¨ç¢ºèª', 'success');
                    
                    // ãƒ†ã‚¹ãƒˆç”¨Canvasè¦ç´ ä½œæˆ
                    const testCanvas = document.createElement('canvas');
                    testCanvas.width = 800;
                    testCanvas.height = 600;
                    
                    log('ğŸ”„ GameEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆãƒ†ã‚¹ãƒˆ...');
                    
                    try {
                        const gameEngine = new gameEngineModule.GameEngine(testCanvas);
                        log('âœ… GameEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ', 'success');
                        
                        // åŸºæœ¬ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
                        const props = ['canvas', 'context', 'isRunning'];
                        props.forEach(prop => {
                            if (gameEngine[prop] !== undefined) {
                                log(`âœ… ${prop}ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª`, 'success');
                            } else {
                                log(`âŒ ${prop}ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸åœ¨`, 'error');
                            }
                        });
                        
                        // configManagerãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
                        if (gameEngine.configManager) {
                            log('âœ… GameEngine.configManagerãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª', 'success');
                        } else {
                            log('âŒ GameEngine.configManagerãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸åœ¨', 'error');
                        }
                        
                    } catch (error) {
                        log(`âŒ GameEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆå¤±æ•—: ${error.message}`, 'error');
                        console.error('GameEngine instantiation error:', error);
                    }
                    
                } else {
                    log('âŒ GameEngineã‚¯ãƒ©ã‚¹ãŒå­˜åœ¨ã—ã¾ã›ã‚“', 'error');
                }
                
            } catch (error) {
                log(`âŒ GameEngineå‹•ä½œç¢ºèªå¤±æ•—: ${error.message}`, 'error');
                console.error('GameEngine test error:', error);
            }
        }

        // åˆæœŸå®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ æœ€çµ‚ä¿®æ­£ç¢ºèªãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†');
            
            // è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            setTimeout(() => {
                testMainJsContent();
            }, 500);
        });
    </script>
</body>
</html>