<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ–ãƒ«ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        
        h1 {
            color: #f39c12;
            margin-bottom: 20px;
        }
        
        canvas {
            border: 3px solid #f39c12;
            background: #1a1a2e;
            border-radius: 10px;
            margin: 20px 0;
            display: block;
            margin-left: auto;
            margin-right: auto;
            cursor: crosshair;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            background: #f39c12;
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        button:hover {
            background: #e67e22;
            transform: scale(1.05);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        #info {
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 600px;
            font-size: 18px;
        }
        
        .score {
            color: #f39c12;
            font-weight: bold;
        }
        
        .status-running {
            color: #27ae60;
        }
        
        .status-stopped {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <h1>ğŸ«§ ãƒãƒ–ãƒ«ã‚²ãƒ¼ãƒ </h1>
    
    <div class="controls">
        <button onclick="startGame()">ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹</button>
        <button onclick="spawnBubbles()">ğŸ«§ ãƒãƒ–ãƒ«ç”Ÿæˆ</button>
        <button onclick="clearAll()">ğŸ—‘ï¸ ãƒªã‚»ãƒƒãƒˆ</button>
        <button onclick="toggleAutoSpawn()">âš¡ è‡ªå‹•ç”Ÿæˆ</button>
    </div>
    
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    
    <div id="info">
        <div>ã‚¹ã‚³ã‚¢: <span id="score" class="score">0</span></div>
        <div>ãƒãƒ–ãƒ«æ•°: <span id="bubbleCount">0</span></div>
        <div>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span id="status" class="status-stopped">åœæ­¢ä¸­</span></div>
        <div>è‡ªå‹•ç”Ÿæˆ: <span id="autoSpawnStatus">OFF</span></div>
    </div>
    
    <p style="margin-top: 30px; opacity: 0.8;">
        ğŸ’¡ ãƒãƒ–ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ï¼<br>
        ğŸ¯ å¤§ããªãƒãƒ–ãƒ«ã»ã©é«˜å¾—ç‚¹ï¼
    </p>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        var canvas, ctx;
        var bubbles = [];
        var score = 0;
        var isGameRunning = false;
        var isAutoSpawn = false;
        var animationId;
        var lastSpawnTime = 0;
        
        // ãƒãƒ–ãƒ«ã‚¯ãƒ©ã‚¹
        function Bubble(x, y, radius, color, speedX, speedY, points) {
            this.x = x;
            this.y = y;
            this.radius = radius;
            this.color = color;
            this.speedX = speedX;
            this.speedY = speedY;
            this.alpha = 1.0;
            this.points = points;
            this.rotation = 0;
            this.rotationSpeed = (Math.random() - 0.5) * 0.1;
        }
        
        Bubble.prototype.update = function() {
            this.x += this.speedX;
            this.y += this.speedY;
            this.rotation += this.rotationSpeed;
            
            // é‡åŠ›åŠ¹æœ
            this.speedY += 0.1;
            
            // å£ã§ã®åå°„
            if (this.x - this.radius <= 0 || this.x + this.radius >= canvas.width) {
                this.speedX *= -0.7;
                this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
            }
            if (this.y - this.radius <= 0 || this.y + this.radius >= canvas.height) {
                this.speedY *= -0.7;
                this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));
            }
            
            // æ‘©æ“¦
            this.speedX *= 0.999;
            this.speedY *= 0.999;
            
            // å¾ã€…ã«é€æ˜ã«ãªã‚‹
            this.alpha *= 0.9995;
        };
        
        Bubble.prototype.draw = function() {
            ctx.save();
            ctx.globalAlpha = this.alpha;
            ctx.translate(this.x, this.y);
            ctx.rotate(this.rotation);
            
            // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            var gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.radius);
            gradient.addColorStop(0, this.color);
            gradient.addColorStop(0.7, this.color + '80');
            gradient.addColorStop(1, this.color + '20');
            
            ctx.beginPath();
            ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            ctx.beginPath();
            ctx.arc(-this.radius * 0.3, -this.radius * 0.3, this.radius * 0.3, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.fill();
            
            // å¢ƒç•Œç·š
            ctx.beginPath();
            ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.restore();
        };
        
        Bubble.prototype.isClicked = function(mouseX, mouseY) {
            var distance = Math.sqrt((mouseX - this.x) * (mouseX - this.x) + (mouseY - this.y) * (mouseY - this.y));
            return distance <= this.radius;
        };
        
        // åˆæœŸåŒ–
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            canvas.addEventListener('click', onCanvasClick);
            
            updateInfo();
            console.log('ã‚²ãƒ¼ãƒ åˆæœŸåŒ–å®Œäº†');
        }
        
        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            isGameRunning = !isGameRunning;
            if (isGameRunning) {
                gameLoop();
                console.log('ã‚²ãƒ¼ãƒ é–‹å§‹');
            } else {
                cancelAnimationFrame(animationId);
                console.log('ã‚²ãƒ¼ãƒ åœæ­¢');
            }
            updateInfo();
        }
        
        // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
        function gameLoop() {
            if (!isGameRunning) return;
            
            var currentTime = Date.now();
            
            // è‡ªå‹•ãƒãƒ–ãƒ«ç”Ÿæˆ
            if (isAutoSpawn && currentTime - lastSpawnTime > 2000) {
                spawnRandomBubble();
                lastSpawnTime = currentTime;
            }
            
            // èƒŒæ™¯ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ãƒãƒ–ãƒ«æ›´æ–°ã¨æç”»
            bubbles = bubbles.filter(function(bubble) {
                bubble.update();
                bubble.draw();
                return bubble.alpha > 0.1; // é€æ˜åº¦ãŒä½ããªã£ãŸã‚‰å‰Šé™¤
            });
            
            updateInfo();
            animationId = requestAnimationFrame(gameLoop);
        }
        
        // ãƒãƒ–ãƒ«ç”Ÿæˆ
        function spawnBubbles() {
            var colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#FF8A80', '#82B1FF'];
            
            for (var i = 0; i < 3; i++) {
                spawnRandomBubble();
            }
            
            if (!isGameRunning) {
                drawStaticFrame();
            }
            
            updateInfo();
            console.log('ãƒãƒ–ãƒ«ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚ç¾åœ¨ã®ãƒãƒ–ãƒ«æ•°: ' + bubbles.length);
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒ–ãƒ«ç”Ÿæˆ
        function spawnRandomBubble() {
            var colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
            var x = 50 + Math.random() * (canvas.width - 100);
            var y = 50 + Math.random() * (canvas.height - 200);
            var radius = 15 + Math.random() * 40;
            var color = colors[Math.floor(Math.random() * colors.length)];
            var speedX = (Math.random() - 0.5) * 6;
            var speedY = (Math.random() - 0.5) * 6;
            var points = Math.floor(radius / 5);
            
            bubbles.push(new Bubble(x, y, radius, color, speedX, speedY, points));
        }
        
        // é™çš„ãƒ•ãƒ¬ãƒ¼ãƒ æç”»
        function drawStaticFrame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            bubbles.forEach(function(bubble) {
                bubble.draw();
            });
        }
        
        // å…¨ã‚¯ãƒªã‚¢
        function clearAll() {
            bubbles = [];
            score = 0;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            updateInfo();
            console.log('ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }
        
        // è‡ªå‹•ç”Ÿæˆåˆ‡ã‚Šæ›¿ãˆ
        function toggleAutoSpawn() {
            isAutoSpawn = !isAutoSpawn;
            updateInfo();
            console.log('è‡ªå‹•ç”Ÿæˆ: ' + (isAutoSpawn ? 'ON' : 'OFF'));
        }
        
        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function onCanvasClick(event) {
            var rect = canvas.getBoundingClientRect();
            var mouseX = event.clientX - rect.left;
            var mouseY = event.clientY - rect.top;
            
            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒãƒ–ãƒ«ã‚’æ¢ã™ï¼ˆå¾Œã‚ã‹ã‚‰æ¤œç´¢ã§æ‰‹å‰ã®ãƒãƒ–ãƒ«ã‚’å„ªå…ˆï¼‰
            for (var i = bubbles.length - 1; i >= 0; i--) {
                if (bubbles[i].isClicked(mouseX, mouseY)) {
                    score += bubbles[i].points;
                    
                    // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœï¼ˆç°¡æ˜“ç‰ˆï¼‰
                    createClickEffect(bubbles[i].x, bubbles[i].y, bubbles[i].color);
                    
                    bubbles.splice(i, 1);
                    updateInfo();
                    console.log('ãƒãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ï¼ ã‚¹ã‚³ã‚¢: ' + score);
                    break;
                }
            }
        }
        
        // ã‚¯ãƒªãƒƒã‚¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function createClickEffect(x, y, color) {
            for (var i = 0; i < 5; i++) {
                var angle = (i / 5) * Math.PI * 2;
                var speed = 3 + Math.random() * 3;
                var vx = Math.cos(angle) * speed;
                var vy = Math.sin(angle) * speed;
                var effectBubble = new Bubble(x, y, 5 + Math.random() * 10, color, vx, vy, 0);
                effectBubble.alpha = 0.7;
                bubbles.push(effectBubble);
            }
        }
        
        // æƒ…å ±æ›´æ–°
        function updateInfo() {
            document.getElementById('score').textContent = score;
            document.getElementById('bubbleCount').textContent = bubbles.length;
            
            var statusElement = document.getElementById('status');
            if (isGameRunning) {
                statusElement.textContent = 'å®Ÿè¡Œä¸­';
                statusElement.className = 'status-running';
            } else {
                statusElement.textContent = 'åœæ­¢ä¸­';
                statusElement.className = 'status-stopped';
            }
            
            document.getElementById('autoSpawnStatus').textContent = isAutoSpawn ? 'ON' : 'OFF';
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>