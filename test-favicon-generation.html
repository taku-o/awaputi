<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favicon Generation Test - BubblePop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .button:hover {
            background: #45a049;
        }
        .button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .favicon-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .favicon-item {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            background: white;
        }
        .favicon-item img {
            max-width: 48px;
            max-height: 48px;
            margin-bottom: 5px;
        }
        .favicon-info {
            font-size: 12px;
            color: #666;
        }
        .category-header {
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 5px;
            margin: 20px 0 10px 0;
        }
        .progress {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            border: 1px solid #ffcdd2;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            color: #388e3c;
            background: #e8f5e8;
            border: 1px solid #c8e6c9;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>BubblePop - Favicon Generation Tool</h1>
        <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€BubblePopã‚²ãƒ¼ãƒ ç”¨ã®åŒ…æ‹¬çš„ãªãƒ•ã‚¡ãƒ“ã‚³ãƒ³ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆã§ãã¾ã™ã€‚</p>
        
        <div class="controls">
            <button class="button" onclick="generateAllFavicons()">ğŸ¨ å…¨ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ç”Ÿæˆ</button>
            <button class="button" onclick="generateFaviconPreview()">ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ</button>
            <button class="button" onclick="downloadFavicons()" id="downloadBtn" disabled>ğŸ’¾ ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            <button class="button" onclick="clearOutput()">ğŸ—‘ï¸ å‡ºåŠ›ã‚¯ãƒªã‚¢</button>
        </div>
        
        <div class="progress" id="progressContainer" style="display: none;">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="output" id="output">ã“ã“ã«å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™...</div>
    </div>
    
    <div class="container" id="previewContainer" style="display: none;">
        <h2>ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
        <div id="faviconPreview" class="favicon-preview"></div>
    </div>
    
    <div class="container">
        <h2>ã‚«ãƒ†ã‚´ãƒªåˆ¥ç”Ÿæˆ</h2>
        <button class="button" onclick="generateCategory('standard')">ğŸ  æ¨™æº–ãƒ•ã‚¡ãƒ“ã‚³ãƒ³</button>
        <button class="button" onclick="generateCategory('apple')">ğŸ Apple Touch Icons</button>
        <button class="button" onclick="generateCategory('android')">ğŸ¤– Android Chrome</button>
        <button class="button" onclick="generateCategory('microsoft')">ğŸ–¥ï¸ Microsoft Tiles</button>
        <button class="button" onclick="generateCategory('safari')">ğŸ§­ Safari</button>
        <button class="button" onclick="generateCategory('iosLegacy')">ğŸ“± iOS Legacy</button>
    </div>
    
    <div class="container">
        <h2>ãƒ„ãƒ¼ãƒ«æƒ…å ±</h2>
        <p><strong>ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ãƒ“ã‚³ãƒ³:</strong></p>
        <ul>
            <li><strong>æ¨™æº–:</strong> favicon.ico, favicon.svg, PNG (16x16, 32x32, 48x48)</li>
            <li><strong>Apple:</strong> Apple Touch Icons (57x57 ~ 180x180)</li>
            <li><strong>Android:</strong> Chrome Icons (36x36 ~ 512x512)</li>
            <li><strong>Microsoft:</strong> Windows Tiles (70x70 ~ 310x310)</li>
            <li><strong>Safari:</strong> safari-pinned-tab.svg</li>
            <li><strong>iOS Legacy:</strong> precomposed versions</li>
        </ul>
        
        <p><strong>æ³¨æ„:</strong> ãƒ–ãƒ©ã‚¦ã‚¶ãŒFile System Access APIã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ä¿å­˜ã§ãã¾ã™ã€‚ãã†ã§ãªã„å ´åˆã¯ã€å€‹åˆ¥ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚</p>
    </div>

    <script type="module">
        import { FaviconManager } from './src/seo/FaviconManager.js';
        import { 
            generateAllFavicons as generateAllFaviconsScript,
            generateFaviconCategory,
            generateFaviconPreview as generateFaviconPreviewScript
        } from './src/seo/scripts/generateFavicons.js';
        
        let faviconManager;
        let generatedFavicons = [];
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©
        window.generateAllFavicons = async function() {
            await withProgress(async () => {
                log('ğŸš€ å…¨ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ç”Ÿæˆã‚’é–‹å§‹...');
                try {
                    faviconManager = new FaviconManager();
                    const results = await faviconManager.generateAllFavicons({ forceRegenerate: true });
                    
                    generatedFavicons = results.generated;
                    
                    log(`âœ… ç”Ÿæˆå®Œäº†: ${results.generated.length} ãƒ•ã‚¡ãƒ“ã‚³ãƒ³`);
                    log(`âŒ ã‚¨ãƒ©ãƒ¼: ${results.errors.length} ä»¶`);
                    
                    if (results.generated.length > 0) {
                        log('\nğŸ“„ ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ãƒ“ã‚³ãƒ³:');
                        results.generated.forEach(favicon => {
                            log(`  âœ“ ${favicon.filename} (${favicon.size}, ${favicon.type})`);
                        });
                        
                        document.getElementById('downloadBtn').disabled = false;
                        displayFaviconPreview(results.generated);
                    }
                    
                    if (results.errors.length > 0) {
                        log('\nâŒ ã‚¨ãƒ©ãƒ¼ä¸€è¦§:');
                        results.errors.forEach(error => {
                            log(`  âœ— ${error.filename}: ${error.error}`, 'error');
                        });
                    }
                    
                    // HTMLãƒ¡ã‚¿ã‚¿ã‚°ã®è¡¨ç¤º
                    const htmlTags = faviconManager.generateFaviconMetaTags();
                    log('\nğŸ“‹ HTMLãƒ¡ã‚¿ã‚¿ã‚°:');
                    log(htmlTags);
                    
                    // æ¤œè¨¼çµæœ
                    const validation = faviconManager.validateFaviconSetup();
                    log(`\nğŸ” æ¤œè¨¼çµæœ: ${validation.isValid ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹'}`);
                    
                    log('âœ¨ å…¨ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ!', 'success');
                    
                } catch (error) {
                    log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            });
        };
        
        window.generateCategory = async function(category) {
            await withProgress(async () => {
                log(`ğŸ¯ ${category} ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ã‚’ç”Ÿæˆä¸­...`);
                try {
                    const categoryFavicons = await generateFaviconCategory(category);
                    log(`âœ… ${categoryFavicons.length} å€‹ã® ${category} ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ã‚’ç”Ÿæˆã—ã¾ã—ãŸ`);
                    
                    categoryFavicons.forEach(favicon => {
                        log(`  âœ“ ${favicon.filename}`);
                    });
                    
                } catch (error) {
                    log(`âŒ ${category} ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            });
        };
        
        window.generateFaviconPreview = async function() {
            await withProgress(async () => {
                log('ğŸ‘ï¸ ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç”Ÿæˆä¸­...');
                try {
                    const html = await generateFaviconPreviewScript();
                    log('âœ… ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸ', 'success');
                } catch (error) {
                    log(`âŒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            });
        };
        
        window.downloadFavicons = async function() {
            if (generatedFavicons.length === 0) {
                log('âš ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšç”Ÿæˆã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }
            
            await withProgress(async () => {
                log('ğŸ’¾ ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­...');
                try {
                    if (faviconManager) {
                        await faviconManager.writeFaviconFiles(generatedFavicons);
                        log('âœ… ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ!', 'success');
                    }
                } catch (error) {
                    log(`âŒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            });
        };
        
        window.clearOutput = function() {
            document.getElementById('output').textContent = 'ã“ã“ã«å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™...';
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('downloadBtn').disabled = true;
            generatedFavicons = [];
        };
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const formattedMessage = `[${timestamp}] ${message}\n`;
            
            if (output.textContent === 'ã“ã“ã«å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™...') {
                output.textContent = '';
            }
            
            output.textContent += formattedMessage;
            output.scrollTop = output.scrollHeight;
            
            // ã‚¿ã‚¤ãƒ—åˆ¥ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
            if (type === 'error') {
                output.style.color = '#d32f2f';
            } else if (type === 'success') {
                output.style.color = '#388e3c';
            } else {
                output.style.color = '#333';
            }
        }
        
        function displayFaviconPreview(favicons) {
            const container = document.getElementById('previewContainer');
            const preview = document.getElementById('faviconPreview');
            
            preview.innerHTML = '';
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const categories = [...new Set(favicons.map(f => f.category))];
            
            categories.forEach(category => {
                const header = document.createElement('h3');
                header.textContent = `${category.charAt(0).toUpperCase() + category.slice(1)} Favicons`;
                header.className = 'category-header';
                preview.appendChild(header);
                
                const categoryFavicons = favicons.filter(f => f.category === category);
                categoryFavicons.forEach(favicon => {
                    const item = document.createElement('div');
                    item.className = 'favicon-item';
                    
                    const img = document.createElement('img');
                    img.src = favicon.dataUrl;
                    img.alt = favicon.filename;
                    
                    const info = document.createElement('div');
                    info.className = 'favicon-info';
                    info.innerHTML = `
                        <strong>${favicon.filename}</strong><br>
                        Size: ${favicon.size}<br>
                        Type: ${favicon.type}
                    `;
                    
                    item.appendChild(img);
                    item.appendChild(info);
                    preview.appendChild(item);
                });
            });
            
            container.style.display = 'block';
        }
        
        async function withProgress(asyncFunction) {
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                progressBar.style.width = progress + '%';
            }, 200);
            
            try {
                await asyncFunction();
                progressBar.style.width = '100%';
            } finally {
                clearInterval(interval);
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    progressBar.style.width = '0%';
                }, 1000);
            }
        }
        
        // åˆæœŸåŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        log('ğŸ¨ ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ç”Ÿæˆãƒ„ãƒ¼ãƒ«ãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸ');
        log('ğŸ“± å…¨ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ç”Ÿæˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„');
    </script>
</body>
</html>