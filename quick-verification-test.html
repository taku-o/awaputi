<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Quick Verification - Issue #113</title>
    <style>
        body { 
            font-family: monospace; 
            margin: 20px; 
            background: #f0f0f0; 
        }
        .log { 
            background: white; 
            padding: 10px; 
            margin: 5px 0; 
            border-left: 4px solid #007acc; 
            border-radius: 4px;
        }
        .success { border-color: #28a745; color: #28a745; }
        .warning { border-color: #ffc107; color: #856404; }
        .error { border-color: #dc3545; color: #dc3545; }
        .checklist {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .status-pass { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-fail { color: #dc3545; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Issue #113 Quick Verification Test</h1>
    <p>Service Workerå½±éŸ¿ã‚’å›é¿ã—ãŸã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</p>

    <div class="checklist">
        <h3>ğŸ“‹ æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h3>
        <div id="checklist">
            <div id="config-test">â³ ConfigurationManageråˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</div>
            <div id="performance-test">â³ PerformanceOptimizerçµ±åˆãƒ†ã‚¹ãƒˆ</div>
            <div id="audio-test">â³ AudioVisualizerå‹•ä½œãƒ†ã‚¹ãƒˆ</div>
            <div id="error-handler-test">â³ ErrorHandleræ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</div>
            <div id="main-game-test">â³ ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</div>
        </div>
    </div>

    <div id="log-container"></div>

    <script type="module">
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            document.getElementById('log-container').appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function updateChecklist(id, status, message) {
            const element = document.getElementById(id);
            if (element) {
                const statusIcon = status === 'pass' ? 'âœ…' : status === 'warning' ? 'âš ï¸' : 'âŒ';
                element.innerHTML = `${statusIcon} ${element.innerText.replace('â³', '').trim()}: ${message}`;
                element.className = `status-${status}`;
            }
        }

        async function runQuickTests() {
            log('ğŸš€ Issue #113 Quick Verification Testé–‹å§‹', 'info');

            try {
                // 1. ConfigurationManagerãƒ†ã‚¹ãƒˆ
                log('ğŸ§ª ConfigurationManageråˆæœŸåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                try {
                    const { getConfigurationManager } = await import('./src/core/ConfigurationManager.js');
                    const configManager = getConfigurationManager();
                    
                    // addValidationRuleãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨ç¢ºèª
                    if (typeof configManager.addValidationRule === 'function') {
                        log('âœ… addValidationRuleãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨ç¢ºèª', 'success');
                        
                        // targetFPSè¨­å®šç¢ºèª
                        const targetFPS = configManager.get('performance', 'targetFPS', 60);
                        log(`âœ… targetFPSè¨­å®šå–å¾—: ${targetFPS}`, 'success');
                        
                        updateChecklist('config-test', 'pass', 'addValidationRuleãƒ»targetFPSæ­£å¸¸');
                    } else {
                        throw new Error('addValidationRuleãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ã¾ã›ã‚“');
                    }
                } catch (error) {
                    log(`âŒ ConfigurationManagerãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                    updateChecklist('config-test', 'fail', error.message);
                }

                // 2. PerformanceOptimizerãƒ†ã‚¹ãƒˆ
                log('ğŸ§ª PerformanceOptimizerçµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                try {
                    const { PerformanceOptimizer } = await import('./src/utils/PerformanceOptimizer.js');
                    
                    const mockGameEngine = {
                        canvas: document.createElement('canvas'),
                        ctx: null,
                        getStats: () => ({ fps: 60, avgFrameTime: 16.67 })
                    };
                    mockGameEngine.ctx = mockGameEngine.canvas.getContext('2d');
                    
                    const optimizer = new PerformanceOptimizer(mockGameEngine);
                    
                    if (typeof optimizer.handleError === 'function' && optimizer.targetFPS) {
                        log(`âœ… PerformanceOptimizeræ­£å¸¸: targetFPS=${optimizer.targetFPS}`, 'success');
                        updateChecklist('performance-test', 'pass', `targetFPS=${optimizer.targetFPS}ã€handleErroræ­£å¸¸`);
                    } else {
                        throw new Error('PerformanceOptimizerãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸è¶³');
                    }
                } catch (error) {
                    log(`âŒ PerformanceOptimizerãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                    updateChecklist('performance-test', 'fail', error.message);
                }

                // 3. AudioVisualizerãƒ†ã‚¹ãƒˆ
                log('ğŸ§ª AudioVisualizerå‹•ä½œãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                try {
                    const { AudioVisualizer } = await import('./src/audio/AudioVisualizer.js');
                    
                    const mockAudioManager = {
                        audioContext: null,
                        initialized: false,
                        masterGainNode: null
                    };
                    
                    const visualizer = new AudioVisualizer(mockAudioManager);
                    
                    if (typeof visualizer.render === 'function' && typeof visualizer.setCanvas === 'function') {
                        log('âœ… AudioVisualizer renderãƒ»setCanvasãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª', 'success');
                        updateChecklist('audio-test', 'pass', 'renderãƒ»setCanvasãƒ¡ã‚½ãƒƒãƒ‰æ­£å¸¸');
                    } else {
                        throw new Error('AudioVisualizerãƒ¡ã‚½ãƒƒãƒ‰ä¸è¶³');
                    }
                } catch (error) {
                    log(`âŒ AudioVisualizerãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                    updateChecklist('audio-test', 'fail', error.message);
                }

                // 4. ErrorHandlerãƒ†ã‚¹ãƒˆ
                log('ğŸ§ª ErrorHandleræ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                try {
                    const { getErrorHandler } = await import('./src/utils/ErrorHandler.js');
                    const errorHandler = getErrorHandler();
                    
                    if (typeof errorHandler.setRetryHandler === 'function' && typeof errorHandler.handleError === 'function') {
                        log('âœ… ErrorHandler setRetryHandlerãƒ»handleErrorãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª', 'success');
                        updateChecklist('error-handler-test', 'pass', 'setRetryHandlerãƒ»handleErroræ­£å¸¸');
                    } else {
                        throw new Error('ErrorHandlerãƒ¡ã‚½ãƒƒãƒ‰ä¸è¶³');
                    }
                } catch (error) {
                    log(`âŒ ErrorHandlerãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                    updateChecklist('error-handler-test', 'fail', error.message);
                }

                // 5. ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆï¼ˆiframeä½¿ç”¨ï¼‰
                log('ğŸ§ª ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                try {
                    const iframe = document.createElement('iframe');
                    iframe.style.cssText = 'width: 1px; height: 1px; opacity: 0; position: absolute;';
                    iframe.src = './index.html';
                    document.body.appendChild(iframe);
                    
                    // 5ç§’å¾…æ©Ÿã—ã¦iframeèª­ã¿è¾¼ã¿ç¢ºèª
                    await new Promise((resolve) => {
                        setTimeout(() => {
                            try {
                                // iframeãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯
                                if (iframe.contentWindow && iframe.contentDocument) {
                                    log('âœ… ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ èª­ã¿è¾¼ã¿æˆåŠŸ', 'success');
                                    updateChecklist('main-game-test', 'pass', 'index.htmlæ­£å¸¸èª­ã¿è¾¼ã¿');
                                } else {
                                    log('âš ï¸ ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ èª­ã¿è¾¼ã¿ï¼ˆéƒ¨åˆ†çš„ï¼‰', 'warning');
                                    updateChecklist('main-game-test', 'warning', 'index.htmlèª­ã¿è¾¼ã¿ä¸­');
                                }
                                document.body.removeChild(iframe);
                            } catch (e) {
                                log('âš ï¸ ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ï¼ˆCORS/Same-Originï¼‰', 'warning');
                                updateChecklist('main-game-test', 'warning', 'Same-Originåˆ¶ç´„');
                            }
                            resolve();
                        }, 5000);
                    });
                } catch (error) {
                    log(`âŒ ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                    updateChecklist('main-game-test', 'fail', error.message);
                }

                log('ğŸ‰ Quick Verification Testå®Œäº†', 'success');

            } catch (error) {
                log(`ğŸ’¥ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ†ã‚¹ãƒˆé–‹å§‹
        runQuickTests();
    </script>
</body>
</html>