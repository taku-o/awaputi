<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translation Management Tools Test - BubblePop</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .tool-section {
            margin: 40px 0;
            padding: 25px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }

        .tool-section h2 {
            color: #2c3e50;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
            align-items: center;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        button:hover:not(:disabled) {
            background: #2980b9;
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        button.secondary {
            background: #95a5a6;
        }

        button.secondary:hover:not(:disabled) {
            background: #7f8c8d;
        }

        button.success {
            background: #27ae60;
        }

        button.success:hover:not(:disabled) {
            background: #229954;
        }

        button.warning {
            background: #f39c12;
        }

        button.warning:hover:not(:disabled) {
            background: #e67e22;
        }

        button.danger {
            background: #e74c3c;
        }

        button.danger:hover:not(:disabled) {
            background: #c0392b;
        }

        .results-area {
            margin: 25px 0;
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            min-height: 200px;
            max-height: 500px;
            overflow-y: auto;
        }

        .key-item {
            margin: 10px 0;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
        }

        .key-item .key-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .key-item .key-details {
            font-size: 0.9em;
            color: #666;
            margin: 5px 0;
        }

        .key-item .usage-info {
            display: flex;
            gap: 15px;
            margin-top: 8px;
            font-size: 0.85em;
        }

        .usage-badge {
            padding: 2px 8px;
            border-radius: 12px;
            color: white;
            font-size: 0.8em;
        }

        .usage-badge.used {
            background: #27ae60;
        }

        .usage-badge.unused {
            background: #e74c3c;
        }

        .usage-badge.recent {
            background: #3498db;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stats-card {
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }

        .stats-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stats-card .label {
            color: #666;
            font-size: 0.9em;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #3498db;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: bold;
        }

        .progress-fill.high {
            background: #27ae60;
        }

        .progress-fill.medium {
            background: #f39c12;
        }

        .progress-fill.low {
            background: #e74c3c;
        }

        .command-result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }

        .command-result.success {
            background: #d4edda;
            border-left-color: #27ae60;
        }

        .command-result.error {
            background: #f8d7da;
            border-left-color: #e74c3c;
        }

        .command-result.warning {
            background: #fff3cd;
            border-left-color: #f39c12;
        }

        .command-result .result-header {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .command-result .result-details {
            font-size: 0.9em;
            color: #555;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin: 20px 0 0 0;
        }

        .tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            border-bottom-color: #3498db;
            color: #3498db;
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .milestone-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .milestone-item.achieved {
            background: #d4edda;
            border-left: 4px solid #27ae60;
        }

        .milestone-name {
            font-weight: 500;
        }

        .milestone-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .validation-command {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .validation-command h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .validation-command .command-description {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .validation-command .command-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .option-group label {
            font-size: 0.85em;
            color: #555;
        }

        .option-group input,
        .option-group select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.85em;
        }

        .csv-download {
            display: inline-block;
            margin: 10px 0;
            padding: 8px 16px;
            background: #27ae60;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .csv-download:hover {
            background: #219a52;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ ç¿»è¨³ç®¡ç†ãƒ„ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ</h1>
        <p>BubblePop ã®ç¿»è¨³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§ã™ã€‚ç¿»è¨³ã‚­ãƒ¼ç®¡ç†ã€é€²æ—è¿½è·¡ã€æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚</p>

        <!-- ç¿»è¨³ã‚­ãƒ¼ç®¡ç† -->
        <div class="tool-section">
            <h2>ğŸ”‘ ç¿»è¨³ã‚­ãƒ¼ç®¡ç† (TranslationKeyManager)</h2>
            
            <div class="tabs">
                <button class="tab active" data-tab="key-registration">ã‚­ãƒ¼ç™»éŒ²</button>
                <button class="tab" data-tab="key-search">ã‚­ãƒ¼æ¤œç´¢</button>
                <button class="tab" data-tab="key-usage">ä½¿ç”¨çŠ¶æ³</button>
                <button class="tab" data-tab="key-reports">ãƒ¬ãƒãƒ¼ãƒˆ</button>
            </div>

            <div class="tab-content active" id="key-registration">
                <div class="controls">
                    <div class="form-group">
                        <label>ç¿»è¨³ã‚­ãƒ¼</label>
                        <input type="text" id="newKeyName" placeholder="ä¾‹: menu.play, game.score">
                    </div>
                    <div class="form-group">
                        <label>èª¬æ˜</label>
                        <input type="text" id="newKeyDescription" placeholder="ã‚­ãƒ¼ã®èª¬æ˜">
                    </div>
                    <div class="form-group">
                        <label>ã‚«ãƒ†ã‚´ãƒª</label>
                        <select id="newKeyCategory">
                            <option value="common">Common</option>
                            <option value="menu">Menu</option>
                            <option value="game">Game</option>
                            <option value="settings">Settings</option>
                            <option value="errors">Errors</option>
                            <option value="achievements">Achievements</option>
                            <option value="help">Help</option>
                        </select>
                    </div>
                    <button id="registerKeyBtn">ã‚­ãƒ¼ç™»éŒ²</button>
                    <button id="loadSampleKeysBtn" class="secondary">ã‚µãƒ³ãƒ—ãƒ«ã‚­ãƒ¼èª­ã¿è¾¼ã¿</button>
                </div>
                <div class="results-area" id="keyRegistrationResults">
                    <p>ã‚­ãƒ¼ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <div class="tab-content" id="key-search">
                <div class="controls">
                    <div class="form-group">
                        <label>æ¤œç´¢ã‚¯ã‚¨ãƒª</label>
                        <input type="text" id="searchQuery" placeholder="ã‚­ãƒ¼åã€èª¬æ˜ã€ã‚«ãƒ†ã‚´ãƒªã§æ¤œç´¢">
                    </div>
                    <div class="form-group">
                        <label>ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</label>
                        <select id="searchCategory">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="common">Common</option>
                            <option value="menu">Menu</option>
                            <option value="game">Game</option>
                            <option value="settings">Settings</option>
                            <option value="errors">Errors</option>
                            <option value="achievements">Achievements</option>
                            <option value="help">Help</option>
                        </select>
                    </div>
                    <button id="searchKeysBtn">æ¤œç´¢å®Ÿè¡Œ</button>
                    <button id="showAllKeysBtn" class="secondary">å…¨ã‚­ãƒ¼è¡¨ç¤º</button>
                </div>
                <div class="results-area" id="keySearchResults">
                    <p>æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <div class="tab-content" id="key-usage">
                <div class="controls">
                    <button id="recordSampleUsageBtn">ã‚µãƒ³ãƒ—ãƒ«ä½¿ç”¨è¨˜éŒ²</button>
                    <button id="showUnusedKeysBtn" class="warning">æœªä½¿ç”¨ã‚­ãƒ¼è¡¨ç¤º</button>
                    <button id="showFrequentKeysBtn" class="success">é »ç¹ä½¿ç”¨ã‚­ãƒ¼è¡¨ç¤º</button>
                    <button id="showRecentKeysBtn" class="secondary">æœ€è¿‘ä½¿ç”¨ã‚­ãƒ¼è¡¨ç¤º</button>
                </div>
                <div class="results-area" id="keyUsageResults">
                    <p>ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <div class="tab-content" id="key-reports">
                <div class="controls">
                    <div class="form-group">
                        <label>ãƒ¬ãƒãƒ¼ãƒˆå½¢å¼</label>
                        <select id="reportFormat">
                            <option value="detailed">è©³ç´°</option>
                            <option value="summary">ã‚µãƒãƒªãƒ¼</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                    <button id="generateUsageReportBtn">ä½¿ç”¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                    <button id="getCategoryStatsBtn" class="secondary">ã‚«ãƒ†ã‚´ãƒªçµ±è¨ˆ</button>
                </div>
                <div class="results-area" id="keyReportsResults">
                    <p>ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>
        </div>

        <!-- é€²æ—è¿½è·¡ -->
        <div class="tool-section">
            <h2>ğŸ“Š é€²æ—è¿½è·¡ (ProgressTracker)</h2>
            
            <div class="tabs">
                <button class="tab active" data-tab="progress-setup">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</button>
                <button class="tab" data-tab="progress-tracking">é€²æ—è¿½è·¡</button>
                <button class="tab" data-tab="progress-reports">é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ</button>
                <button class="tab" data-tab="progress-milestones">ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</button>
            </div>

            <div class="tab-content active" id="progress-setup">
                <div class="controls">
                    <div class="form-group">
                        <label>è¨€èª</label>
                        <select id="progressLanguage">
                            <option value="en">English</option>
                            <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                            <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                            <option value="ko">í•œêµ­ì–´</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ç¿»è¨³ã‚»ãƒƒãƒˆå</label>
                        <input type="text" id="translationSetName" placeholder="ä¾‹: main-ui, game-content">
                    </div>
                    <div class="form-group">
                        <label>ã‚«ãƒ†ã‚´ãƒª</label>
                        <select id="progressCategory">
                            <option value="common">Common</option>
                            <option value="menu">Menu</option>
                            <option value="game">Game</option>
                            <option value="settings">Settings</option>
                        </select>
                    </div>
                    <button id="registerTranslationSetBtn">ç¿»è¨³ã‚»ãƒƒãƒˆç™»éŒ²</button>
                    <button id="loadSampleProgressBtn" class="secondary">ã‚µãƒ³ãƒ—ãƒ«é€²æ—èª­ã¿è¾¼ã¿</button>
                </div>
                <div class="results-area" id="progressSetupResults">
                    <p>ç¿»è¨³ã‚»ãƒƒãƒˆã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <div class="tab-content" id="progress-tracking">
                <div class="controls">
                    <div class="form-group">
                        <label>å¯¾è±¡è¨€èª</label>
                        <select id="trackingLanguage">
                            <option value="en">English</option>
                            <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                            <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                            <option value="ko">í•œêµ­ì–´</option>
                        </select>
                    </div>
                    <button id="showLanguageProgressBtn">è¨€èªé€²æ—è¡¨ç¤º</button>
                    <button id="showIncompleteItemsBtn" class="warning">æœªå®Œæˆé …ç›®è¡¨ç¤º</button>
                    <button id="updateSampleProgressBtn" class="success">ã‚µãƒ³ãƒ—ãƒ«é€²æ—æ›´æ–°</button>
                </div>
                <div class="results-area" id="progressTrackingResults">
                    <div class="stats-grid" id="progressStatsGrid">
                        <!-- å‹•çš„ã«ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="progress-reports">
                <div class="controls">
                    <div class="form-group">
                        <label>å¯¾è±¡è¨€èª</label>
                        <select id="reportLanguage">
                            <option value="en">English</option>
                            <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                            <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                            <option value="ko">í•œêµ­ì–´</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ãƒ¬ãƒãƒ¼ãƒˆå½¢å¼</label>
                        <select id="progressReportFormat">
                            <option value="detailed">è©³ç´°</option>
                            <option value="summary">ã‚µãƒãƒªãƒ¼</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                    <button id="generateProgressReportBtn">é€²æ—ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                    <button id="showAllLanguagesProgressBtn" class="secondary">å…¨è¨€èªé€²æ—è¡¨ç¤º</button>
                </div>
                <div class="results-area" id="progressReportsResults">
                    <p>é€²æ—ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <div class="tab-content" id="progress-milestones">
                <div class="controls">
                    <div class="form-group">
                        <label>å¯¾è±¡è¨€èª</label>
                        <select id="milestoneLanguage">
                            <option value="en">English</option>
                            <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                            <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                            <option value="ko">í•œêµ­ì–´</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³å</label>
                        <input type="text" id="milestoneName" placeholder="ä¾‹: Alpha Release, Beta Complete">
                    </div>
                    <div class="form-group">
                        <label>ç›®æ¨™å®Œæˆç‡ (%)</label>
                        <input type="number" id="milestoneTarget" min="0" max="100" value="80">
                    </div>
                    <button id="setMilestoneBtn">ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¨­å®š</button>
                    <button id="showMilestonesBtn" class="secondary">ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¡¨ç¤º</button>
                    <button id="predictGoalBtn" class="success">ç›®æ¨™é”æˆäºˆæ¸¬</button>
                </div>
                <div class="results-area" id="progressMilestonesResults">
                    <p>ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>
        </div>

        <!-- æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ -->
        <div class="tool-section">
            <h2>âœ… æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ (ValidationCommands)</h2>
            
            <div class="validation-commands" id="validationCommands">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>

            <div class="controls">
                <button id="runAllValidationsBtn" class="danger">ã™ã¹ã¦ã®æ¤œè¨¼å®Ÿè¡Œ</button>
                <button id="generateValidationReportBtn" class="success">æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                <button id="clearValidationResultsBtn" class="secondary">çµæœã‚¯ãƒªã‚¢</button>
            </div>

            <div class="results-area" id="validationResults">
                <p>æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
            </div>
        </div>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            å‡¦ç†ä¸­...
        </div>
    </div>

    <script type="module">
        import { getTranslationKeyManager } from './src/core/i18n/management/TranslationKeyManager.js';
        import { getProgressTracker } from './src/core/i18n/management/ProgressTracker.js';
        import { getValidationCommands } from './src/core/i18n/management/ValidationCommands.js';

        class TranslationManagementTestUI {
            constructor() {
                this.keyManager = getTranslationKeyManager();
                this.progressTracker = getProgressTracker();
                this.validationCommands = getValidationCommands();
                
                this.initializeElements();
                this.setupEventListeners();
                this.setupTabs();
                this.initializeValidationCommands();
                this.loadSampleData();
            }

            initializeElements() {
                this.elements = {
                    // ã‚­ãƒ¼ç®¡ç†
                    newKeyName: document.getElementById('newKeyName'),
                    newKeyDescription: document.getElementById('newKeyDescription'),
                    newKeyCategory: document.getElementById('newKeyCategory'),
                    registerKeyBtn: document.getElementById('registerKeyBtn'),
                    loadSampleKeysBtn: document.getElementById('loadSampleKeysBtn'),
                    keyRegistrationResults: document.getElementById('keyRegistrationResults'),
                    
                    // ã‚­ãƒ¼æ¤œç´¢
                    searchQuery: document.getElementById('searchQuery'),
                    searchCategory: document.getElementById('searchCategory'),
                    searchKeysBtn: document.getElementById('searchKeysBtn'),
                    showAllKeysBtn: document.getElementById('showAllKeysBtn'),
                    keySearchResults: document.getElementById('keySearchResults'),
                    
                    // ã‚­ãƒ¼ä½¿ç”¨çŠ¶æ³
                    recordSampleUsageBtn: document.getElementById('recordSampleUsageBtn'),
                    showUnusedKeysBtn: document.getElementById('showUnusedKeysBtn'),
                    showFrequentKeysBtn: document.getElementById('showFrequentKeysBtn'),
                    showRecentKeysBtn: document.getElementById('showRecentKeysBtn'),
                    keyUsageResults: document.getElementById('keyUsageResults'),
                    
                    // ã‚­ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ
                    reportFormat: document.getElementById('reportFormat'),
                    generateUsageReportBtn: document.getElementById('generateUsageReportBtn'),
                    getCategoryStatsBtn: document.getElementById('getCategoryStatsBtn'),
                    keyReportsResults: document.getElementById('keyReportsResults'),
                    
                    // é€²æ—ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
                    progressLanguage: document.getElementById('progressLanguage'),
                    translationSetName: document.getElementById('translationSetName'),
                    progressCategory: document.getElementById('progressCategory'),
                    registerTranslationSetBtn: document.getElementById('registerTranslationSetBtn'),
                    loadSampleProgressBtn: document.getElementById('loadSampleProgressBtn'),
                    progressSetupResults: document.getElementById('progressSetupResults'),
                    
                    // é€²æ—è¿½è·¡
                    trackingLanguage: document.getElementById('trackingLanguage'),
                    showLanguageProgressBtn: document.getElementById('showLanguageProgressBtn'),
                    showIncompleteItemsBtn: document.getElementById('showIncompleteItemsBtn'),
                    updateSampleProgressBtn: document.getElementById('updateSampleProgressBtn'),
                    progressTrackingResults: document.getElementById('progressTrackingResults'),
                    progressStatsGrid: document.getElementById('progressStatsGrid'),
                    
                    // é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ
                    reportLanguage: document.getElementById('reportLanguage'),
                    progressReportFormat: document.getElementById('progressReportFormat'),
                    generateProgressReportBtn: document.getElementById('generateProgressReportBtn'),
                    showAllLanguagesProgressBtn: document.getElementById('showAllLanguagesProgressBtn'),
                    progressReportsResults: document.getElementById('progressReportsResults'),
                    
                    // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
                    milestoneLanguage: document.getElementById('milestoneLanguage'),
                    milestoneName: document.getElementById('milestoneName'),
                    milestoneTarget: document.getElementById('milestoneTarget'),
                    setMilestoneBtn: document.getElementById('setMilestoneBtn'),
                    showMilestonesBtn: document.getElementById('showMilestonesBtn'),
                    predictGoalBtn: document.getElementById('predictGoalBtn'),
                    progressMilestonesResults: document.getElementById('progressMilestonesResults'),
                    
                    // æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰
                    validationCommands: document.getElementById('validationCommands'),
                    runAllValidationsBtn: document.getElementById('runAllValidationsBtn'),
                    generateValidationReportBtn: document.getElementById('generateValidationReportBtn'),
                    clearValidationResultsBtn: document.getElementById('clearValidationResultsBtn'),
                    validationResults: document.getElementById('validationResults'),
                    
                    // å…±é€š
                    loadingIndicator: document.getElementById('loadingIndicator')
                };
            }

            setupEventListeners() {
                // ã‚­ãƒ¼ç®¡ç†
                this.elements.registerKeyBtn.addEventListener('click', () => this.registerKey());
                this.elements.loadSampleKeysBtn.addEventListener('click', () => this.loadSampleKeys());
                
                // ã‚­ãƒ¼æ¤œç´¢
                this.elements.searchKeysBtn.addEventListener('click', () => this.searchKeys());
                this.elements.showAllKeysBtn.addEventListener('click', () => this.showAllKeys());
                
                // ã‚­ãƒ¼ä½¿ç”¨çŠ¶æ³
                this.elements.recordSampleUsageBtn.addEventListener('click', () => this.recordSampleUsage());
                this.elements.showUnusedKeysBtn.addEventListener('click', () => this.showUnusedKeys());
                this.elements.showFrequentKeysBtn.addEventListener('click', () => this.showFrequentKeys());
                this.elements.showRecentKeysBtn.addEventListener('click', () => this.showRecentKeys());
                
                // ã‚­ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ
                this.elements.generateUsageReportBtn.addEventListener('click', () => this.generateUsageReport());
                this.elements.getCategoryStatsBtn.addEventListener('click', () => this.getCategoryStats());
                
                // é€²æ—ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
                this.elements.registerTranslationSetBtn.addEventListener('click', () => this.registerTranslationSet());
                this.elements.loadSampleProgressBtn.addEventListener('click', () => this.loadSampleProgress());
                
                // é€²æ—è¿½è·¡
                this.elements.showLanguageProgressBtn.addEventListener('click', () => this.showLanguageProgress());
                this.elements.showIncompleteItemsBtn.addEventListener('click', () => this.showIncompleteItems());
                this.elements.updateSampleProgressBtn.addEventListener('click', () => this.updateSampleProgress());
                
                // é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ
                this.elements.generateProgressReportBtn.addEventListener('click', () => this.generateProgressReport());
                this.elements.showAllLanguagesProgressBtn.addEventListener('click', () => this.showAllLanguagesProgress());
                
                // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
                this.elements.setMilestoneBtn.addEventListener('click', () => this.setMilestone());
                this.elements.showMilestonesBtn.addEventListener('click', () => this.showMilestones());
                this.elements.predictGoalBtn.addEventListener('click', () => this.predictGoal());
                
                // æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰
                this.elements.runAllValidationsBtn.addEventListener('click', () => this.runAllValidations());
                this.elements.generateValidationReportBtn.addEventListener('click', () => this.generateValidationReport());
                this.elements.clearValidationResultsBtn.addEventListener('click', () => this.clearValidationResults());
            }

            setupTabs() {
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.target.dataset.tab;
                        if (tabName) {
                            this.switchTab(e.target.closest('.tool-section'), tabName);
                        }
                    });
                });
            }

            switchTab(section, tabName) {
                // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
                section.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                section.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                section.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                section.querySelector(`#${tabName}`).classList.add('active');
            }

            showLoading(show) {
                this.elements.loadingIndicator.classList.toggle('show', show);
            }

            // ã‚­ãƒ¼ç®¡ç†ãƒ¡ã‚½ãƒƒãƒ‰
            registerKey() {
                const key = this.elements.newKeyName.value.trim();
                const description = this.elements.newKeyDescription.value.trim();
                const category = this.elements.newKeyCategory.value;

                if (!key) {
                    alert('ç¿»è¨³ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const result = this.keyManager.registerKey(key, {
                    description: description,
                    category: category,
                    tags: [category]
                });

                if (result) {
                    this.elements.keyRegistrationResults.innerHTML = `
                        <div class="command-result success">
                            <div class="result-header">âœ… ã‚­ãƒ¼ç™»éŒ²æˆåŠŸ</div>
                            <div class="result-details">
                                ã‚­ãƒ¼: ${key}<br>
                                ã‚«ãƒ†ã‚´ãƒª: ${category}<br>
                                èª¬æ˜: ${description || 'ï¼ˆãªã—ï¼‰'}
                            </div>
                        </div>
                    `;
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                    this.elements.newKeyName.value = '';
                    this.elements.newKeyDescription.value = '';
                } else {
                    this.elements.keyRegistrationResults.innerHTML = `
                        <div class="command-result error">
                            <div class="result-header">âŒ ã‚­ãƒ¼ç™»éŒ²å¤±æ•—</div>
                            <div class="result-details">ã‚­ãƒ¼ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>
                        </div>
                    `;
                }
            }

            loadSampleKeys() {
                const sampleKeys = {
                    'common.ok': { description: 'OK ãƒœã‚¿ãƒ³', category: 'common' },
                    'common.cancel': { description: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ« ãƒœã‚¿ãƒ³', category: 'common' },
                    'common.save': { description: 'ä¿å­˜ ãƒœã‚¿ãƒ³', category: 'common' },
                    'menu.play': { description: 'ãƒ—ãƒ¬ã‚¤ ãƒ¡ãƒ‹ãƒ¥ãƒ¼', category: 'menu' },
                    'menu.settings': { description: 'è¨­å®š ãƒ¡ãƒ‹ãƒ¥ãƒ¼', category: 'menu' },
                    'menu.exit': { description: 'çµ‚äº† ãƒ¡ãƒ‹ãƒ¥ãƒ¼', category: 'menu' },
                    'game.score': { description: 'ã‚¹ã‚³ã‚¢è¡¨ç¤º', category: 'game', parameters: ['{score}'] },
                    'game.level': { description: 'ãƒ¬ãƒ™ãƒ«è¡¨ç¤º', category: 'game', parameters: ['{level}'] },
                    'settings.volume': { description: 'éŸ³é‡è¨­å®š', category: 'settings' },
                    'settings.difficulty': { description: 'é›£æ˜“åº¦è¨­å®š', category: 'settings' }
                };

                const results = this.keyManager.registerKeys(sampleKeys);
                
                this.elements.keyRegistrationResults.innerHTML = `
                    <div class="command-result success">
                        <div class="result-header">ğŸ“¦ ã‚µãƒ³ãƒ—ãƒ«ã‚­ãƒ¼èª­ã¿è¾¼ã¿å®Œäº†</div>
                        <div class="result-details">
                            æˆåŠŸ: ${results.successful.length} å€‹<br>
                            å¤±æ•—: ${results.failed.length} å€‹<br>
                            ${results.successful.length > 0 ? `ç™»éŒ²ã•ã‚ŒãŸã‚­ãƒ¼: ${results.successful.slice(0, 5).join(', ')}${results.successful.length > 5 ? '...' : ''}` : ''}
                        </div>
                    </div>
                `;
            }

            searchKeys() {
                const query = this.elements.searchQuery.value.trim();
                const category = this.elements.searchCategory.value;

                if (!query) {
                    alert('æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const results = this.keyManager.searchKeys(query, {
                    category: category || null,
                    searchIn: ['key', 'description', 'context']
                });

                this.displayKeyResults(results, this.elements.keySearchResults);
            }

            showAllKeys() {
                // å…¨ã‚­ãƒ¼ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ç©ºæ–‡å­—ã§æ¤œç´¢
                const results = this.keyManager.searchKeys('', {
                    searchIn: ['key']
                });

                this.displayKeyResults(results, this.elements.keySearchResults);
            }

            displayKeyResults(results, container) {
                if (results.length === 0) {
                    container.innerHTML = '<p>çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
                    return;
                }

                let html = `<h4>æ¤œç´¢çµæœ: ${results.length} ä»¶</h4>`;
                
                results.forEach(result => {
                    const usage = result.usage;
                    const usageBadge = usage && usage.count > 0 ? 
                        `<span class="usage-badge used">ä½¿ç”¨æ¸ˆã¿ (${usage.count}å›)</span>` :
                        `<span class="usage-badge unused">æœªä½¿ç”¨</span>`;

                    html += `
                        <div class="key-item">
                            <div class="key-name">${result.key}</div>
                            <div class="key-details">${result.metadata.description || 'ï¼ˆèª¬æ˜ãªã—ï¼‰'}</div>
                            <div class="usage-info">
                                <span>ã‚«ãƒ†ã‚´ãƒª: ${result.metadata.category}</span>
                                ${usageBadge}
                                ${usage && usage.lastUsed ? `<span>æœ€çµ‚ä½¿ç”¨: ${new Date(usage.lastUsed).toLocaleString('ja-JP')}</span>` : ''}
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            recordSampleUsage() {
                const sampleUsage = [
                    { key: 'common.ok', context: 'dialog', location: 'MainMenu' },
                    { key: 'common.cancel', context: 'dialog', location: 'Settings' },
                    { key: 'menu.play', context: 'menu', location: 'MainMenu' },
                    { key: 'game.score', context: 'hud', location: 'GameScene' },
                    { key: 'settings.volume', context: 'settings', location: 'SettingsScene' }
                ];

                this.keyManager.recordBatchUsage(sampleUsage);

                this.elements.keyUsageResults.innerHTML = `
                    <div class="command-result success">
                        <div class="result-header">ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«ä½¿ç”¨è¨˜éŒ²å®Œäº†</div>
                        <div class="result-details">
                            ${sampleUsage.length} å€‹ã®ã‚­ãƒ¼ã®ä½¿ç”¨ã‚’è¨˜éŒ²ã—ã¾ã—ãŸã€‚
                        </div>
                    </div>
                `;
            }

            showUnusedKeys() {
                const unusedKeys = this.keyManager.getUnusedKeys();
                
                if (unusedKeys.length === 0) {
                    this.elements.keyUsageResults.innerHTML = '<p>âœ… æœªä½¿ç”¨ã®ã‚­ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                    return;
                }

                let html = `<h4>âš ï¸ æœªä½¿ç”¨ã‚­ãƒ¼: ${unusedKeys.length} ä»¶</h4>`;
                
                unusedKeys.forEach(keyInfo => {
                    html += `
                        <div class="key-item">
                            <div class="key-name">${keyInfo.key}</div>
                            <div class="key-details">${keyInfo.metadata.description}</div>
                            <div class="usage-info">
                                <span>ã‚«ãƒ†ã‚´ãƒª: ${keyInfo.metadata.category}</span>
                                <span class="usage-badge unused">æœªä½¿ç”¨</span>
                                <span>ç™»éŒ²æ—¥: ${new Date(keyInfo.registeredAt).toLocaleDateString('ja-JP')}</span>
                            </div>
                        </div>
                    `;
                });

                this.elements.keyUsageResults.innerHTML = html;
            }

            showFrequentKeys() {
                const frequentKeys = this.keyManager.getFrequentlyUsedKeys(10);
                
                if (frequentKeys.length === 0) {
                    this.elements.keyUsageResults.innerHTML = '<p>ä½¿ç”¨ã•ã‚ŒãŸã‚­ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                    return;
                }

                let html = `<h4>ğŸ”¥ é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚­ãƒ¼: ${frequentKeys.length} ä»¶</h4>`;
                
                frequentKeys.forEach(keyInfo => {
                    html += `
                        <div class="key-item">
                            <div class="key-name">${keyInfo.key}</div>
                            <div class="key-details">${keyInfo.metadata?.description || 'ï¼ˆèª¬æ˜ãªã—ï¼‰'}</div>
                            <div class="usage-info">
                                <span class="usage-badge used">ä½¿ç”¨å›æ•°: ${keyInfo.count}</span>
                                ${keyInfo.lastUsed ? `<span>æœ€çµ‚ä½¿ç”¨: ${new Date(keyInfo.lastUsed).toLocaleString('ja-JP')}</span>` : ''}
                                <span>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: ${keyInfo.contexts.join(', ')}</span>
                            </div>
                        </div>
                    `;
                });

                this.elements.keyUsageResults.innerHTML = html;
            }

            showRecentKeys() {
                const recentKeys = this.keyManager.getRecentlyUsedKeys(7, 20);
                
                if (recentKeys.length === 0) {
                    this.elements.keyUsageResults.innerHTML = '<p>æœ€è¿‘ä½¿ç”¨ã•ã‚ŒãŸã‚­ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                    return;
                }

                let html = `<h4>ğŸ•’ æœ€è¿‘ä½¿ç”¨ã•ã‚ŒãŸã‚­ãƒ¼ (7æ—¥ä»¥å†…): ${recentKeys.length} ä»¶</h4>`;
                
                recentKeys.forEach(keyInfo => {
                    html += `
                        <div class="key-item">
                            <div class="key-name">${keyInfo.key}</div>
                            <div class="key-details">${keyInfo.metadata?.description || 'ï¼ˆèª¬æ˜ãªã—ï¼‰'}</div>
                            <div class="usage-info">
                                <span class="usage-badge recent">æœ€è¿‘ä½¿ç”¨</span>
                                <span>ä½¿ç”¨å›æ•°: ${keyInfo.count}</span>
                                <span>æœ€çµ‚ä½¿ç”¨: ${new Date(keyInfo.lastUsed).toLocaleString('ja-JP')}</span>
                            </div>
                        </div>
                    `;
                });

                this.elements.keyUsageResults.innerHTML = html;
            }

            generateUsageReport() {
                const format = this.elements.reportFormat.value;
                const report = this.keyManager.generateUsageReport({
                    format: format,
                    includeUnused: true,
                    includeDeprecated: false
                });

                if (format === 'csv') {
                    // CSV ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    const blob = new Blob([report], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `key-usage-report-${Date.now()}.csv`;
                    a.click();
                    URL.revokeObjectURL(url);

                    this.elements.keyReportsResults.innerHTML = `
                        <div class="command-result success">
                            <div class="result-header">ğŸ“„ CSVãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†</div>
                            <div class="result-details">ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸã€‚</div>
                        </div>
                    `;
                } else {
                    let html = '<h4>ğŸ“Š ä½¿ç”¨ãƒ¬ãƒãƒ¼ãƒˆ</h4>';
                    
                    if (format === 'summary') {
                        html += `
                            <div class="stats-grid">
                                <div class="stats-card">
                                    <div class="value">${report.summary.totalKeys}</div>
                                    <div class="label">ç·ã‚­ãƒ¼æ•°</div>
                                </div>
                                <div class="stats-card">
                                    <div class="value">${report.summary.usedKeys}</div>
                                    <div class="label">ä½¿ç”¨æ¸ˆã¿ã‚­ãƒ¼</div>
                                </div>
                                <div class="stats-card">
                                    <div class="value">${report.summary.unusedKeys}</div>
                                    <div class="label">æœªä½¿ç”¨ã‚­ãƒ¼</div>
                                </div>
                                <div class="stats-card">
                                    <div class="value">${report.summary.usageRate}%</div>
                                    <div class="label">ä½¿ç”¨ç‡</div>
                                </div>
                            </div>
                            <h5>ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹ã‚­ãƒ¼:</h5>
                            <ul>
                                ${report.topUsedKeys.map(k => `<li>${k.key} (${k.count}å›)</li>`).join('')}
                            </ul>
                        `;
                    } else {
                        html += `<pre>${JSON.stringify(report, null, 2)}</pre>`;
                    }
                    
                    this.elements.keyReportsResults.innerHTML = html;
                }
            }

            getCategoryStats() {
                const stats = this.keyManager.getCategoryStatistics();
                
                let html = '<h4>ğŸ“ˆ ã‚«ãƒ†ã‚´ãƒªåˆ¥çµ±è¨ˆ</h4><div class="stats-grid">';
                
                for (const [category, categoryStats] of Object.entries(stats)) {
                    const usageRate = categoryStats.total > 0 ? 
                        Math.round((categoryStats.used / categoryStats.total) * 100) : 0;
                    
                    html += `
                        <div class="stats-card">
                            <div class="value">${categoryStats.total}</div>
                            <div class="label">${category}</div>
                            <div style="font-size: 0.8em; margin-top: 5px;">
                                ä½¿ç”¨ç‡: ${usageRate}%<br>
                                ä½¿ç”¨æ¸ˆã¿: ${categoryStats.used}<br>
                                æœªä½¿ç”¨: ${categoryStats.unused}
                            </div>
                        </div>
                    `;
                }
                
                html += '</div>';
                this.elements.keyReportsResults.innerHTML = html;
            }

            // é€²æ—è¿½è·¡ãƒ¡ã‚½ãƒƒãƒ‰
            registerTranslationSet() {
                const language = this.elements.progressLanguage.value;
                const setName = this.elements.translationSetName.value.trim();
                const category = this.elements.progressCategory.value;

                if (!setName) {
                    alert('ç¿»è¨³ã‚»ãƒƒãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                // ã‚µãƒ³ãƒ—ãƒ«ç¿»è¨³ãƒ‡ãƒ¼ã‚¿
                const sampleTranslations = {
                    common: {
                        ok: 'OK',
                        cancel: 'Cancel',
                        save: 'Save'
                    },
                    menu: {
                        play: 'Play',
                        settings: 'Settings'
                    }
                };

                const result = this.progressTracker.registerTranslationSet(
                    language,
                    setName,
                    sampleTranslations,
                    { category: category, priority: 'normal' }
                );

                if (result) {
                    this.elements.progressSetupResults.innerHTML = `
                        <div class="command-result success">
                            <div class="result-header">âœ… ç¿»è¨³ã‚»ãƒƒãƒˆç™»éŒ²æˆåŠŸ</div>
                            <div class="result-details">
                                è¨€èª: ${language}<br>
                                ã‚»ãƒƒãƒˆå: ${setName}<br>
                                ã‚«ãƒ†ã‚´ãƒª: ${category}<br>
                                ã‚­ãƒ¼æ•°: ${Object.keys(this.progressTracker.flattenTranslations ? this.progressTracker.flattenTranslations(sampleTranslations) : sampleTranslations).length}
                            </div>
                        </div>
                    `;
                    
                    this.elements.translationSetName.value = '';
                } else {
                    this.elements.progressSetupResults.innerHTML = `
                        <div class="command-result error">
                            <div class="result-header">âŒ ç¿»è¨³ã‚»ãƒƒãƒˆç™»éŒ²å¤±æ•—</div>
                        </div>
                    `;
                }
            }

            loadSampleProgress() {
                const languages = ['en', 'zh-CN', 'zh-TW', 'ko'];
                const sets = ['main-ui', 'game-content', 'help-text'];
                let registered = 0;

                languages.forEach(language => {
                    sets.forEach(setName => {
                        const sampleTranslations = this.generateSampleTranslations(setName);
                        const result = this.progressTracker.registerTranslationSet(
                            language,
                            setName,
                            sampleTranslations,
                            { 
                                category: setName.includes('ui') ? 'common' : 
                                        setName.includes('game') ? 'game' : 'help',
                                priority: 'normal'
                            }
                        );
                        if (result) registered++;
                    });
                });

                this.elements.progressSetupResults.innerHTML = `
                    <div class="command-result success">
                        <div class="result-header">ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«é€²æ—ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†</div>
                        <div class="result-details">
                            ${registered} å€‹ã®ç¿»è¨³ã‚»ãƒƒãƒˆã‚’ç™»éŒ²ã—ã¾ã—ãŸã€‚<br>
                            è¨€èª: ${languages.join(', ')}<br>
                            ã‚»ãƒƒãƒˆ: ${sets.join(', ')}
                        </div>
                    </div>
                `;
            }

            generateSampleTranslations(setName) {
                const baseTranslations = {
                    'main-ui': {
                        common: { ok: 'OK', cancel: 'Cancel', save: 'Save', load: 'Load' },
                        menu: { play: 'Play', settings: 'Settings', exit: 'Exit' }
                    },
                    'game-content': {
                        game: { score: 'Score: {score}', level: 'Level {level}', time: 'Time: {time}' },
                        hud: { pause: 'Pause', resume: 'Resume' }
                    },
                    'help-text': {
                        help: { title: 'Help', controls: 'Controls', tips: 'Tips' },
                        tutorial: { welcome: 'Welcome', next: 'Next', prev: 'Previous' }
                    }
                };

                return baseTranslations[setName] || { test: { key: 'value' } };
            }

            showLanguageProgress() {
                const language = this.elements.trackingLanguage.value;
                const progress = this.progressTracker.getLanguageProgress(language);

                if (!progress) {
                    this.elements.progressStatsGrid.innerHTML = '<p>ã“ã®è¨€èªã®é€²æ—ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                    return;
                }

                this.elements.progressStatsGrid.innerHTML = `
                    <div class="stats-card">
                        <div class="value">${progress.completionRate}%</div>
                        <div class="label">å®Œæˆç‡</div>
                    </div>
                    <div class="stats-card">
                        <div class="value">${progress.qualityScore}%</div>
                        <div class="label">å“è³ªã‚¹ã‚³ã‚¢</div>
                    </div>
                    <div class="stats-card">
                        <div class="value">${progress.totalKeys}</div>
                        <div class="label">ç·ã‚­ãƒ¼æ•°</div>
                    </div>
                    <div class="stats-card">
                        <div class="value">${progress.totalSets}</div>
                        <div class="label">ç¿»è¨³ã‚»ãƒƒãƒˆæ•°</div>
                    </div>
                `;

                // é€²æ—ãƒãƒ¼ã‚’è¡¨ç¤º
                const progressBar = `
                    <div style="grid-column: 1 / -1; margin-top: 20px;">
                        <h4>${language} ç¿»è¨³é€²æ—</h4>
                        <div class="progress-bar">
                            <div class="progress-fill ${this.getProgressClass(progress.completionRate)}" 
                                 style="width: ${progress.completionRate}%">
                                ${progress.completionRate}%
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9em; margin-top: 5px;">
                            <span>ç¿»è¨³æ¸ˆã¿: ${progress.translated}</span>
                            <span>ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¸ˆã¿: ${progress.reviewed}</span>
                            <span>æ‰¿èªæ¸ˆã¿: ${progress.approved}</span>
                            <span>æœªå®Œæˆ: ${progress.empty}</span>
                        </div>
                    </div>
                `;

                this.elements.progressStatsGrid.innerHTML += progressBar;
            }

            getProgressClass(percentage) {
                if (percentage >= 80) return 'high';
                if (percentage >= 50) return 'medium';
                return 'low';
            }

            showIncompleteItems() {
                const language = this.elements.trackingLanguage.value;
                const incompleteItems = this.progressTracker.getIncompleteItems(language, {
                    status: ['empty', 'translated'],
                    limit: 20
                });

                if (incompleteItems.length === 0) {
                    this.elements.progressTrackingResults.innerHTML = '<p>âœ… æœªå®Œæˆé …ç›®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                    return;
                }

                let html = `<h4>âš ï¸ æœªå®Œæˆé …ç›®: ${incompleteItems.length} ä»¶</h4>`;
                
                incompleteItems.forEach(item => {
                    html += `
                        <div class="key-item">
                            <div class="key-name">${item.key}</div>
                            <div class="key-details">ã‚»ãƒƒãƒˆ: ${item.set} | ã‚«ãƒ†ã‚´ãƒª: ${item.category}</div>
                            <div class="usage-info">
                                <span class="usage-badge ${item.status === 'empty' ? 'unused' : 'used'}">${item.status}</span>
                                <span>å„ªå…ˆåº¦: ${item.priority}</span>
                                ${item.lastUpdated ? `<span>æ›´æ–°: ${new Date(item.lastUpdated).toLocaleDateString('ja-JP')}</span>` : ''}
                            </div>
                        </div>
                    `;
                });

                this.elements.progressTrackingResults.innerHTML = html;
            }

            updateSampleProgress() {
                const language = this.elements.trackingLanguage.value;
                const sampleUpdates = [
                    { key: 'common.ok', status: 'reviewed', value: 'OK', metadata: { quality: 'review' } },
                    { key: 'common.cancel', status: 'approved', value: 'Cancel', metadata: { quality: 'approved' } },
                    { key: 'menu.play', status: 'translated', value: 'Play', metadata: { quality: 'draft' } }
                ];

                const results = this.progressTracker.batchUpdateTranslationStatus(
                    language,
                    'main-ui',
                    sampleUpdates
                );

                this.elements.progressTrackingResults.innerHTML = `
                    <div class="command-result success">
                        <div class="result-header">ğŸ“ ã‚µãƒ³ãƒ—ãƒ«é€²æ—æ›´æ–°å®Œäº†</div>
                        <div class="result-details">
                            æˆåŠŸ: ${results.successful.length} å€‹<br>
                            å¤±æ•—: ${results.failed.length} å€‹<br>
                            æ›´æ–°ã•ã‚ŒãŸã‚­ãƒ¼: ${results.successful.join(', ')}
                        </div>
                    </div>
                `;

                // é€²æ—ã‚’å†è¡¨ç¤º
                setTimeout(() => this.showLanguageProgress(), 500);
            }

            generateProgressReport() {
                const language = this.elements.reportLanguage.value;
                const format = this.elements.progressReportFormat.value;

                const report = this.progressTracker.generateProgressReport(language, {
                    format: format,
                    includeSets: true,
                    includeCategories: true,
                    includeDetails: format === 'detailed'
                });

                if (!report) {
                    this.elements.progressReportsResults.innerHTML = '<p>ã“ã®è¨€èªã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                    return;
                }

                if (format === 'csv') {
                    // CSV ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    const blob = new Blob([report], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `progress-report-${language}-${Date.now()}.csv`;
                    a.click();
                    URL.revokeObjectURL(url);

                    this.elements.progressReportsResults.innerHTML = `
                        <div class="command-result success">
                            <div class="result-header">ğŸ“„ é€²æ—CSVãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†</div>
                            <div class="result-details">ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸã€‚</div>
                        </div>
                    `;
                } else {
                    let html = `<h4>ğŸ“Š ${language} é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ</h4>`;
                    
                    if (format === 'summary') {
                        html += `
                            <div class="stats-grid">
                                <div class="stats-card">
                                    <div class="value">${report.completionRate}%</div>
                                    <div class="label">å®Œæˆç‡</div>
                                </div>
                                <div class="stats-card">
                                    <div class="value">${report.qualityScore}%</div>
                                    <div class="label">å“è³ªã‚¹ã‚³ã‚¢</div>
                                </div>
                                <div class="stats-card">
                                    <div class="value">${report.totalKeys}</div>
                                    <div class="label">ç·ã‚­ãƒ¼æ•°</div>
                                </div>
                            </div>
                        `;
                    } else {
                        html += `<pre style="max-height: 400px; overflow-y: auto;">${JSON.stringify(report, null, 2)}</pre>`;
                    }
                    
                    this.elements.progressReportsResults.innerHTML = html;
                }
            }

            showAllLanguagesProgress() {
                const allProgress = this.progressTracker.getAllLanguageProgress();
                
                if (Object.keys(allProgress).length === 0) {
                    this.elements.progressReportsResults.innerHTML = '<p>é€²æ—ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                    return;
                }

                let html = '<h4>ğŸŒ å…¨è¨€èªé€²æ—ã‚µãƒãƒªãƒ¼</h4><div class="stats-grid">';
                
                for (const [language, progress] of Object.entries(allProgress)) {
                    html += `
                        <div class="stats-card">
                            <div class="value">${progress.completionRate}%</div>
                            <div class="label">${language}</div>
                            <div style="font-size: 0.8em; margin-top: 5px;">
                                å“è³ª: ${progress.qualityScore}%<br>
                                ã‚­ãƒ¼æ•°: ${progress.totalKeys}<br>
                                ã‚»ãƒƒãƒˆæ•°: ${progress.totalSets}
                            </div>
                        </div>
                    `;
                }
                
                html += '</div>';
                this.elements.progressReportsResults.innerHTML = html;
            }

            // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰
            setMilestone() {
                const language = this.elements.milestoneLanguage.value;
                const name = this.elements.milestoneName.value.trim();
                const target = parseInt(this.elements.milestoneTarget.value);

                if (!name) {
                    alert('ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                this.progressTracker.setMilestone(language, name, target, `${name} - ${target}% å®Œæˆç›®æ¨™`);

                this.elements.progressMilestonesResults.innerHTML = `
                    <div class="command-result success">
                        <div class="result-header">ğŸ¯ ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¨­å®šå®Œäº†</div>
                        <div class="result-details">
                            è¨€èª: ${language}<br>
                            åå‰: ${name}<br>
                            ç›®æ¨™: ${target}%
                        </div>
                    </div>
                `;

                this.elements.milestoneName.value = '';
            }

            showMilestones() {
                const language = this.elements.milestoneLanguage.value;
                const milestones = this.progressTracker.getMilestones(language);

                if (milestones.length === 0) {
                    this.elements.progressMilestonesResults.innerHTML = '<p>è¨­å®šã•ã‚ŒãŸãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                    return;
                }

                let html = `<h4>ğŸ¯ ${language} ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</h4>`;
                
                milestones.forEach(milestone => {
                    html += `
                        <div class="milestone-item ${milestone.achieved ? 'achieved' : ''}">
                            <div>
                                <div class="milestone-name">${milestone.name}</div>
                                <div style="font-size: 0.9em; color: #666;">
                                    ç›®æ¨™: ${milestone.targetPercentage}%
                                    ${milestone.achieved ? `| é”æˆæ—¥: ${new Date(milestone.achievedAt).toLocaleDateString('ja-JP')}` : ''}
                                </div>
                            </div>
                            <div class="milestone-progress">
                                ${milestone.achieved ? 'âœ… é”æˆ' : 'â³ æœªé”æˆ'}
                            </div>
                        </div>
                    `;
                });

                this.elements.progressMilestonesResults.innerHTML = html;
            }

            predictGoal() {
                const language = this.elements.milestoneLanguage.value;
                
                // ã‚µãƒ³ãƒ—ãƒ«ç›®æ¨™ã‚’è¨­å®šã—ã¦ã‹ã‚‰äºˆæ¸¬
                const targetDate = new Date();
                targetDate.setDate(targetDate.getDate() + 30); // 30æ—¥å¾Œ
                
                this.progressTracker.setProgressGoal(language, targetDate, 90, '90% å®Œæˆç›®æ¨™');
                
                const prediction = this.progressTracker.predictGoalAchievement(language);

                if (!prediction) {
                    this.elements.progressMilestonesResults.innerHTML = '<p>äºˆæ¸¬ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚</p>';
                    return;
                }

                const statusClass = prediction.isOnTrack ? 'success' : 'warning';
                const statusText = prediction.isOnTrack ? 'âœ… é †èª¿' : 'âš ï¸ é…ã‚Œæ°—å‘³';

                this.elements.progressMilestonesResults.innerHTML = `
                    <div class="command-result ${statusClass}">
                        <div class="result-header">ğŸ”® ç›®æ¨™é”æˆäºˆæ¸¬</div>
                        <div class="result-details">
                            ç¾åœ¨ã®é€²æ—: ${prediction.currentProgress}%<br>
                            ç›®æ¨™é€²æ—: ${prediction.targetProgress}%<br>
                            ç›®æ¨™æ—¥: ${new Date(prediction.targetDate).toLocaleDateString('ja-JP')}<br>
                            äºˆæ¸¬å®Œäº†æ—¥: ${new Date(prediction.estimatedCompletionDate).toLocaleDateString('ja-JP')}<br>
                            æ—¥æ¬¡é€²æ—ç‡: ${prediction.dailyProgressRate}%<br>
                            æ®‹ã‚Šæ—¥æ•°: ${prediction.daysToGoal} æ—¥<br>
                            çŠ¶æ…‹: ${statusText} (${prediction.daysAheadBehind > 0 ? `${prediction.daysAheadBehind}æ—¥å‰å€’ã—` : `${Math.abs(prediction.daysAheadBehind)}æ—¥é…ã‚Œ`})
                        </div>
                    </div>
                `;
            }

            // æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ãƒ¡ã‚½ãƒƒãƒ‰
            initializeValidationCommands() {
                const commands = this.validationCommands.getAvailableCommands();
                
                let html = '';
                commands.forEach(command => {
                    html += `
                        <div class="validation-command">
                            <h4>${command.displayName}</h4>
                            <div class="command-description">${command.description}</div>
                            <div class="command-options" id="options-${command.name}">
                                <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ç°¡ç•¥åŒ– -->
                            </div>
                            <button onclick="window.testUI.runValidationCommand('${command.name}')" class="secondary">
                                ${command.name} å®Ÿè¡Œ
                            </button>
                        </div>
                    `;
                });

                this.elements.validationCommands.innerHTML = html;
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ã‚¯ã‚»ã‚¹ç”¨
                window.testUI = this;
            }

            async runValidationCommand(commandName) {
                this.showLoading(true);

                try {
                    const result = await this.validationCommands.executeCommand(commandName, {
                        languages: ['en', 'zh-CN']
                    });

                    const statusClass = result.success && result.result?.passed ? 'success' : 'error';
                    const statusText = result.success && result.result?.passed ? 'âœ… åˆæ ¼' : 'âŒ å•é¡Œã‚ã‚Š';

                    let details = '';
                    if (result.result?.summary) {
                        const summary = result.result.summary;
                        details = `
                            å®Ÿè¡Œæ™‚é–“: ${result.executionTime}ms<br>
                            ${summary.totalIssues !== undefined ? `å•é¡Œæ•°: ${summary.totalIssues}` : ''}
                            ${summary.totalLanguages !== undefined ? `å¯¾è±¡è¨€èª: ${summary.totalLanguages}` : ''}
                            ${summary.passedLanguages !== undefined ? `åˆæ ¼è¨€èª: ${summary.passedLanguages}` : ''}
                            ${summary.failedLanguages !== undefined ? `ä¸åˆæ ¼è¨€èª: ${summary.failedLanguages}` : ''}
                        `;
                    }

                    this.elements.validationResults.innerHTML += `
                        <div class="command-result ${statusClass}">
                            <div class="result-header">${commandName} - ${statusText}</div>
                            <div class="result-details">${details}</div>
                        </div>
                    `;

                } catch (error) {
                    this.elements.validationResults.innerHTML += `
                        <div class="command-result error">
                            <div class="result-header">${commandName} - âŒ ã‚¨ãƒ©ãƒ¼</div>
                            <div class="result-details">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>
                        </div>
                    `;
                } finally {
                    this.showLoading(false);
                }
            }

            async runAllValidations() {
                this.showLoading(true);
                this.elements.validationResults.innerHTML = '<h4>ğŸ” çµ±åˆæ¤œè¨¼å®Ÿè¡Œä¸­...</h4>';

                try {
                    const result = await this.validationCommands.executeCommand('validate-all', {
                        languages: ['en', 'zh-CN'],
                        exitOnError: false,
                        generateReport: true
                    });

                    const statusClass = result.success && result.result?.summary?.overallPassed ? 'success' : 'error';
                    const statusText = result.success && result.result?.summary?.overallPassed ? 'âœ… å…¨æ¤œè¨¼åˆæ ¼' : 'âŒ å•é¡Œã‚ã‚Š';

                    let details = '';
                    if (result.result?.summary) {
                        const summary = result.result.summary;
                        details = `
                            å®Ÿè¡Œæ™‚é–“: ${result.executionTime}ms<br>
                            ç·ã‚³ãƒãƒ³ãƒ‰æ•°: ${summary.totalCommands}<br>
                            åˆæ ¼ã‚³ãƒãƒ³ãƒ‰: ${summary.passedCommands}<br>
                            ä¸åˆæ ¼ã‚³ãƒãƒ³ãƒ‰: ${summary.failedCommands}<br>
                            ç·å•é¡Œæ•°: ${summary.totalIssues}<br>
                            ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ: ${result.result.reportGenerated ? 'âœ…' : 'âŒ'}
                        `;
                    }

                    this.elements.validationResults.innerHTML = `
                        <div class="command-result ${statusClass}">
                            <div class="result-header">çµ±åˆæ¤œè¨¼çµæœ - ${statusText}</div>
                            <div class="result-details">${details}</div>
                        </div>
                    `;

                } catch (error) {
                    this.elements.validationResults.innerHTML = `
                        <div class="command-result error">
                            <div class="result-header">çµ±åˆæ¤œè¨¼ - âŒ ã‚¨ãƒ©ãƒ¼</div>
                            <div class="result-details">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>
                        </div>
                    `;
                } finally {
                    this.showLoading(false);
                }
            }

            async generateValidationReport() {
                this.showLoading(true);

                try {
                    const result = await this.validationCommands.executeCommand('generate-report', {
                        format: 'html',
                        includeDetails: true
                    });

                    if (result.success) {
                        // HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§è¡¨ç¤º
                        const newWindow = window.open('', '_blank');
                        newWindow.document.write(result.result.content);
                        newWindow.document.close();

                        this.elements.validationResults.innerHTML += `
                            <div class="command-result success">
                                <div class="result-header">ğŸ“Š æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†</div>
                                <div class="result-details">
                                    å½¢å¼: ${result.result.format}<br>
                                    ã‚µã‚¤ã‚º: ${Math.round(result.result.size / 1024)} KB<br>
                                    ãƒ¬ãƒãƒ¼ãƒˆãŒæ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ã‹ã‚Œã¾ã—ãŸã€‚
                                </div>
                            </div>
                        `;
                    }

                } catch (error) {
                    this.elements.validationResults.innerHTML += `
                        <div class="command-result error">
                            <div class="result-header">ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ - âŒ ã‚¨ãƒ©ãƒ¼</div>
                            <div class="result-details">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>
                        </div>
                    `;
                } finally {
                    this.showLoading(false);
                }
            }

            clearValidationResults() {
                this.elements.validationResults.innerHTML = '<p>æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>';
            }

            // åˆæœŸåŒ–ãƒ¡ã‚½ãƒƒãƒ‰
            loadSampleData() {
                // åŸºæœ¬çš„ãªã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                setTimeout(() => {
                    this.loadSampleKeys();
                    this.loadSampleProgress();
                }, 1000);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            new TranslationManagementTestUI();
        });
    </script>
</body>
</html>