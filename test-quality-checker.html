<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translation Quality Checker Test - BubblePop</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }

        .section h2 {
            color: #2c3e50;
            margin-top: 0;
        }

        .test-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }

        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
            align-items: center;
        }

        button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        button:hover:not(:disabled) {
            background: #2980b9;
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        button.secondary {
            background: #95a5a6;
        }

        button.secondary:hover:not(:disabled) {
            background: #7f8c8d;
        }

        button.success {
            background: #27ae60;
        }

        button.success:hover:not(:disabled) {
            background: #229954;
        }

        button.danger {
            background: #e74c3c;
        }

        button.danger:hover:not(:disabled) {
            background: #c0392b;
        }

        .results-area {
            margin: 30px 0;
            min-height: 200px;
        }

        .validation-results {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .validation-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .summary-card {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .summary-card .value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-card .label {
            font-size: 0.9em;
            color: #666;
        }

        .summary-card.score {
            border-left: 4px solid #3498db;
        }

        .summary-card.errors {
            border-left: 4px solid #e74c3c;
        }

        .summary-card.warnings {
            border-left: 4px solid #f39c12;
        }

        .summary-card.passed {
            border-left: 4px solid #27ae60;
        }

        .quality-grade {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
            margin: 10px 0;
        }

        .grade-excellent { background: #27ae60; }
        .grade-good { background: #f39c12; }
        .grade-acceptable { background: #e67e22; }
        .grade-poor { background: #e74c3c; }
        .grade-unacceptable { background: #8e44ad; }

        .issues-section {
            margin: 20px 0;
        }

        .issues-category {
            margin: 15px 0;
        }

        .issues-category h4 {
            margin: 10px 0 5px 0;
            color: #2c3e50;
        }

        .issue-item {
            margin: 8px 0;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #ddd;
        }

        .issue-item.error {
            background: #fee;
            border-left-color: #e74c3c;
        }

        .issue-item.warning {
            background: #fff8e1;
            border-left-color: #f39c12;
        }

        .issue-item.passed {
            background: #e8f5e8;
            border-left-color: #27ae60;
        }

        .issue-header {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .issue-message {
            margin: 8px 0;
            color: #444;
        }

        .issue-suggestion {
            background: rgba(52, 152, 219, 0.1);
            padding: 8px;
            border-radius: 4px;
            font-size: 0.9em;
            margin-top: 8px;
        }

        .report-section {
            margin: 30px 0;
        }

        .report-frame {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .test-samples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .sample-card {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sample-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .sample-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .sample-card .sample-text {
            font-size: 0.9em;
            color: #666;
            margin: 5px 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-info {
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            margin: 20px 0;
        }

        .status-info h4 {
            margin: 0 0 10px 0;
            color: #155724;
        }

        .rules-config {
            margin: 20px 0;
        }

        .rule-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .rule-item input[type="checkbox"] {
            margin-right: 10px;
        }

        .rule-item .rule-name {
            flex: 1;
            font-weight: 500;
        }

        .rule-item .rule-description {
            flex: 2;
            font-size: 0.9em;
            color: #666;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin: 20px 0 0 0;
        }

        .tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            border-bottom-color: #3498db;
            color: #3498db;
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç¿»è¨³å“è³ªç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</h1>
        <p>BubblePop ã®ç¿»è¨³å“è³ªç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§ã™ã€‚ç¿»è¨³ã®å“è³ªãƒã‚§ãƒƒã‚¯ã€ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã€æ¤œè¨¼ãƒ«ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆãŒã§ãã¾ã™ã€‚</p>

        <!-- ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«é¸æŠ -->
        <div class="section">
            <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«</h2>
            <p>ä»¥ä¸‹ã®ã‚µãƒ³ãƒ—ãƒ«ã‹ã‚‰é¸æŠã—ã¦ãƒ†ã‚¹ãƒˆã§ãã¾ã™ï¼š</p>
            
            <div class="test-samples" id="testSamples">
                <div class="sample-card" data-sample="good-translation">
                    <h4>âœ… è‰¯å¥½ãªç¿»è¨³</h4>
                    <div class="sample-text">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€é•·ã•ãŒé©åˆ‡ãªç¿»è¨³ä¾‹</div>
                </div>
                <div class="sample-card" data-sample="parameter-error">
                    <h4>âŒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼</h4>
                    <div class="sample-text">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã‚‹ç¿»è¨³ä¾‹</div>
                </div>
                <div class="sample-card" data-sample="format-error">
                    <h4>âŒ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼</h4>
                    <div class="sample-text">HTMLã‚¿ã‚°ã‚„ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãŒæ¬ ã‘ã¦ã„ã‚‹ç¿»è¨³ä¾‹</div>
                </div>
                <div class="sample-card" data-sample="length-warning">
                    <h4>âš ï¸ é•·ã•è­¦å‘Š</h4>
                    <div class="sample-text">ç¿»è¨³ãŒé•·ã™ãã‚‹/çŸ­ã™ãã‚‹ä¾‹</div>
                </div>
                <div class="sample-card" data-sample="cultural-warning">
                    <h4>âš ï¸ æ–‡åŒ–çš„é…æ…®</h4>
                    <div class="sample-text">æ–‡åŒ–çš„ã«ä¸é©åˆ‡ãªè¡¨ç¾ã‚’å«ã‚€ä¾‹</div>
                </div>
                <div class="sample-card" data-sample="incomplete-error">
                    <h4>âŒ æœªå®Œæˆç¿»è¨³</h4>
                    <div class="sample-text">æœªç¿»è¨³ãƒãƒ¼ã‚«ãƒ¼ã‚„ç©ºæ–‡å­—ã‚’å«ã‚€ä¾‹</div>
                </div>
            </div>
        </div>

        <!-- ç¿»è¨³å…¥åŠ›ã‚¨ãƒªã‚¢ -->
        <div class="section">
            <h2>âœï¸ ç¿»è¨³ãƒ†ã‚¹ãƒˆå…¥åŠ›</h2>
            
            <div class="test-area">
                <div class="input-group">
                    <label for="sourceText">åŸæ–‡ï¼ˆæ—¥æœ¬èªï¼‰</label>
                    <textarea id="sourceText" placeholder="ãƒã‚§ãƒƒã‚¯ã—ãŸã„åŸæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>
                <div class="input-group">
                    <label for="translationText">ç¿»è¨³æ–‡</label>
                    <textarea id="translationText" placeholder="å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ç¿»è¨³æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>
            </div>

            <div class="input-group">
                <label for="targetLanguage">å¯¾è±¡è¨€èª</label>
                <select id="targetLanguage">
                    <option value="en">English</option>
                    <option value="zh-CN">ç®€ä½“ä¸­æ–‡ (Simplified Chinese)</option>
                    <option value="zh-TW">ç¹é«”ä¸­æ–‡ (Traditional Chinese)</option>
                    <option value="ko">í•œêµ­ì–´ (Korean)</option>
                </select>
            </div>

            <div class="input-group">
                <label for="translationKey">ç¿»è¨³ã‚­ãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
                <input type="text" id="translationKey" placeholder="ä¾‹: menu.play, game.score">
            </div>

            <div class="controls">
                <button id="runQualityCheck">å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ</button>
                <button id="generateReport" class="secondary">è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                <button id="generateCsvReport" class="secondary">CSVå‡ºåŠ›</button>
                <button id="clearResults" class="danger">çµæœã‚¯ãƒªã‚¢</button>
            </div>
        </div>

        <!-- æ¤œè¨¼ãƒ«ãƒ¼ãƒ«è¨­å®š -->
        <div class="section">
            <h2>âš™ï¸ æ¤œè¨¼ãƒ«ãƒ¼ãƒ«è¨­å®š</h2>
            
            <div class="rules-config" id="rulesConfig">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="section">
            <h2>ğŸ“Š æ¤œè¨¼çµæœ</h2>
            
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p>å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­...</p>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="summary">ã‚µãƒãƒªãƒ¼</button>
                <button class="tab" data-tab="issues">å•é¡Œè©³ç´°</button>
                <button class="tab" data-tab="report">ãƒ¬ãƒãƒ¼ãƒˆ</button>
                <button class="tab" data-tab="stats">çµ±è¨ˆ</button>
            </div>

            <div class="tab-content active" id="summary-tab">
                <div id="validationSummary">
                    <p>å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <div class="tab-content" id="issues-tab">
                <div id="validationIssues">
                    <p>å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å•é¡Œã®è©³ç´°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                </div>
            </div>

            <div class="tab-content" id="report-tab">
                <div id="qualityReport">
                    <p>è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <div class="tab-content" id="stats-tab">
                <div id="qualityStats">
                    <p>å“è³ªãƒã‚§ãƒƒã‚¯ã®çµ±è¨ˆæƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                </div>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ± -->
        <div class="status-info">
            <h4>ğŸ’¡ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h4>
            <div id="systemStatus">
                ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ä¸­...
            </div>
        </div>
    </div>

    <script type="module">
        import { getQualityChecker } from './src/core/i18n/quality/QualityChecker.js';
        import { getQualityReporter } from './src/core/i18n/quality/QualityReporter.js';
        import { validationRuleFactory } from './src/core/i18n/quality/ValidationRules.js';

        class QualityCheckerTestUI {
            constructor() {
                this.qualityChecker = getQualityChecker();
                this.qualityReporter = getQualityReporter();
                this.validationRuleFactory = validationRuleFactory;
                this.currentResults = null;
                
                this.initializeElements();
                this.setupEventListeners();
                this.initializeRulesConfig();
                this.initializeTestSamples();
                this.updateSystemStatus();
            }

            initializeElements() {
                this.elements = {
                    sourceText: document.getElementById('sourceText'),
                    translationText: document.getElementById('translationText'),
                    targetLanguage: document.getElementById('targetLanguage'),
                    translationKey: document.getElementById('translationKey'),
                    runQualityCheck: document.getElementById('runQualityCheck'),
                    generateReport: document.getElementById('generateReport'),
                    generateCsvReport: document.getElementById('generateCsvReport'),
                    clearResults: document.getElementById('clearResults'),
                    rulesConfig: document.getElementById('rulesConfig'),
                    loadingIndicator: document.getElementById('loadingIndicator'),
                    validationSummary: document.getElementById('validationSummary'),
                    validationIssues: document.getElementById('validationIssues'),
                    qualityReport: document.getElementById('qualityReport'),
                    qualityStats: document.getElementById('qualityStats'),
                    systemStatus: document.getElementById('systemStatus'),
                    testSamples: document.getElementById('testSamples')
                };
            }

            setupEventListeners() {
                // ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³
                this.elements.runQualityCheck.addEventListener('click', () => this.runQualityCheck());
                this.elements.generateReport.addEventListener('click', () => this.generateDetailedReport());
                this.elements.generateCsvReport.addEventListener('click', () => this.generateCSVReport());
                this.elements.clearResults.addEventListener('click', () => this.clearResults());

                // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
                });

                // ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«é¸æŠ
                this.elements.testSamples.addEventListener('click', (e) => {
                    const sampleCard = e.target.closest('.sample-card');
                    if (sampleCard) {
                        this.loadTestSample(sampleCard.dataset.sample);
                    }
                });
            }

            initializeRulesConfig() {
                const rules = [
                    { id: 'parameterConsistency', name: 'ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯', description: 'ç¿»è¨³æ–‡ä¸­ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒåŸæ–‡ã¨ä¸€è‡´ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯', enabled: true },
                    { id: 'lengthValidation', name: 'ç¿»è¨³é•·åˆ¶é™ãƒã‚§ãƒƒã‚¯', description: 'ç¿»è¨³æ–‡ã®é•·ã•ãŒé©åˆ‡ãªç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯', enabled: true },
                    { id: 'formatValidation', name: 'ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼', description: 'HTMLè¦ç´ ã€ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ç­‰ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯', enabled: true },
                    { id: 'culturalAppropriateness', name: 'æ–‡åŒ–çš„é©åˆ‡æ€§ãƒã‚§ãƒƒã‚¯', description: 'æ–‡åŒ–çš„ã«ä¸é©åˆ‡ãªè¡¨ç¾ã‚„èª¤è§£ã‚’æ‹›ãè¡¨ç¾ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯', enabled: true },
                    { id: 'completenessCheck', name: 'ç¿»è¨³å®Œæˆåº¦ãƒã‚§ãƒƒã‚¯', description: 'ç©ºæ–‡å­—ã‚„æœªç¿»è¨³ã®é …ç›®ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯', enabled: true },
                    { id: 'consistencyCheck', name: 'ç¿»è¨³ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯', description: 'ç¿»è¨³ã®ä¸€è²«æ€§ã‚’ãƒã‚§ãƒƒã‚¯', enabled: true }
                ];

                let html = '';
                rules.forEach(rule => {
                    html += `
                        <div class="rule-item">
                            <input type="checkbox" id="rule-${rule.id}" ${rule.enabled ? 'checked' : ''}>
                            <div class="rule-name">${rule.name}</div>
                            <div class="rule-description">${rule.description}</div>
                        </div>
                    `;
                });

                this.elements.rulesConfig.innerHTML = html;
            }

            initializeTestSamples() {
                this.testSamples = {
                    'good-translation': {
                        source: 'ã‚ãªãŸã®ã‚¹ã‚³ã‚¢ã¯ {score} ç‚¹ã§ã™ã€‚**ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼**',
                        translation: 'Your score is {score} points. **Congratulations!**',
                        key: 'game.score_message',
                        targetLanguage: 'en'
                    },
                    'parameter-error': {
                        source: 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ {player} ãŒ {points} ãƒã‚¤ãƒ³ãƒˆç²å¾—ã—ã¾ã—ãŸã€‚',
                        translation: 'Player gained points.',
                        key: 'game.player_points',
                        targetLanguage: 'en'
                    },
                    'format-error': {
                        source: '<strong>é‡è¦</strong>: ã“ã®æ“ä½œã¯**å–ã‚Šæ¶ˆã›ã¾ã›ã‚“**ã€‚',
                        translation: 'é‡è¦: This operation cannot be undone.',
                        key: 'common.warning',
                        targetLanguage: 'en'
                    },
                    'length-warning': {
                        source: 'OK',
                        translation: 'This is an extremely long translation that is way too verbose for such a simple original text and should probably be shortened significantly.',
                        key: 'common.ok',
                        targetLanguage: 'en'
                    },
                    'cultural-warning': {
                        source: 'ã‚¢ã‚¸ã‚¢ç³»ã®æ–‡åŒ–ã«ã¤ã„ã¦å­¦ã³ã¾ã—ã‚‡ã†ã€‚',
                        translation: 'Let us learn about oriental culture.',
                        key: 'education.culture',
                        targetLanguage: 'en'
                    },
                    'incomplete-error': {
                        source: 'ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹',
                        translation: 'TODO: Start the game',
                        key: 'menu.start_game',
                        targetLanguage: 'en'
                    }
                };
            }

            loadTestSample(sampleId) {
                const sample = this.testSamples[sampleId];
                if (!sample) return;

                this.elements.sourceText.value = sample.source;
                this.elements.translationText.value = sample.translation;
                this.elements.translationKey.value = sample.key;
                this.elements.targetLanguage.value = sample.targetLanguage;

                // ãƒã‚¤ãƒ©ã‚¤ãƒˆåŠ¹æœ
                const sampleCard = document.querySelector(`[data-sample="${sampleId}"]`);
                if (sampleCard) {
                    sampleCard.style.background = '#e3f2fd';
                    setTimeout(() => {
                        sampleCard.style.background = '';
                    }, 1000);
                }
            }

            async runQualityCheck() {
                const sourceText = this.elements.sourceText.value.trim();
                const translationText = this.elements.translationText.value.trim();
                const targetLanguage = this.elements.targetLanguage.value;
                const translationKey = this.elements.translationKey.value.trim() || 'test.key';

                if (!sourceText || !translationText) {
                    alert('åŸæ–‡ã¨ç¿»è¨³æ–‡ã®ä¸¡æ–¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                this.showLoading(true);

                try {
                    // ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã‚’æ§‹æˆ
                    const translations = {
                        [translationKey]: translationText
                    };

                    // å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
                    const results = await this.qualityChecker.validateTranslations(
                        translations,
                        'ja',
                        targetLanguage
                    );

                    this.currentResults = results;
                    this.displayResults(results);
                    this.switchTab('summary');

                } catch (error) {
                    console.error('Quality check error:', error);
                    alert(`å“è³ªãƒã‚§ãƒƒã‚¯ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            async generateDetailedReport() {
                if (!this.currentResults) {
                    alert('å…ˆã«å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                this.showLoading(true);

                try {
                    const reportResult = this.qualityReporter.generateComprehensiveReport(
                        this.currentResults,
                        { template: 'detailed' }
                    );

                    this.displayReport(reportResult.report);
                    this.switchTab('report');

                } catch (error) {
                    console.error('Report generation error:', error);
                    alert(`ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            async generateCSVReport() {
                if (!this.currentResults) {
                    alert('å…ˆã«å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                try {
                    const reportResult = this.qualityReporter.generateComprehensiveReport(
                        this.currentResults,
                        { template: 'csv' }
                    );

                    // CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    const blob = new Blob([reportResult.report], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `quality-report-${this.currentResults.language}-${Date.now()}.csv`;
                    a.click();
                    URL.revokeObjectURL(url);

                } catch (error) {
                    console.error('CSV generation error:', error);
                    alert(`CSVç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
                }
            }

            displayResults(results) {
                this.displaySummary(results);
                this.displayIssues(results);
                this.displayStats();
            }

            displaySummary(results) {
                const qualityGradeClass = `grade-${results.qualityGrade}`;
                const qualityGradeText = this.getQualityGradeText(results.qualityGrade);

                this.elements.validationSummary.innerHTML = `
                    <div class="validation-summary">
                        <div class="summary-card score">
                            <div class="value">${results.qualityScore}</div>
                            <div class="label">å“è³ªã‚¹ã‚³ã‚¢</div>
                        </div>
                        <div class="summary-card errors">
                            <div class="value">${results.errors.length}</div>
                            <div class="label">ã‚¨ãƒ©ãƒ¼</div>
                        </div>
                        <div class="summary-card warnings">
                            <div class="value">${results.warnings.length}</div>
                            <div class="label">è­¦å‘Š</div>
                        </div>
                        <div class="summary-card passed">
                            <div class="value">${results.passed.length}</div>
                            <div class="label">åˆæ ¼</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div class="quality-grade ${qualityGradeClass}">${qualityGradeText}</div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <p><strong>è¨€èª:</strong> ${results.language}</p>
                        <p><strong>ãƒã‚§ãƒƒã‚¯é …ç›®:</strong> ${results.checkedItems} / ${results.totalItems}</p>
                        <p><strong>æ¤œè¨¼å®Œäº†æ™‚åˆ»:</strong> ${new Date(results.timestamp).toLocaleString('ja-JP')}</p>
                    </div>
                `;
            }

            displayIssues(results) {
                let html = '';

                if (results.errors.length > 0) {
                    html += '<div class="issues-category"><h4>ğŸ”´ ã‚¨ãƒ©ãƒ¼</h4>';
                    results.errors.forEach(error => {
                        html += this.renderIssueItem(error, 'error');
                    });
                    html += '</div>';
                }

                if (results.warnings.length > 0) {
                    html += '<div class="issues-category"><h4>ğŸŸ¡ è­¦å‘Š</h4>';
                    results.warnings.forEach(warning => {
                        html += this.renderIssueItem(warning, 'warning');
                    });
                    html += '</div>';
                }

                if (results.passed.length > 0) {
                    html += '<div class="issues-category"><h4>âœ… åˆæ ¼</h4>';
                    results.passed.slice(0, 10).forEach(passed => { // æœ€åˆã®10å€‹ã®ã¿è¡¨ç¤º
                        html += this.renderIssueItem(passed, 'passed');
                    });
                    if (results.passed.length > 10) {
                        html += `<p style="text-align: center; color: #666;">ä»– ${results.passed.length - 10} å€‹ã®åˆæ ¼é …ç›®ãŒã‚ã‚Šã¾ã™ã€‚</p>`;
                    }
                    html += '</div>';
                }

                this.elements.validationIssues.innerHTML = html || '<p>å•é¡Œã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
            }

            renderIssueItem(issue, type) {
                return `
                    <div class="issue-item ${type}">
                        <div class="issue-header">${issue.name || this.getRuleDisplayName(issue.rule)}</div>
                        <div class="issue-message">${issue.message}</div>
                        ${issue.suggestion ? `<div class="issue-suggestion">ğŸ’¡ ${issue.suggestion}</div>` : ''}
                    </div>
                `;
            }

            displayReport(reportHtml) {
                this.elements.qualityReport.innerHTML = `
                    <div style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden;">
                        <iframe srcdoc="${reportHtml.replace(/"/g, '&quot;')}" 
                                style="width: 100%; height: 600px; border: none;">
                        </iframe>
                    </div>
                `;
            }

            displayStats() {
                const stats = this.qualityChecker.getStats();
                const reporterStats = this.qualityReporter.getStats();

                this.elements.qualityStats.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4>å“è³ªãƒã‚§ãƒƒã‚«ãƒ¼çµ±è¨ˆ</h4>
                            <ul>
                                <li>ç·ãƒã‚§ãƒƒã‚¯æ•°: ${stats.totalChecks}</li>
                                <li>åˆæ ¼æ•°: ${stats.passedChecks}</li>
                                <li>å¤±æ•—æ•°: ${stats.failedChecks}</li>
                                <li>è­¦å‘Šæ•°: ${stats.warnings}</li>
                                <li>æœ‰åŠ¹ãƒ«ãƒ¼ãƒ«æ•°: ${stats.activeRules.length}</li>
                            </ul>
                        </div>
                        <div>
                            <h4>ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼çµ±è¨ˆ</h4>
                            <ul>
                                <li>ç”Ÿæˆãƒ¬ãƒãƒ¼ãƒˆæ•°: ${reporterStats.totalReports}</li>
                                <li>è¿½è·¡è¨€èªæ•°: ${reporterStats.languagesTracked}</li>
                                <li>åˆ©ç”¨å¯èƒ½ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: ${reporterStats.availableTemplates.join(', ')}</li>
                                <li>å¹³å‡å“è³ªã‚¹ã‚³ã‚¢: ${reporterStats.averageQualityScore}</li>
                            </ul>
                        </div>
                    </div>
                `;
            }

            switchTab(tabName) {
                // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            }

            showLoading(show) {
                this.elements.loadingIndicator.classList.toggle('show', show);
                this.elements.runQualityCheck.disabled = show;
                this.elements.generateReport.disabled = show;
                this.elements.generateCsvReport.disabled = show;
            }

            clearResults() {
                this.currentResults = null;
                this.elements.validationSummary.innerHTML = '<p>å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>';
                this.elements.validationIssues.innerHTML = '<p>å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å•é¡Œã®è©³ç´°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>';
                this.elements.qualityReport.innerHTML = '<p>è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚</p>';
                this.elements.qualityStats.innerHTML = '<p>å“è³ªãƒã‚§ãƒƒã‚¯ã®çµ±è¨ˆæƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>';
                this.switchTab('summary');
            }

            updateSystemStatus() {
                const checkerStats = this.qualityChecker.getStats();
                const availableRules = this.validationRuleFactory.getAvailableRuleTypes();

                this.elements.systemStatus.innerHTML = `
                    <p><strong>å“è³ªãƒã‚§ãƒƒã‚«ãƒ¼:</strong> åˆæœŸåŒ–å®Œäº†</p>
                    <p><strong>åˆ©ç”¨å¯èƒ½æ¤œè¨¼ãƒ«ãƒ¼ãƒ«:</strong> ${availableRules.length} å€‹</p>
                    <p><strong>å“è³ªãƒ¬ãƒãƒ¼ã‚¿ãƒ¼:</strong> åˆæœŸåŒ–å®Œäº†</p>
                    <p><strong>ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«:</strong> ${Object.keys(this.testSamples).length} å€‹</p>
                `;
            }

            // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
            getQualityGradeText(grade) {
                const grades = {
                    excellent: 'å„ªç§€',
                    good: 'è‰¯å¥½',
                    acceptable: 'å¯',
                    poor: 'ä¸è‰¯',
                    unacceptable: 'ä¸å¯'
                };
                return grades[grade] || grade;
            }

            getRuleDisplayName(rule) {
                const names = {
                    parameterConsistency: 'ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•´åˆæ€§',
                    lengthValidation: 'é•·ã•æ¤œè¨¼',
                    formatValidation: 'ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼',
                    culturalAppropriateness: 'æ–‡åŒ–çš„é©åˆ‡æ€§',
                    completenessCheck: 'å®Œæˆåº¦ãƒã‚§ãƒƒã‚¯',
                    consistencyCheck: 'ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯'
                };
                return names[rule] || rule;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            new QualityCheckerTestUI();
        });
    </script>
</body>
</html>