<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€å°å‹•ä½œãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #2c3e50;
            color: white;
            font-family: monospace;
        }
        
        canvas {
            border: 2px solid #e74c3c;
            background: #34495e;
            display: block;
            margin: 20px 0;
        }
        
        button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: monospace;
        }
        
        #log {
            background: #1a1a1a;
            padding: 10px;
            border: 1px solid #555;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ® æœ€å°å‹•ä½œãƒ†ã‚¹ãƒˆ</h1>
    
    <canvas id="gameCanvas" width="600" height="400"></canvas>
    
    <div>
        <button onclick="testGameEngine()">GameEngineãƒ†ã‚¹ãƒˆ</button>
        <button onclick="spawnTestBubbles()">ãƒãƒ–ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>
    
    <div id="log">ãƒ­ã‚°å‡ºåŠ›...<br></div>

    <script type="module">
        let gameEngine = null;
        const logDiv = document.getElementById('log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        window.clearLog = function() {
            logDiv.innerHTML = 'ãƒ­ã‚°ã‚¯ãƒªã‚¢<br>';
        };
        
        window.testGameEngine = async function() {
            try {
                log('=== GameEngineãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
                
                // ES6ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ
                log('GameEngineã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...');
                const { GameEngine } = await import('./src/core/GameEngine.js');
                log('âœ“ GameEngineã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ');
                
                // GameEngineåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                log('GameEngineåˆæœŸåŒ–ä¸­...');
                const canvas = document.getElementById('gameCanvas');
                gameEngine = new GameEngine(canvas);
                log('âœ“ GameEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ');
                
                // start()ãƒ¡ã‚½ãƒƒãƒ‰ãƒ†ã‚¹ãƒˆ
                log('GameEngine.start()å®Ÿè¡Œä¸­...');
                gameEngine.start();
                log('âœ“ GameEngineé–‹å§‹æˆåŠŸ');
                
                // åŸºæœ¬çŠ¶æ…‹ç¢ºèª
                log(`- isRunning: ${gameEngine.isRunning}`);
                log(`- canvas: ${!!gameEngine.canvas}`);
                log(`- bubbleManager: ${!!gameEngine.bubbleManager}`);
                
                log('=== GameEngineãƒ†ã‚¹ãƒˆå®Œäº† ===');
                
            } catch (error) {
                log(`âŒ GameEngineãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('GameEngineãƒ†ã‚¹ãƒˆè©³ç´°:', error);
            }
        };
        
        window.spawnTestBubbles = function() {
            try {
                log('=== ãƒãƒ–ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
                
                if (!gameEngine) {
                    log('âŒ GameEngineãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }
                
                if (!gameEngine.bubbleManager) {
                    log('âŒ BubbleManagerãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    return;
                }
                
                // å˜ç´”ãªãƒãƒ–ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆ
                log('ãƒãƒ–ãƒ«ç”Ÿæˆä¸­...');
                
                for (let i = 0; i < 3; i++) {
                    const x = 100 + (i * 150);
                    const y = 100 + (Math.random() * 200);
                    
                    try {
                        const bubble = gameEngine.bubbleManager.spawnBubble('normal', { x, y });
                        if (bubble) {
                            log(`âœ“ ãƒãƒ–ãƒ«${i+1}ç”ŸæˆæˆåŠŸ (${x}, ${y})`);
                        } else {
                            log(`âš  ãƒãƒ–ãƒ«${i+1}ç”Ÿæˆå¤±æ•— (æˆ»ã‚Šå€¤null)`);
                        }
                    } catch (bubbleError) {
                        log(`âŒ ãƒãƒ–ãƒ«${i+1}ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${bubbleError.message}`);
                    }
                }
                
                // ãƒãƒ–ãƒ«æ•°ç¢ºèª
                try {
                    const bubbleCount = gameEngine.bubbleManager.getBubbleCount();
                    log(`ç¾åœ¨ã®ãƒãƒ–ãƒ«æ•°: ${bubbleCount}`);
                } catch (countError) {
                    log(`ãƒãƒ–ãƒ«æ•°å–å¾—ã‚¨ãƒ©ãƒ¼: ${countError.message}`);
                }
                
                log('=== ãƒãƒ–ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆå®Œäº† ===');
                
            } catch (error) {
                log(`âŒ ãƒãƒ–ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆå…¨ä½“ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('ãƒãƒ–ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆè©³ç´°:', error);
            }
        };
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº† - ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
    </script>
</body>
</html>