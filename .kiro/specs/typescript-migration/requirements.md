# TypeScript導入 - 要件定義書

## 概要

BubblePopゲームプロジェクトにTypeScriptを導入し、未定義の関数呼び出しエラーや型関連のバグを防止する。ソースコードとテストコードのみを対象とし、設定ファイルは.jsのまま維持する。

## 要件

### 要件1: TypeScript環境の構築

**ユーザーストーリー:** 開発者として、TypeScriptの型チェック機能を使用して未定義の関数呼び出しを検出できるようにしたい。

#### 受入基準
1. WHEN TypeScript設定ファイル（tsconfig.json）を作成 THEN プロジェクト全体でTypeScriptの型チェックが有効になる
2. WHEN package.jsonにTypeScript関連の依存関係を追加 THEN 開発環境でTypeScriptが使用可能になる
3. WHEN Viteの設定を更新 THEN TypeScriptファイルがビルド対象に含まれる
4. WHEN Jestの設定を更新 THEN TypeScriptテストファイルが実行可能になる

### 要件2: ソースコードのTypeScript変換

**ユーザーストーリー:** 開発者として、すべてのソースコード（src/**/*.js）をTypeScript（.ts）に変換して型安全性を確保したい。

#### 受入基準
1. WHEN src/ディレクトリ内の.jsファイルを.tsに変換 THEN 型チェックが適用される
2. WHEN 各クラスに適切な型定義を追加 THEN プロパティとメソッドの型が明確になる
3. WHEN インポート文を更新 THEN .tsファイル間の依存関係が正しく解決される
4. WHEN 未定義の関数呼び出しが存在 THEN TypeScriptコンパイラがエラーを報告する

### 要件3: テストコードのTypeScript変換

**ユーザーストーリー:** 開発者として、すべてのテストコード（tests/**/*.js, test/**/*.js）をTypeScript（.ts）に変換してテストの型安全性を確保したい。

#### 受入基準
1. WHEN tests/ディレクトリとtest/ディレクトリ内の.jsファイルを.tsに変換 THEN テストで型チェックが適用される
2. WHEN テストファイルにJestの型定義を追加 THEN テスト関数の型が正しく認識される
3. WHEN モックオブジェクトに型定義を追加 THEN モックの型安全性が確保される
4. WHEN テストが実行される THEN TypeScriptで書かれたテストが正常に動作する

### 要件4: 型定義の作成

**ユーザーストーリー:** 開発者として、すべてのクラスとインターフェースに適切な型定義を追加して、anyの使用を最小限に抑えたい。

#### 受入基準
1. WHEN 各クラスのプロパティに型注釈を追加 THEN プロパティの型が明確になる
2. WHEN メソッドの引数と戻り値に型注釈を追加 THEN メソッドの契約が明確になる
3. WHEN インターフェースを定義 THEN オブジェクトの構造が型レベルで保証される
4. WHEN anyの使用を避ける THEN 型安全性が最大化される

### 要件5: 設定ファイルの除外

**ユーザーストーリー:** 開発者として、設定ファイルは.jsのまま維持して、ビルドツールチェーンとの互換性を保ちたい。

#### 受入基準
1. WHEN vite.config.js, jest.config.js, playwright.config.jsを確認 THEN これらのファイルは.jsのまま維持される
2. WHEN scripts/ディレクトリのファイルを確認 THEN ビルドスクリプトは.jsのまま維持される
3. WHEN deploy.config.jsなどの設定ファイルを確認 THEN 設定ファイルは.jsのまま維持される
4. WHEN TypeScriptコンパイルを実行 THEN 設定ファイルは対象外として処理される

### 要件6: 段階的移行の実装

**ユーザーストーリー:** 開発者として、段階的にファイルを移行して、各段階で動作確認を行いたい。

#### 受入基準
1. WHEN コアシステムファイルを最初に移行 THEN 基本的な型チェックが機能する
2. WHEN 各移行段階でビルドテストを実行 THEN 移行による破綻がないことを確認できる
3. WHEN 依存関係の順序を考慮して移行 THEN 循環依存や未解決の参照を避けられる
4. WHEN 移行完了後にすべてのテストを実行 THEN 機能が正常に動作することを確認できる

### 要件7: 未実装処理の実装

**ユーザーストーリー:** 開発者として、TypeScript移行中に発見された未実装の処理を、次のタスクに回さずにその場で実装したい。

#### 受入基準
1. WHEN 未定義の関数呼び出しが発見される THEN その場で関数を実装する
2. WHEN 未定義の変数参照が発見される THEN 適切な初期化処理を追加する
3. WHEN 型エラーが発生 THEN 適切な型定義または実装を追加する
4. WHEN 未実装のメソッドが発見される THEN 基本的な実装を追加する

### 要件8: ビルドとテストの継続性

**ユーザーストーリー:** 開発者として、TypeScript移行後もすべてのビルドとテストが正常に動作することを確認したい。

#### 受入基準
1. WHEN `npm run build`を実行 THEN TypeScriptファイルが正常にビルドされる
2. WHEN `npm run test`を実行 THEN すべてのテストが正常に実行される
3. WHEN `npm run dev`を実行 THEN 開発サーバーが正常に起動する
4. WHEN Playwrightテストを実行 THEN E2Eテストが正常に動作する