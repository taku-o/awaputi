# TypeScript導入 - 実装タスクリスト

## ⚠️ 重要な実態について（2025-08-16発見）

**TypeScript移行の実際の進捗状況**:
- srcディレクトリに**741個の.jsファイル**が未変換で残存
- **48個の.tsファイル**のみ変換済み（変換率**6%**）
- Phase 1-6で「完了」とマークされているが、実際には代表的なファイルのみ変換
- 大多数のファイルがまだJavaScriptのまま

**必要な作業**:
1. Phase 2-6のタスクを実際に完全実施（741個のファイル変換）
2. 各ファイルに適切な型注釈を追加
3. その後、Phase 7以降の型エラー修正に進む

## Phase 1: TypeScript環境構築

- [x] 1. TypeScript依存関係のインストール
  - TypeScript本体、型定義ファイル、ビルドツール統合の依存関係をpackage.jsonに追加
  - `npm install -D typescript @types/node @types/jest @types/jsdom ts-node`を実行
  - _要件: 1.1, 1.2_

- [x] 2. TypeScript設定ファイルの作成
  - tsconfig.jsonをプロジェクトルートに作成し、strict modeを有効化
  - tsconfig.build.jsonとtsconfig.test.jsonを作成して用途別設定を分離
  - パスマッピング設定を追加（@/*, @tests/*, @utils/*, @core/*）
  - _要件: 1.1, 1.3_

- [x] 3. Vite設定の更新
  - vite.config.jsでTypeScriptファイルの処理を有効化
  - ビルド対象に.tsファイルを含める設定を追加
  - 型チェックプラグインの設定を追加
  - _要件: 1.3_

- [x] 4. Jest設定の更新
  - jest.config.jsでTypeScriptファイルのテスト実行を有効化
  - ts-jestトランスフォーマーの設定を追加
  - 型定義ファイルのセットアップを追加
  - _要件: 1.4_

- [x] 5. 基本型定義ファイルの作成
  - src/types/global.d.tsを作成してグローバル型定義を追加
  - src/types/game.d.tsを作成してゲーム関連の基本型定義を追加
  - src/types/components.d.tsを作成してコンポーネント型定義を追加
  - _要件: 4.3_

## Phase 2: コアシステムのTypeScript移行

- [ ] 6. ユーティリティシステムの移行（部分完了）
  - src/utils/内の基盤ユーティリティファイル（ErrorHandler.js, PerformanceOptimizer.js等）を.tsに変換
  - **現状**: 数個のファイルのみ変換済み、多数の.jsファイルが残存
  - 各ユーティリティクラスにプロパティとメソッドの型注釈を追加
  - インポート文を.tsファイル用に更新
  - _要件: 2.1, 2.2, 2.3_

- [ ] 7. 設定管理システムの移行（部分完了）
  - src/core/ConfigurationManager.jsを.tsに変換（完了）
  - 設定値の型定義インターフェースを作成（完了）
  - 型安全な設定アクセスメソッドを実装（完了）
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 8. ゲームエンジンコアの移行（部分完了）
  - src/core/GameEngine.jsを.tsに変換（完了）
  - GameEngineクラスの全プロパティとメソッドに型注釈を追加（完了）
  - 依存するサブコンポーネントの型定義を作成（完了）
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 9. シーン管理システムの移行（部分完了）
  - src/core/SceneManager.jsを.tsに変換（完了）
  - Sceneインターフェースを定義（完了）
  - シーン遷移メソッドの型安全性を確保（完了）
  - _要件: 2.1, 2.2, 4.3_

- [ ] 10. データ管理システムの移行（部分完了）
  - src/core/PlayerData.js, src/core/StatisticsManager.js等を.tsに変換（部分完了）
  - データモデルの型定義インターフェースを作成（部分完了）
  - データアクセスメソッドの型安全性を確保（部分完了）
  - **注意**: src/coreに多数の.jsファイルが残存
  - _要件: 2.1, 2.2, 4.1, 4.2_

## Phase 3: 管理システムのTypeScript移行

- [ ] 11. バブル管理システムの移行（部分完了）
  - src/managers/BubbleManager.jsとサブコンポーネントを.tsに変換
  - **現状**: 一部ファイルのみ変換済み、多数の.jsファイルが残存
  - Bubbleインターフェースとバブル型定義を作成
  - バブル生成・更新・描画メソッドの型注釈を追加
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 12. スコア管理システムの移行（部分完了）
  - src/managers/ScoreManager.jsを.tsに変換
  - スコア計算メソッドの型安全性を確保
  - スコアデータの型定義を作成
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 13. ステージ管理システムの移行（部分完了）
  - src/core/StageManager.jsを.tsに変換
  - ステージ設定の型定義インターフェースを作成
  - ステージ進行ロジックの型安全性を確保
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 14. アイテム・実績システムの移行（部分完了）
  - src/core/ItemSystem.js, src/core/AchievementManager.js等を.tsに変換
  - アイテムと実績の型定義インターフェースを作成
  - 進捗管理メソッドの型注釈を追加
  - _要件: 2.1, 2.2, 4.1, 4.2_

## Phase 4: UI・シーンシステムのTypeScript移行

- [ ] 15. 基本シーンクラスの移行（部分完了）
  - src/core/Scene.jsを.tsに変換
  - Sceneベースクラスの抽象メソッド定義を追加
  - シーンライフサイクルメソッドの型注釈を追加
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 16. メインメニューシーンの移行（部分完了）
  - src/scenes/MainMenuScene.jsとサブコンポーネントを.tsに変換
  - メニューアイテムの型定義を作成
  - ユーザーインタラクション処理の型安全性を確保
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 17. ゲームシーンの移行（部分完了）
  - src/scenes/GameScene.jsを.tsに変換
  - ゲーム状態の型定義インターフェースを作成
  - ゲームループ処理の型注釈を追加
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 18. 設定・ヘルプシーンの移行（部分完了）
  - src/scenes/SettingsScene.js, src/scenes/HelpScene.js等を.tsに変換
  - 設定項目とヘルプコンテンツの型定義を作成
  - UI更新処理の型安全性を確保
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 19. UIコンポーネントの移行（部分完了）
  - src/ui/内のUIコンポーネントファイルを.tsに変換
  - UIコンポーネントの共通インターフェースを定義
  - イベントハンドラーの型注釈を追加
  - _要件: 2.1, 2.2, 4.1, 4.2_

## Phase 5: エフェクト・オーディオシステムのTypeScript移行

- [ ] 20. パーティクルシステムの移行（部分完了）
  - src/effects/ParticleManager.jsとサブコンポーネントを.tsに変換
  - パーティクルの型定義インターフェースを作成
  - エフェクト生成・更新・描画メソッドの型注釈を追加
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 21. エフェクト管理システムの移行（部分完了）
  - src/effects/EffectManager.jsと関連ファイルを.tsに変換
  - エフェクト種別の型定義を作成
  - エフェクト制御メソッドの型安全性を確保
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 22. オーディオシステムの移行（部分完了）
  - src/audio/AudioManager.jsとサブコンポーネントを.tsに変換
  - オーディオリソースの型定義を作成
  - 音声再生・制御メソッドの型注釈を追加
  - _要件: 2.1, 2.2, 4.1, 4.2_

- [ ] 23. バブルシステムの移行（部分完了）
  - src/bubbles/内のバブル関連ファイルを.tsに変換
  - バブル種別とプロパティの型定義を作成
  - バブル動作ロジックの型安全性を確保
  - _要件: 2.1, 2.2, 4.1, 4.2_

## Phase 6: テストファイルのTypeScript移行

- [ ] 24. ユニットテストの移行（部分完了）
  - tests/unit/内の.jsテストファイルを.tsに変換
  - テストケースの型定義を追加
  - モックオブジェクトの型安全性を確保
  - _要件: 3.1, 3.2, 3.3_

- [ ] 25. 統合テストの移行（部分完了）
  - tests/integration/内の.jsテストファイルを.tsに変換
  - 統合テストシナリオの型定義を追加
  - テストデータの型安全性を確保
  - _要件: 3.1, 3.2, 3.3_

- [ ] 26. パフォーマンステストの移行（部分完了）
  - tests/performance/内の.jsテストファイルを.tsに変換
  - パフォーマンス測定データの型定義を追加
  - ベンチマーク処理の型注釈を追加
  - _要件: 3.1, 3.2, 3.3_

- [ ] 27. その他テストファイルの移行（部分完了）
  - test/内の.jsテストファイルを.tsに変換
  - テストユーティリティの型定義を追加
  - テスト実行環境の型安全性を確保
  - _要件: 3.1, 3.2, 3.3_

## Phase 7: 未実装機能の実装と型エラー修正

- [x] 28. 未定義関数の実装
  - TypeScriptコンパイル時に発見された未定義関数を実装
  - 関数の引数と戻り値の型を明確に定義
  - 関数の動作をテストで検証
  - _要件: 7.1, 7.4_

- [x] 29. 未定義変数の初期化
  - TypeScriptコンパイル時に発見された未定義変数を初期化
  - 変数の型を明確に定義
  - 初期化処理の妥当性を検証
  - _要件: 7.2_

- [ ] 30. 型エラーの修正（未完了）
  - TypeScriptコンパイル時に発見された型エラーを修正
  - 各エラーの原因を特定し、適切な型定義を追加
  - 型安全性を確保しながらエラーを解消
  - **注意**: 実際には多くの.jsファイルが未変換のため、先にPhase 2-6の完全実施が必要
  - _要件: 7.3_

- [ ] 31. anyの使用を最小化
  - any型の使用箇所を特定し、具体的な型に置き換え
  - 型安全性を損なわない範囲で型を厳密化
  - 型定義の完全性を検証
  - _要件: 4.4_

## Phase 8: 最終検証とテスト

- [ ] 32. TypeScriptコンパイル検証
  - 全ファイルのTypeScriptコンパイルが成功することを確認
  - コンパイルエラーと警告がないことを検証
  - ビルド時間のパフォーマンスを測定
  - _要件: 8.1_

- [ ] 33. ユニットテスト実行
  - 全ユニットテストがTypeScript環境で正常実行されることを確認
  - テストカバレッジが維持されていることを検証
  - テスト実行時間のパフォーマンスを測定
  - _要件: 8.2_

- [ ] 34. 統合テスト実行
  - 全統合テストがTypeScript環境で正常実行されることを確認
  - システム間の連携が正常に動作することを検証
  - エラーハンドリングが適切に機能することを確認
  - _要件: 8.2_

- [ ] 35. 開発サーバー動作確認
  - `npm run dev`で開発サーバーが正常起動することを確認
  - ホットリロードがTypeScriptファイルで正常動作することを検証
  - 開発時の型チェックが適切に機能することを確認
  - _要件: 8.3_

- [ ] 36. E2Eテスト実行
  - PlaywrightテストがTypeScript移行後も正常実行されることを確認
  - ゲーム機能が期待通りに動作することを検証
  - ユーザーインタラクションが正常に処理されることを確認
  - _要件: 8.4_

- [ ] 37. プロダクションビルド検証
  - `npm run build`でプロダクションビルドが成功することを確認
  - ビルド成果物のサイズと品質を検証
  - デプロイメント手順が正常に動作することを確認
  - _要件: 8.1_

- [ ] 38. パフォーマンス回帰テスト
  - TypeScript移行前後でアプリケーションパフォーマンスを比較
  - ゲーム実行時のフレームレートが維持されていることを確認
  - メモリ使用量に大きな変化がないことを検証
  - _要件: 8.1, 8.2, 8.3, 8.4_

## Phase 9: ドキュメント更新とクリーンアップ

- [ ] 39. 開発ドキュメントの更新
  - README.mdにTypeScript使用に関する情報を追加
  - 開発環境セットアップ手順をTypeScript対応版に更新
  - コーディング規約にTypeScript固有のルールを追加
  - _要件: 6.4_

- [ ] 40. 不要ファイルのクリーンアップ
  - 移行完了した.jsファイルを削除
  - 不要になった設定ファイルや一時ファイルを削除
  - gitignoreファイルをTypeScript対応版に更新
  - _要件: 6.4_