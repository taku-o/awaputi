# é©åˆ‡ãªPlaywrightãƒ†ã‚¹ãƒˆæ‰‹æ³•ç¢ºç«‹ãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025-01-15  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: Issue #163 - é‡è¤‡ãƒ˜ãƒ«ãƒ—ãƒ»è¨­å®šç”»é¢çµ±åˆ  
**ä½œæˆè€…**: Claude Code Assistant  

---

## æ¦‚è¦

Issue #163ã®çµ±åˆã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼ã«ãŠã„ã¦ã€å½“åˆã®Playwrightãƒ†ã‚¹ãƒˆãŒçµ±åˆã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿéš›ã®å‹•ä½œçŠ¶æ³ã‚’æ­£ç¢ºã«åæ˜ ã—ã¦ã„ãªã„å•é¡ŒãŒç™ºç”Ÿã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŒ‡æ‘˜ã«ã‚ˆã‚Šé©åˆ‡ãªç¢ºèªæ‰‹æ³•ã‚’ç¢ºç«‹ã—ã€çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã€‚

---

## å•é¡Œã®ç™ºç”ŸçµŒç·¯

### åˆæœŸã®ä¸é©åˆ‡ãªãƒ†ã‚¹ãƒˆæ‰‹æ³•

**å•é¡Œç‚¹**:
1. ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–å®Œäº†ã‚’é©åˆ‡ã«å¾…æ©Ÿã›ãšã€ä¸å®Œå…¨ãªçŠ¶æ…‹ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
2. åˆæœŸåŒ–ãƒ­ã‚°ã® `ğŸ‰ ã‚²ãƒ¼ãƒ åˆæœŸåŒ–å®Œäº†` ã®ç¢ºèªã‚’è¡Œã‚ãªã‹ã£ãŸ
3. JavaScriptç’°å¢ƒã§ã®çµ±åˆã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèªãŒè¡¨é¢çš„ã ã£ãŸ

**çµæœ**:
- H/F1ã‚­ãƒ¼ãŒç„¡å¿œç­”ã¨åˆ¤æ–­ï¼ˆå®Ÿéš›ã¯åˆæœŸåŒ–æœªå®Œäº†ï¼‰
- çµ±åˆã‚·ã‚¹ãƒ†ãƒ æœªå®Ÿè£…ã¨èª¤èª
- ã€Œãƒ†ã‚¹ãƒˆã¨å®Ÿè£…ã®ä¹–é›¢ã€ã¨ã„ã†é–“é•ã£ãŸçµè«–

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é‡è¦ãªæŒ‡æ‘˜

> **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ã€Œã“ã‚Œç§ã®ç’°å¢ƒã ã¨å‹•ãã‚ˆã€‚ã¤ã¾ã‚Šã€playwrightã§ã®ç¢ºèªä½œæ³•ã«å•é¡ŒãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚ã€

ã“ã®æŒ‡æ‘˜ã«ã‚ˆã‚Šã€å•é¡ŒãŒãƒ†ã‚¹ãƒˆæ‰‹æ³•ã«ã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã€‚

---

## ç¢ºç«‹ã•ã‚ŒãŸé©åˆ‡ãªæ‰‹æ³•

### 1. æ­£ã—ã„åˆæœŸåŒ–å¾…æ©Ÿãƒ—ãƒ­ã‚»ã‚¹

```javascript
// ã‚¹ãƒ†ãƒƒãƒ—1: ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
await page.getByRole('button', { name: 'ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹' }).click();

// ã‚¹ãƒ†ãƒƒãƒ—2: é©åˆ‡ãªåˆæœŸåŒ–å¾…æ©Ÿï¼ˆ3ç§’ï¼‰
await page.waitForTimeout(3000);

// ã‚¹ãƒ†ãƒƒãƒ—3: åˆæœŸåŒ–å®Œäº†ãƒ­ã‚°ã®ç¢ºèª
// [LOG] [DEBUG 1:08:23] ğŸ‰ ã‚²ãƒ¼ãƒ åˆæœŸåŒ–å®Œäº†
// [INFO] NavigationContextManager Navigation context manager initial...
// [INFO] AccessibilitySettingsManager Accessibility settings manager...
```

### 2. çµ±åˆã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã®æ­£ç¢ºãªç¢ºèª

```javascript
const gameEngineStatus = await page.evaluate(() => {
  const gameEngine = window.gameEngine;
  return {
    hasGameEngine: !!gameEngine,
    hasSceneManager: !!(gameEngine && gameEngine.sceneManager),
    currentScene: gameEngine?.sceneManager?.currentScene?.constructor?.name,
    hasKeyboardShortcutManager: !!(gameEngine && gameEngine.keyboardShortcutManager)
  };
});
```

### 3. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®é©åˆ‡ãªãƒ†ã‚¹ãƒˆ

```javascript
// Hã‚­ãƒ¼ãƒ†ã‚¹ãƒˆ
await page.keyboard.press('KeyH');
// æœŸå¾…ã•ã‚Œã‚‹ãƒ­ã‚°: [LOG] Switched to scene: help

// ESCã‚­ãƒ¼ãƒ†ã‚¹ãƒˆï¼ˆæˆ»ã‚Šæ©Ÿèƒ½ï¼‰
await page.keyboard.press('Escape');
// æœŸå¾…ã•ã‚Œã‚‹ãƒ­ã‚°: [LOG] Switched to scene: menu

// Sã‚­ãƒ¼ãƒ†ã‚¹ãƒˆ
await page.keyboard.press('KeyS');
// æœŸå¾…ã•ã‚Œã‚‹ãƒ­ã‚°: [LOG] Switched to scene: settings
```

---

## æ¤œè¨¼çµæœï¼ˆç¢ºç«‹ã•ã‚ŒãŸæ‰‹æ³•ã«ã‚ˆã‚‹ï¼‰

### âœ… çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã®æ­£å¸¸å‹•ä½œç¢ºèª

| ãƒ†ã‚¹ãƒˆé …ç›® | æ“ä½œ | æœŸå¾…å‹•ä½œ | å®Ÿéš›ã®å‹•ä½œ | çµæœ |
|-----------|------|----------|------------|------|
| **Hã‚­ãƒ¼ãƒ˜ãƒ«ãƒ—ã‚¢ã‚¯ã‚»ã‚¹** | MainMenuã§ H ã‚­ãƒ¼æŠ¼ä¸‹ | HelpSceneã«é·ç§» | `[LOG] Switched to scene: help` | âœ… **æˆåŠŸ** |
| **ESCæˆ»ã‚Šæ©Ÿèƒ½** | HelpSceneã§ ESC ã‚­ãƒ¼æŠ¼ä¸‹ | menuã«æˆ»ã‚‹ | `[LOG] Switched to scene: menu` | âœ… **æˆåŠŸ** |
| **Sã‚­ãƒ¼è¨­å®šã‚¢ã‚¯ã‚»ã‚¹** | MainMenuã§ S ã‚­ãƒ¼æŠ¼ä¸‹ | SettingsSceneã«é·ç§» | `[LOG] Switched to scene: settings` | âœ… **æˆåŠŸ** |
| **è¨­å®šã‹ã‚‰ã®ESCæˆ»ã‚Š** | SettingsSceneã§ ESC ã‚­ãƒ¼æŠ¼ä¸‹ | menuã«æˆ»ã‚‹ | `[LOG] Switched to scene: menu` | âœ… **æˆåŠŸ** |

### é‡è¦ãªãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**çµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ç¢ºèª**:
```
[INFO] NavigationContextManager Navigation context manager initial...
[INFO] AccessibilitySettingsManager Accessibility settings manager...
[INFO] ContextualHelpManager Contextual help manager initialized
```

**ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå‹•ä½œç¢ºèª**:
```
[LOG] [KeyboardShortcutManager] Help opened via keyboard shortcut
[LOG] [KeyboardShortcutManager] Settings opened via keyboard shortcut
[INFO] HelpScene Standard help mode activated
[INFO] HelpScene Navigated back to: menu, success: true
[INFO] SettingsScene Navigated back to: menu, success: true
```

---

## å­¦ç¿’ã•ã‚ŒãŸé‡è¦äº‹é …

### 1. ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç‰¹æœ‰ã®è€ƒæ…®äº‹é …

- **éåŒæœŸåˆæœŸåŒ–ãƒ—ãƒ­ã‚»ã‚¹**: ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã®å®Œå…¨ãªåˆæœŸåŒ–ã«ã¯æ™‚é–“ãŒå¿…è¦
- **è¤‡æ•°ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ **: å¤šæ•°ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¯ãƒ©ã‚¹ãŒé †æ¬¡åˆæœŸåŒ–ã•ã‚Œã‚‹
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‹•ä½œ**: ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ä¸­ã®çŠ¶æ…‹å¤‰åŒ–ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦

### 2. Playwrightãƒ†ã‚¹ãƒˆã§ã®é©åˆ‡ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

- **ååˆ†ãªå¾…æ©Ÿæ™‚é–“**: è¤‡é›‘ãªã‚·ã‚¹ãƒ†ãƒ ã«ã¯ååˆ†ãªåˆæœŸåŒ–æ™‚é–“ã‚’ç¢ºä¿
- **ãƒ­ã‚°ãƒ™ãƒ¼ã‚¹ã®æ¤œè¨¼**: console.logã‚’æ´»ç”¨ã—ãŸå‹•ä½œç¢ºèª
- **æ®µéšçš„æ¤œè¨¼**: åˆæœŸåŒ–â†’ã‚¢ã‚¯ã‚»ã‚¹â†’æˆ»ã‚Šã®å…¨ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ

### 3. çµ±åˆãƒ†ã‚¹ãƒˆã¨E2Eãƒ†ã‚¹ãƒˆã®é•ã„

- **çµ±åˆãƒ†ã‚¹ãƒˆ**: ãƒ¢ãƒƒã‚¯ç’°å¢ƒã§ã®æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆå®Œç’§ã«é€šéï¼‰
- **E2Eãƒ†ã‚¹ãƒˆ**: å®Ÿéš›ã®ç’°å¢ƒã§ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆï¼ˆé©åˆ‡ãªæ‰‹æ³•ãŒå¿…è¦ï¼‰

---

## çµè«–

### âœ… çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã¯å®Œå…¨ã«æ©Ÿèƒ½ã—ã¦ã„ã‚‹

1. **NavigationContextManager**: é©åˆ‡ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚’å®Ÿè¡Œ
2. **çµ±åˆã•ã‚ŒãŸHelpScene**: H/F1ã‚­ãƒ¼ã‹ã‚‰ã®æ­£å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹
3. **çµ±åˆã•ã‚ŒãŸSettingsScene**: Sã‚­ãƒ¼ã‹ã‚‰ã®æ­£å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹
4. **æˆ»ã‚ŠãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: ESCã‚­ãƒ¼ã«ã‚ˆã‚‹é©åˆ‡ãªå‰ç”»é¢å¾©å¸°

### ä»Šå¾Œã®Playwrightãƒ†ã‚¹ãƒˆæŒ‡é‡

1. **ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã§ã¯å¸¸ã«ååˆ†ãªåˆæœŸåŒ–å¾…æ©Ÿã‚’è¡Œã†
2. **ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ã‚’ç©æ¥µçš„ã«æ´»ç”¨ã—ãŸå‹•ä½œç¢ºèªã‚’å®Ÿæ–½
3. **æ®µéšçš„ãƒ†ã‚¹ãƒˆ**ã«ã‚ˆã‚Šå…¨æ©Ÿèƒ½ã®å‹•ä½œã‚’åŒ…æ‹¬çš„ã«æ¤œè¨¼
4. **å®Ÿè£…ã¨èªè­˜ã®ä¹–é›¢**ã‚’é¿ã‘ã‚‹ãŸã‚ã€å®šæœŸçš„ãªæ‰‹æ³•è¦‹ç›´ã—ã‚’å®Ÿæ–½

---

**æ¤œè¨¼å®Œäº†æ—¥**: 2025-01-15  
**æ¬¡ã‚¹ãƒ†ãƒƒãƒ—**: ã‚¿ã‚¹ã‚¯23 é‡è¤‡ç”»é¢èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ