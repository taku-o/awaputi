# MCPトークン制限問題修正 - 要件定義

## 概要

Claude CodeでのMCPツール（find_symbol）がトークン制限（25,000トークン）を超過する問題を解決し、開発効率を向上させる。

## 要件

### 要件1: 緊急ファイル分割

**ユーザーストーリー:** 開発者として、MCPツールが正常に動作するよう、最も大きなファイルを分割したい。

#### 受入基準
1. WHEN UserInfoScene.js（11,260語）を分割する THEN 各コンポーネントは2,500語以下になる SHALL
2. WHEN EventStageManager.js（9,914語）を分割する THEN 機能別に適切に分離される SHALL
3. WHEN MobilePerformanceOptimizer.js（8,405語）を分割する THEN パフォーマンス機能が保持される SHALL
4. WHEN SoundEffectSystem.js（7,349語）を分割する THEN オーディオ機能が正常に動作する SHALL
5. WHEN TutorialOverlay.js（6,627語）を分割する THEN チュートリアル機能が維持される SHALL

### 要件2: 段階的ファイル分割

**ユーザーストーリー:** 開発者として、すべての大きなファイルを段階的に分割して、プロジェクト全体の保守性を向上させたい。

#### 受入基準
1. WHEN 2,500語を超えるファイルを特定する THEN 優先度順にリスト化される SHALL
2. WHEN ファイルを分割する THEN 単一責任の原則に従って分離される SHALL
3. WHEN 分割後のファイル THEN 各ファイルは2,500語以下になる SHALL
4. WHEN 分割作業を実行する THEN 既存の機能が破綻しない SHALL

### 要件3: ファイルサイズ監視システム

**ユーザーストーリー:** 開発者として、ファイルサイズが制限を超えないよう自動監視したい。

#### 受入基準
1. WHEN ファイルサイズをチェックする THEN 2,500語を超えるファイルが検出される SHALL
2. WHEN 制限超過ファイルが検出される THEN 警告が表示される SHALL
3. WHEN ビルド時にチェックする THEN サイズ制限違反でビルドが失敗する SHALL
4. WHEN 開発中にチェックする THEN リアルタイムで警告が表示される SHALL

### 要件4: MCPツール設定最適化

**ユーザーストーリー:** 開発者として、MCPツールが効率的に動作するよう設定を最適化したい。

#### 受入基準
1. WHEN 大きなファイルを除外する THEN MCPツールのレスポンスサイズが制限内になる SHALL
2. WHEN 不要なファイルを除外する THEN 検索結果の精度が向上する SHALL
3. WHEN 設定を適用する THEN find_symbolが正常に動作する SHALL
4. WHEN 除外パターンを設定する THEN 開発に必要なファイルは除外されない SHALL

### 要件5: コンポーネント設計標準化

**ユーザーストーリー:** 開発者として、今後のファイルサイズ問題を防ぐため、コンポーネント設計を標準化したい。

#### 受入基準
1. WHEN 新しいコンポーネントを作成する THEN 2,500語制限が守られる SHALL
2. WHEN コンポーネントを設計する THEN 単一責任の原則に従う SHALL
3. WHEN ファイルが成長する THEN 適切なタイミングで分割される SHALL
4. WHEN 分割を実行する THEN 既存のインポート関係が維持される SHALL