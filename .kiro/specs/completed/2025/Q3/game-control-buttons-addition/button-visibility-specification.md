# ゲームコントロールボタン表示条件仕様書

## 概要
ゲーム画面のGive Up（ギブアップ）ボタンとRestart（ゲーム再開始）ボタンは、ゲーム状態に応じて適切に表示/非表示を制御する。ユーザーが論理的におかしいタイミングでボタンを押すことを防ぎ、直感的なUI体験を提供する。

## ゲーム状態の定義

### 1. ゲーム開始前 (Pre-Game)
- ゲームシーンは開始されているが、実際のゲームプレイは開始されていない状態
- ユーザー名入力、カウントダウン表示などの初期化フェーズ

### 2. ゲーム進行中 (Playing)
- 実際にゲームがプレイされている状態
- バブルクリック、スコア計算、時間カウントダウンが進行中
- `gameEngine.isGameStarted === true && !gameEngine.isGameOver && !isPaused`

### 3. ポーズ中 (Paused)
- ゲームが一時停止されている状態
- ゲーム時間は停止しているが、ゲーム自体は継続中
- `isPaused === true && !gameEngine.isGameOver`

### 4. ゲームオーバー (Game Over)
- ゲームが終了した状態（時間切れ、ライフ0など）
- 結果表示、ハイスコア更新などの後処理フェーズ
- `gameEngine.isGameOver === true`

## ボタン表示条件

### Give Up（ギブアップ）ボタン

| ゲーム状態 | 表示 | 理由 |
|------------|------|------|
| ゲーム開始前 | ❌ 非表示 | まだゲームが開始されていないため、ギブアップする必要がない |
| ゲーム進行中 | ✅ 表示 | プレイヤーがゲームを諦めてメニューに戻りたい場合 |
| ポーズ中 | ✅ 表示 | ポーズ状態からメニューに戻りたい場合 |
| ゲームオーバー | ❌ 非表示 | すでにゲームが終了しているため、ギブアップする必要がない |

**表示条件**: `(isPlaying || isPaused) && !isGameOver && !isPreGame`

### Restart（ゲーム再開始）ボタン

| ゲーム状態 | 表示 | 理由 |
|------------|------|------|
| ゲーム開始前 | ❌ 非表示 | まだゲームが開始されていないため、再開始する必要がない |
| ゲーム進行中 | ✅ 表示 | 現在のゲームを破棄して最初からやり直したい場合 |
| ポーズ中 | ✅ 表示 | ポーズ状態から最初からやり直したい場合 |
| ゲームオーバー | ✅ 表示 | ゲーム終了後に再度プレイしたい場合 |

**表示条件**: `(isPlaying || isPaused || isGameOver) && !isPreGame`

## 実装方針

### 1. 状態監視
- `GameUIManager`でゲーム状態の変化を監視
- 状態変化時に`GameControlButtons.updateButtonVisibility()`を呼び出し

### 2. 表示制御
- `GameControlButtons`クラスに`buttonVisibility`状態を追加
- `render()`メソッドで表示状態をチェックしてからボタンを描画

### 3. 状態判定ロジック
```javascript
// 状態判定メソッド
updateButtonVisibility(gameState) {
    const { isGameStarted, isGameOver, isPaused, isPreGame } = gameState;
    
    this.buttonVisibility = {
        giveUp: (isGameStarted && !isGameOver && !isPreGame),
        restart: ((isGameStarted && !isPreGame) || isGameOver)
    };
}
```

### 4. レンダリング制御
```javascript
// レンダリング時の表示制御
renderButton(context, buttonType) {
    if (!this.buttonVisibility[buttonType]) {
        return; // 非表示の場合は描画をスキップ
    }
    // 既存の描画ロジック
}
```

## 期待される効果

1. **ユーザビリティ向上**: 論理的におかしいタイミングでボタンが表示されない
2. **UI一貫性**: ゲーム状態とUI表示の整合性が取れる
3. **誤操作防止**: 無効な状態でのボタンクリックを防ぐ
4. **直感的操作**: ユーザーが期待するタイミングでのみボタンが利用可能

## テスト項目

1. **状態遷移テスト**: 各ゲーム状態でのボタン表示/非表示の確認
2. **エッジケーステスト**: 状態遷移の瞬間でのボタン表示状態
3. **機能テスト**: 表示されているボタンのクリック動作確認
4. **非表示テスト**: 非表示ボタンがクリックできないことの確認

## 更新履歴

| 日付 | バージョン | 変更内容 |
|------|------------|----------|
| 2025-08-14 | 1.0 | 初版作成 |