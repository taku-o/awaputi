<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚²ãƒ¼ãƒ ã‚³ã‚¢æ©Ÿèƒ½ãƒ‡ãƒãƒƒã‚° - Issue #113</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #f0f0f0; }
        .debug-panel { background: #fff; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        .log { background: #f8f9fa; padding: 8px; margin: 3px 0; border-left: 3px solid #007acc; font-size: 12px; }
        .success { border-color: #28a745; color: #155724; }
        .warning { border-color: #ffc107; color: #856404; }
        .error { border-color: #dc3545; color: #721c24; }
        button { padding: 8px 16px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a9e; }
        .status { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin: 0 5px; }
        .status-ok { background: #d4edda; color: #155724; }
        .status-warn { background: #fff3cd; color: #856404; }
        .status-error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ”¬ Issue #113 ã‚²ãƒ¼ãƒ ã‚³ã‚¢æ©Ÿèƒ½ãƒ‡ãƒãƒƒã‚°</h1>
    <p>ã‚²ãƒ¼ãƒ ã®åŸºæœ¬æ©Ÿèƒ½ãŒå‹•ä½œã—ã¦ã„ã‚‹ã‹ã‚’æ®µéšçš„ã«ç¢ºèªã—ã¾ã™</p>

    <div class="debug-panel">
        <h3>ğŸ›ï¸ ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h3>
        <button onclick="testGameEngine()">GameEngine ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testBubbleManager()">BubbleManager ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testInputManager()">InputManager ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testGameLoop()">ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ— ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="simulateGameplay()">ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
        <button onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <div class="debug-panel">
        <h3>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h3>
        <div id="system-status">
            <span class="status status-warn">GameEngine: æœªç¢ºèª</span>
            <span class="status status-warn">BubbleManager: æœªç¢ºèª</span>
            <span class="status status-warn">InputManager: æœªç¢ºèª</span>
            <span class="status status-warn">ScoreManager: æœªç¢ºèª</span>
            <span class="status status-warn">ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—: æœªç¢ºèª</span>
        </div>
    </div>

    <div class="debug-panel">
        <h3>ğŸ“‹ ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h3>
        <div id="debug-log" style="max-height: 300px; overflow-y: auto;"></div>
    </div>

    <script type="module">
        let gameEngine = null;
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            document.getElementById('debug-log').appendChild(div);
            div.scrollIntoView();
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function updateStatus(component, status) {
            const statusContainer = document.getElementById('system-status');
            const statusClass = status === 'ok' ? 'status-ok' : status === 'warn' ? 'status-warn' : 'status-error';
            const statusText = status === 'ok' ? 'æ­£å¸¸' : status === 'warn' ? 'è­¦å‘Š' : 'ã‚¨ãƒ©ãƒ¼';
            
            // æ—¢å­˜ã®çŠ¶æ…‹ã‚’æ›´æ–°
            const spans = statusContainer.querySelectorAll('span');
            let updated = false;
            
            spans.forEach(span => {
                if (span.textContent.includes(component)) {
                    span.className = `status ${statusClass}`;
                    span.textContent = `${component}: ${statusText}`;
                    updated = true;
                }
            });
            
            if (!updated) {
                const newSpan = document.createElement('span');
                newSpan.className = `status ${statusClass}`;
                newSpan.textContent = `${component}: ${statusText}`;
                statusContainer.appendChild(newSpan);
            }
        }

        window.clearLogs = function() {
            document.getElementById('debug-log').innerHTML = '';
        };

        window.testGameEngine = async function() {
            log('ğŸš€ GameEngineèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                const { GameEngine } = await import('./src/core/GameEngine.js');
                log('âœ… GameEngineã‚¯ãƒ©ã‚¹èª­ã¿è¾¼ã¿æˆåŠŸ', 'success');
                
                // Canvasè¦ç´ ã‚’ä½œæˆ
                let canvas = document.getElementById('testCanvas');
                if (!canvas) {
                    canvas = document.createElement('canvas');
                    canvas.id = 'testCanvas';
                    canvas.width = 800;
                    canvas.height = 600;
                    canvas.style.cssText = 'border: 1px solid #ccc; display: none;';
                    document.body.appendChild(canvas);
                }
                
                log('ğŸ¯ Canvasè¦ç´ æº–å‚™å®Œäº†', 'info');
                
                // GameEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                gameEngine = new GameEngine(canvas);
                log('âœ… GameEngineã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ', 'success');
                
                // åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                await gameEngine.initialize();
                log('âœ… GameEngineåˆæœŸåŒ–å®Œäº†', 'success');
                
                updateStatus('GameEngine', 'ok');
                
                // ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª
                if (gameEngine.bubbleManager) {
                    log('âœ… BubbleManagerçµ±åˆç¢ºèª', 'success');
                    updateStatus('BubbleManager', 'ok');
                }
                
                if (gameEngine.inputManager) {
                    log('âœ… InputManagerçµ±åˆç¢ºèª', 'success');
                    updateStatus('InputManager', 'ok');
                }
                
                if (gameEngine.scoreManager) {
                    log('âœ… ScoreManagerçµ±åˆç¢ºèª', 'success');
                    updateStatus('ScoreManager', 'ok');
                }
                
            } catch (error) {
                log(`âŒ GameEngineãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                log(`ğŸ“š ã‚¹ã‚¿ãƒƒã‚¯: ${error.stack}`, 'error');
                updateStatus('GameEngine', 'error');
            }
        };

        window.testBubbleManager = function() {
            log('ğŸ«§ BubbleManagerãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            if (!gameEngine) {
                log('âš ï¸ GameEngineãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å…ˆã«GameEngineãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            try {
                const bubbleManager = gameEngine.bubbleManager;
                if (!bubbleManager) {
                    throw new Error('BubbleManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                log(`ğŸ“Š åˆæœŸãƒãƒ–ãƒ«æ•°: ${bubbleManager.bubbles ? bubbleManager.bubbles.length : 0}`, 'info');
                
                // ãƒãƒ–ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆ
                if (typeof bubbleManager.spawnBubble === 'function') {
                    const initialCount = bubbleManager.bubbles ? bubbleManager.bubbles.length : 0;
                    
                    bubbleManager.spawnBubble(400, 300, 'normal');
                    
                    const newCount = bubbleManager.bubbles ? bubbleManager.bubbles.length : 0;
                    
                    if (newCount > initialCount) {
                        log(`âœ… ãƒãƒ–ãƒ«ç”ŸæˆæˆåŠŸ: ${initialCount} â†’ ${newCount}`, 'success');
                        updateStatus('BubbleManager', 'ok');
                    } else {
                        log('âš ï¸ ãƒãƒ–ãƒ«ç”ŸæˆãŒç¢ºèªã§ãã¾ã›ã‚“', 'warning');
                        updateStatus('BubbleManager', 'warn');
                    }
                } else {
                    throw new Error('spawnBubbleãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
            } catch (error) {
                log(`âŒ BubbleManagerãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                updateStatus('BubbleManager', 'error');
            }
        };

        window.testInputManager = function() {
            log('ğŸ–±ï¸ InputManagerãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            if (!gameEngine) {
                log('âš ï¸ GameEngineãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                return;
            }
            
            try {
                const inputManager = gameEngine.inputManager;
                if (!inputManager) {
                    throw new Error('InputManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const canvas = document.getElementById('testCanvas');
                if (canvas) {
                    const clickEvent = new MouseEvent('click', {
                        clientX: 400,
                        clientY: 300,
                        bubbles: true
                    });
                    
                    canvas.dispatchEvent(clickEvent);
                    log('âœ… ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡', 'success');
                    
                    // InputManagerã®å¿œç­”ç¢ºèª
                    if (typeof inputManager.handleClick === 'function') {
                        log('âœ… InputManager ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç¢ºèª', 'success');
                        updateStatus('InputManager', 'ok');
                    } else {
                        log('âš ï¸ ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'warning');
                        updateStatus('InputManager', 'warn');
                    }
                } else {
                    throw new Error('ãƒ†ã‚¹ãƒˆç”¨CanvasãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
            } catch (error) {
                log(`âŒ InputManagerãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                updateStatus('InputManager', 'error');
            }
        };

        window.testGameLoop = function() {
            log('ğŸ”„ ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            if (!gameEngine) {
                log('âš ï¸ GameEngineãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                return;
            }
            
            try {
                // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—é–‹å§‹
                if (typeof gameEngine.start === 'function') {
                    gameEngine.start();
                    log('âœ… ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—é–‹å§‹', 'success');
                    
                    // 3ç§’å¾Œã«ãƒ«ãƒ¼ãƒ—çŠ¶æ…‹ç¢ºèª
                    setTimeout(() => {
                        if (gameEngine.isRunning) {
                            log('âœ… ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—å‹•ä½œä¸­', 'success');
                            updateStatus('ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—', 'ok');
                            
                            // FPSç¢ºèª
                            if (gameEngine.performanceMonitor) {
                                const fps = gameEngine.performanceMonitor.stats?.fps || 0;
                                log(`ğŸ“Š ç¾åœ¨ã®FPS: ${Math.round(fps)}`, 'info');
                            }
                        } else {
                            log('âš ï¸ ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ãŒåœæ­¢ã—ã¦ã„ã¾ã™', 'warning');
                            updateStatus('ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—', 'warn');
                        }
                    }, 3000);
                    
                } else {
                    throw new Error('ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—startãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
            } catch (error) {
                log(`âŒ ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                updateStatus('ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—', 'error');
            }
        };

        window.simulateGameplay = function() {
            log('ğŸ® ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹', 'info');
            
            if (!gameEngine || !gameEngine.isRunning) {
                log('âš ï¸ ã‚²ãƒ¼ãƒ ãŒå‹•ä½œã—ã¦ã„ã¾ã›ã‚“ã€‚å…ˆã«GameEngineã¨ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            try {
                const canvas = document.getElementById('testCanvas');
                let clickCount = 0;
                const maxClicks = 10;
                
                const simulateClick = () => {
                    if (clickCount >= maxClicks) {
                        log(`ğŸ‰ ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†: ${maxClicks}å›ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œ`, 'success');
                        return;
                    }
                    
                    // ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    
                    const clickEvent = new MouseEvent('click', {
                        clientX: x,
                        clientY: y,
                        bubbles: true
                    });
                    
                    canvas.dispatchEvent(clickEvent);
                    clickCount++;
                    
                    log(`ğŸ–±ï¸ ã‚¯ãƒªãƒƒã‚¯ ${clickCount}/${maxClicks}: (${Math.round(x)}, ${Math.round(y)})`, 'info');
                    
                    // æ¬¡ã®ã‚¯ãƒªãƒƒã‚¯ã‚’0.5ç§’å¾Œã«å®Ÿè¡Œ
                    setTimeout(simulateClick, 500);
                };
                
                simulateClick();
                
            } catch (error) {
                log(`âŒ ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—: ${error.message}`, 'error');
            }
        };

        // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        log('ğŸ”¬ Issue #113 ã‚²ãƒ¼ãƒ ã‚³ã‚¢æ©Ÿèƒ½ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«èµ·å‹•', 'info');
        log('ğŸ‘† ä¸Šã®ãƒœã‚¿ãƒ³ã‚’é †ç•ªã«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„', 'info');
        log('ğŸ“ æ¨å¥¨é †åº: GameEngine â†’ BubbleManager â†’ InputManager â†’ ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ— â†’ ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', 'info');
    </script>
</body>
</html>