<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favicon ICO Generator - BubblePop PWA</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 10px 0; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #45a049; }
        .preview { display: flex; gap: 20px; margin: 20px 0; }
        .icon-preview { text-align: center; }
        .icon-preview img { border: 1px solid #ddd; background: white; }
        input[type="file"] { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>🔗 Favicon ICO Generator</h1>
    <p>生成されたPNGファイルからICOファイルを作成します</p>
    
    <div class="container">
        <h2>Step 1: PNGファイルを選択</h2>
        <p>favicon-16x16.png, favicon-32x32.png, favicon-48x48.png を選択してください</p>
        <input type="file" id="fileInput" multiple accept=".png" />
    </div>
    
    <div class="container">
        <h2>Step 2: プレビュー</h2>
        <div id="preview" class="preview"></div>
    </div>
    
    <div class="container">
        <h2>Step 3: ICO生成とダウンロード</h2>
        <button id="generateICO">ICOファイルを生成してダウンロード</button>
        <p><small>⚠️ 注意: この機能は基本的なICO生成です。完全な互換性には<a href="https://favicon.io/favicon-converter/" target="_blank">favicon.io</a>の使用を推奨します。</small></p>
    </div>
    
    <div class="container">
        <h2>推奨オンラインツール</h2>
        <ul>
            <li><a href="https://favicon.io/favicon-converter/" target="_blank">favicon.io - Favicon Converter</a></li>
            <li><a href="https://icoconvert.com/" target="_blank">icoconvert.com</a></li>
            <li><a href="https://convertio.co/png-ico/" target="_blank">convertio.co</a></li>
        </ul>
        <p>これらのサービスを使用して、生成されたPNGファイルをアップロードし、ICOファイルをダウンロードしてください。</p>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');
        const generateBtn = document.getElementById('generateICO');
        
        let loadedImages = [];
        
        fileInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            preview.innerHTML = '';
            loadedImages = [];
            
            files.forEach(file => {
                if (file.type === 'image/png') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            loadedImages.push({
                                name: file.name,
                                size: this.width,
                                data: e.target.result
                            });
                            
                            const previewDiv = document.createElement('div');
                            previewDiv.className = 'icon-preview';
                            previewDiv.innerHTML = `
                                <img src="${e.target.result}" width="64" height="64" alt="${file.name}">
                                <div>${file.name}</div>
                                <div>${this.width}×${this.height}px</div>
                            `;
                            preview.appendChild(previewDiv);
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        });
        
        generateBtn.addEventListener('click', function() {
            if (loadedImages.length === 0) {
                alert('PNGファイルを選択してください');
                return;
            }
            
            // 最大サイズの画像を選択（簡易実装）
            const largestImage = loadedImages.reduce((prev, current) => 
                (prev.size > current.size) ? prev : current
            );
            
            // データURLからBlobを作成
            fetch(largestImage.data)
                .then(res => res.blob())
                .then(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'favicon.ico';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    alert('⚠️ 基本的なICOファイルがダウンロードされました。\n完全な互換性には favicon.io などのオンラインツールの使用を推奨します。');
                });
        });
    </script>
</body>
</html>