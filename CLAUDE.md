# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

**BubblePop (awaputi)** - HTML5 Canvas を使用したバブルポップゲーム
- **技術スタック**: Vanilla JavaScript (ES6+), HTML5 Canvas, Web APIs
- **アーキテクチャ**: コンポーネントベースのモジュラー設計
- **言語**: 日本語（UI、ドキュメント、コメント）

## 開発環境

### プロジェクト起動
```bash
# ローカル開発サーバー起動（推奨）
python -m http.server 8000
# または
npx serve .

# メインゲームアクセス
# http://localhost:8000

# テスト環境アクセス
# http://localhost:8000/test.html
```

### 重要な特徴
- **ビルドプロセスなし**: 純粋なES6モジュール、直接ブラウザで実行
- **外部依存なし**: package.json は存在せず、Vanilla JavaScript のみ使用
- **テスト環境**: `test.html` でバブルタイプの個別テストが可能

## アーキテクチャ構造

### コアシステム (`src/core/`)
- **GameEngine.js**: メインゲームループ、全システムの統合管理
- **SceneManager.js**: シーン（画面）遷移管理（メニュー、ゲーム、ショップ等）
- **InputManager.js**: マウス/タッチ入力の統一処理
- **PlayerData.js**: プレイヤー進捗データの永続化（LocalStorage使用）
- **StageManager.js**: ステージ設定とコンフィグ管理
- **ItemSystem.js**: アイテム/ショップシステム

### ゲームシーン (`src/scenes/`)
- **MainMenuScene.js**: メインメニュー、ユーザー登録
- **StageSelectScene.js**: ステージ選択画面
- **GameScene.js**: メインゲームプレイ
- **ShopScene.js**: アイテム購入インターフェース

### ゲーム要素
- **BubbleManager.js**: バブルのスポーン、衝突検出、ライフサイクル管理
- **Bubble.js**: 個別バブルエンティティ（12+種類の特殊バブル）
- **ScoreManager.js**: スコアリング、コンボシステム

## ゲーム仕様

### バブルタイプ（12+種類）
1. **通常系**: Normal（基本）、Stone/Iron/Diamond（硬い、複数クリック必要）
2. **特殊効果系**: 
   - Rainbow（ボーナスタイム発動）
   - Pink（HP回復）
   - Clock（時間停止効果）
   - Electric（画面震動 + 一時的操作無効）
   - Poison（ポップ時ダメージ）
   - Spiky（連鎖ダメージ）
   - Escaping（カーソルから逃げる）
   - Boss（大型、高HP）

### 進捗システム
- **AP (Awaputi Points)**: 消費可能ポイント（アイテム購入）
- **TAP (Total AP)**: 永続進捗指標
- **コンボシステム**: 連続ポップでボーナススコア
- **ステージアンロック**: 進捗ベースのコンテンツ解放

### ゲームメカニクス
- **目標**: 自動破裂前にバブルをポップ（破裂するとプレイヤーダメージ）
- **操作**: クリックでポップ、ドラッグで押し退け
- **制限時間**: 5分ステージ、段階的難易度上昇
- **HPシステム**: ダメージベース、未処理バブルからダメージ

## 技術的特徴

### 設計パターン
- **コンポーネントベース**: 責任分離された各システム
- **イベント駆動入力**: シーン間での統一入力処理
- **エンティティコンポーネント**: 設定可能なバブル特性・振る舞い
- **データ永続化**: LocalStorage でプレイヤー進捗管理

### 特殊効果システム
- **ボーナスタイム**: スコア倍率と視覚効果
- **時間停止**: バブルスポーン/移動の一時停止
- **画面震動**: Electric バブルによる妨害効果
- **コンボシステム**: 連続成功アクションの視覚フィードバック

### データ管理
- **LocalStorage**: プレイヤー進捗、ハイスコア、購入アイテム
- **自動保存**: 進捗の自動保存機能
- **データエクスポート/インポート**: ユーザーデータ管理機能

## 開発ガイドライン

### コード規約
- **ES6+ モジュール**: import/export 構文使用
- **日本語コメント**: コード内コメントは日本語で記述
- **クラスベース**: ES6 クラス構文を使用した OOP 設計
- **イベント型**: addEventListener パターンでのイベント処理

### ファイル構造パターン
```javascript
// 基本的なクラス構造
export class ComponentName {
    constructor(gameEngine) {
        this.gameEngine = gameEngine;
        this.initialize();
    }
    
    initialize() {
        // 初期化処理
    }
    
    update(deltaTime) {
        // フレーム更新処理
    }
    
    render(ctx) {
        // 描画処理
    }
}
```

### ステージ設定例
```javascript
const STAGE_CONFIGS = {
    tutorial: { 
        duration: 60000, 
        bubbleTypes: ['normal'] 
    },
    normal: { 
        duration: 300000, 
        bubbleTypes: ['normal', 'stone', 'rainbow', 'pink', 'clock', 'score'] 
    }
    // 8+ 追加ステージタイプ
};
```

## 拡張性

### 新しいバブルタイプの追加
1. `src/bubbles/Bubble.js` で新しいタイプを定義
2. `BubbleManager.js` でスポーン/管理ロジック追加
3. ステージ設定で使用可能に設定

### 新しいシーンの追加
1. `src/scenes/` に新しいシーンクラス作成
2. `SceneManager.js` でシーン登録
3. 遷移ロジックの実装

### パフォーマンス考慮
- **オブジェクトプーリング**: バブル生成の最適化（実装予定）
- **効率的レンダリング**: Canvas 描画の最適化
- **メモリ管理**: イベントリスナーの適切な cleanup

## 現在の開発状況 (2025年7月時点)

### 完了済み機能 (Phase 1-3)
✅ **コア機能 (Phase 1)**
- ゲームエンジン基盤とゲームループ実装済み
- 基本泡クラスと泡管理システム完成
- 入力システム（マウス・タッチ統一処理）完成
- スコア・コンボシステム実装済み

✅ **ゲームプレイ機能 (Phase 2)**  
- 12+種類の特殊泡すべて実装済み（Normal, Stone/Iron/Diamond, Rainbow, Pink, Clock, Electric, Poison, Spiky, Escaping, Boss等）
- HPシステムとゲームオーバー処理完成
- ドラッグ操作による泡の吹き飛ばし機能実装済み
- 特殊効果システム（ボーナスタイム、時間停止、画面震動）実装済み

✅ **ステージ・進歩システム (Phase 3)**
- 10種類のステージタイプ実装済み（1分ステージ〜全部入りアワアワ）
- AP/TAPシステムとハイスコア記録機能完成
- アイテムシステム（ショップ、購入、効果適用）実装済み
- メインメニューとステージ選択画面完成

### 現在の実装状況
- **Phase 1-3**: ほぼ完了（85%+）
- **Phase 4-5**: 未着手（UI/UX改善、最適化、テスト、デプロイ）

### 未完了タスク (Phase 4-5)
🔄 **Phase 4: UI・UX・メニューシステム** 
- [ ] ユーザー情報管理画面の実装
- [ ] ゲーム中UIの完成（フローティングテキスト等）
- [ ] 視覚・音響効果の実装（Web Audio API、パーティクル効果）

🔄 **Phase 5: 最適化・テスト・デプロイ**
- [ ] パフォーマンス最適化（オブジェクトプーリング、差分レンダリング）
- [ ] クロスブラウザ・デバイス対応
- [ ] エラーハンドリングと安定性向上
- [ ] テストスイート実装（Jest、E2E）
- [ ] ビルド・デプロイ設定

### 技術的負債・改善点
- フローティングテキスト効果が現在console.logのみ
- Web Audio APIによる効果音システム未実装
- オブジェクトプーリングによるメモリ最適化未実装
- Viteビルド設定の最適化が必要

このプロジェクトは、モジュラー設計により高い拡張性と保守性を実現した、本格的なブラウザゲームです。