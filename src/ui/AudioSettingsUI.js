import { getErrorHandler } from '../utils/ErrorHandler.js';
import { getConfigurationManager } from '../core/ConfigurationManager.js';
import { getLocalizationManager } from '../core/LocalizationManager.js';
import { AudioTestPanel } from './AudioTestPanel.js';

/**
 * Èü≥ÈüøË®≠ÂÆöUI„ÇØ„É©„Çπ
 */
export class AudioSettingsUI {
    constructor(audioManager) {
        this.audioManager = audioManager;
        this.configManager = getConfigurationManager();
        this.localizationManager = getLocalizationManager();
        this.errorHandler = getErrorHandler();
        
        // UIË¶ÅÁ¥†
        this.container = null;
        this.isOpen = false;
        
        // „Çø„ÉñÁÆ°ÁêÜ
        this.tabs = {
            volume: { label: 'audio.settings.tabs.volume', icon: 'üîä' },
            quality: { label: 'audio.settings.tabs.quality', icon: 'üéöÔ∏è' },
            effects: { label: 'audio.settings.tabs.effects', icon: 'üéõÔ∏è' },
            accessibility: { label: 'audio.settings.tabs.accessibility', icon: '‚ôø' },
            test: { label: 'audio.settings.tabs.test', icon: 'üîß' }
        };
        this.activeTab = 'volume';
        
        // „Çπ„É©„Ç§„ÉÄ„ÉºÁÆ°ÁêÜ
        this.sliders = new Map();
        
        // „Éó„É¨„Éì„É•„ÉºÈü≥Ê∫ê
        this.previewTimeouts = new Map();
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        this.eventListeners = new Map();
        
        // Ë®≠ÂÆöÂ§âÊõ¥„ÅÆÁõ£Ë¶ñ
        this.configWatchers = new Set();
        
        // Èü≥Èüø„ÉÜ„Çπ„Éà„Éë„Éç„É´
        this.audioTestPanel = new AudioTestPanel(audioManager);
        
        // ÂàùÊúüÂåñ
        this.initialize();
    }
    
    /**
     * ÂàùÊúüÂåñ
     */
    initialize() {
        try {
            // „Ç≥„É≥„ÉÜ„Éä‰ΩúÊàê
            this.createContainer();
            
            // Ë®≠ÂÆöÂ§âÊõ¥„ÅÆÁõ£Ë¶ñ„ÇíË®≠ÂÆö
            this.setupConfigWatchers();
            
            console.log('AudioSettingsUI initialized');
        } catch (error) {
            this.errorHandler.handleError(error, 'UI_ERROR', {
                component: 'AudioSettingsUI',
                operation: 'initialize'
            });
        }
    }
    
    /**
     * UI„Ç≥„É≥„ÉÜ„Éä„Çí‰ΩúÊàê
     * @private
     */
    createContainer() {
        // „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä
        this.container = document.createElement('div');
        this.container.className = 'audio-settings-ui';
        this.container.style.cssText = `
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            max-width: 90vw;
            max-height: 80vh;
            background-color: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ffff;
            border-radius: 15px;
            padding: 20px;
            z-index: 10000;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #ffffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        `;
        
        // „Éò„ÉÉ„ÉÄ„Éº
        const header = this.createHeader();
        this.container.appendChild(header);
        
        // „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
        const tabNav = this.createTabNavigation();
        this.container.appendChild(tabNav);
        
        // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢
        const content = document.createElement('div');
        content.className = 'audio-settings-content';
        content.style.cssText = `
            margin-top: 20px;
            max-height: calc(80vh - 180px);
            overflow-y: auto;
            padding-right: 10px;
        `;
        content.id = 'audio-settings-content';
        this.container.appendChild(content);
        
        // „Éï„ÉÉ„Çø„Éº
        const footer = this.createFooter();
        this.container.appendChild(footer);
        
        // „Éâ„Ç≠„É•„É°„É≥„Éà„Å´ËøΩÂä†
        document.body.appendChild(this.container);
        
        // ÂàùÊúü„Çø„Éñ„ÇíË°®Á§∫
        this.showTab(this.activeTab);
    }
    
    /**
     * „Éò„ÉÉ„ÉÄ„Éº„Çí‰ΩúÊàê
     * @private
     * @returns {HTMLElement} „Éò„ÉÉ„ÉÄ„ÉºË¶ÅÁ¥†
     */
    createHeader() {
        const header = document.createElement('div');
        header.className = 'audio-settings-header';
        header.style.cssText = `
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00ffff;
        `;
        
        // „Çø„Ç§„Éà„É´
        const title = document.createElement('h2');
        title.textContent = this.localizationManager.getText('audio.settings.title');
        title.style.cssText = `
            margin: 0;
            font-size: 24px;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        `;
        header.appendChild(title);
        
        // Èñâ„Åò„Çã„Éú„Çø„É≥
        const closeButton = document.createElement('button');
        closeButton.className = 'audio-settings-close';
        closeButton.textContent = '‚úñ';
        closeButton.style.cssText = `
            background: none;
            border: none;
            color: #ffffff;
            font-size: 24px;
            cursor: pointer;
            padding: 5px 10px;
            transition: all 0.3s ease;
        `;
        closeButton.addEventListener('click', () => this.close());
        closeButton.addEventListener('mouseenter', () => {
            closeButton.style.color = '#ff0000';
            closeButton.style.textShadow = '0 0 10px rgba(255, 0, 0, 0.5)';
        });
        closeButton.addEventListener('mouseleave', () => {
            closeButton.style.color = '#ffffff';
            closeButton.style.textShadow = 'none';
        });
        header.appendChild(closeButton);
        
        return header;
    }
    
    /**
     * „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Çí‰ΩúÊàê
     * @private
     * @returns {HTMLElement} „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Ë¶ÅÁ¥†
     */
    createTabNavigation() {
        const nav = document.createElement('div');
        nav.className = 'audio-settings-tabs';
        nav.style.cssText = `
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        `;
        
        Object.entries(this.tabs).forEach(([key, tab]) => {
            const button = document.createElement('button');
            button.className = `audio-settings-tab ${key === this.activeTab ? 'active' : ''}`;
            button.innerHTML = `${tab.icon} ${this.localizationManager.getText(tab.label)}`;
            button.style.cssText = `
                background: ${key === this.activeTab ? 'rgba(0, 255, 255, 0.2)' : 'none'};
                border: 2px solid ${key === this.activeTab ? '#00ffff' : '#333333'};
                color: ${key === this.activeTab ? '#00ffff' : '#999999'};
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 16px;
                transition: all 0.3s ease;
            `;
            
            button.addEventListener('click', () => this.showTab(key));
            button.addEventListener('mouseenter', () => {
                if (key !== this.activeTab) {
                    button.style.borderColor = '#666666';
                    button.style.color = '#cccccc';
                }
            });
            button.addEventListener('mouseleave', () => {
                if (key !== this.activeTab) {
                    button.style.borderColor = '#333333';
                    button.style.color = '#999999';
                }
            });
            
            nav.appendChild(button);
        });
        
        return nav;
    }
    
    /**
     * „Éï„ÉÉ„Çø„Éº„Çí‰ΩúÊàê
     * @private
     * @returns {HTMLElement} „Éï„ÉÉ„Çø„ÉºË¶ÅÁ¥†
     */
    createFooter() {
        const footer = document.createElement('div');
        footer.className = 'audio-settings-footer';
        footer.style.cssText = `
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #333333;
        `;
        
        // „É™„Çª„ÉÉ„Éà„Éú„Çø„É≥
        const resetButton = document.createElement('button');
        resetButton.className = 'audio-settings-reset';
        resetButton.textContent = this.localizationManager.getText('audio.settings.reset');
        resetButton.style.cssText = `
            background-color: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0000;
            color: #ff0000;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        `;
        resetButton.addEventListener('click', () => this.resetSettings());
        resetButton.addEventListener('mouseenter', () => {
            resetButton.style.backgroundColor = 'rgba(255, 0, 0, 0.3)';
            resetButton.style.boxShadow = '0 0 10px rgba(255, 0, 0, 0.5)';
        });
        resetButton.addEventListener('mouseleave', () => {
            resetButton.style.backgroundColor = 'rgba(255, 0, 0, 0.2)';
            resetButton.style.boxShadow = 'none';
        });
        footer.appendChild(resetButton);
        
        // ‰∏≠Â§Æ„Éú„Çø„É≥„Ç∞„É´„Éº„Éó
        const middleGroup = document.createElement('div');
        middleGroup.style.cssText = `
            display: flex;
            gap: 10px;
        `;
        
        // „Ç§„É≥„Éù„Éº„Éà„Éú„Çø„É≥
        const importButton = document.createElement('button');
        importButton.className = 'audio-settings-import';
        importButton.textContent = 'üìÅ ' + this.localizationManager.getText('audio.settings.import');
        importButton.style.cssText = `
            background-color: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        `;
        importButton.addEventListener('click', () => this.importSettings());
        importButton.addEventListener('mouseenter', () => {
            importButton.style.backgroundColor = 'rgba(0, 255, 0, 0.3)';
            importButton.style.boxShadow = '0 0 10px rgba(0, 255, 0, 0.5)';
        });
        importButton.addEventListener('mouseleave', () => {
            importButton.style.backgroundColor = 'rgba(0, 255, 0, 0.2)';
            importButton.style.boxShadow = 'none';
        });
        middleGroup.appendChild(importButton);
        
        // „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Éú„Çø„É≥
        const exportButton = document.createElement('button');
        exportButton.className = 'audio-settings-export';
        exportButton.textContent = 'üíæ ' + this.localizationManager.getText('audio.settings.export');
        exportButton.style.cssText = `
            background-color: rgba(0, 255, 255, 0.2);
            border: 2px solid #00ffff;
            color: #00ffff;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        `;
        exportButton.addEventListener('click', () => this.exportSettings());
        exportButton.addEventListener('mouseenter', () => {
            exportButton.style.backgroundColor = 'rgba(0, 255, 255, 0.3)';
            exportButton.style.boxShadow = '0 0 10px rgba(0, 255, 255, 0.5)';
        });
        exportButton.addEventListener('mouseleave', () => {
            exportButton.style.backgroundColor = 'rgba(0, 255, 255, 0.2)';
            exportButton.style.boxShadow = 'none';
        });
        middleGroup.appendChild(exportButton);
        
        footer.appendChild(middleGroup);
        
        // ‰øùÂ≠òÁä∂ÊÖãË°®Á§∫
        const saveStatus = document.createElement('span');
        saveStatus.className = 'audio-settings-save-status';
        saveStatus.textContent = this.localizationManager.getText('audio.settings.saved');
        saveStatus.style.cssText = `
            color: #00ff00;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
        `;
        saveStatus.id = 'audio-settings-save-status';
        footer.appendChild(saveStatus);
        
        return footer;
    }
    
    /**
     * „Çø„Éñ„ÇíË°®Á§∫
     * @param {string} tabKey - „Çø„Éñ„Ç≠„Éº
     */
    showTab(tabKey) {
        try {
            // ÁèæÂú®„ÅÆ„Çø„Éñ„ÇíÈùû„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÂåñ
            const tabs = this.container.querySelectorAll('.audio-settings-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                tab.style.background = 'none';
                tab.style.borderColor = '#333333';
                tab.style.color = '#999999';
            });
            
            // Êñ∞„Åó„ÅÑ„Çø„Éñ„Çí„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÂåñ
            const activeTabButton = Array.from(tabs).find(tab => 
                tab.textContent.includes(this.tabs[tabKey].icon)
            );
            if (activeTabButton) {
                activeTabButton.classList.add('active');
                activeTabButton.style.background = 'rgba(0, 255, 255, 0.2)';
                activeTabButton.style.borderColor = '#00ffff';
                activeTabButton.style.color = '#00ffff';
            }
            
            this.activeTab = tabKey;
            
            // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÊõ¥Êñ∞
            const content = document.getElementById('audio-settings-content');
            if (content) {
                content.innerHTML = '';
                
                switch (tabKey) {
                    case 'volume':
                        this.renderVolumeTab(content);
                        break;
                    case 'quality':
                        this.renderQualityTab(content);
                        break;
                    case 'effects':
                        this.renderEffectsTab(content);
                        break;
                    case 'accessibility':
                        this.renderAccessibilityTab(content);
                        break;
                    case 'test':
                        this.renderTestTab(content);
                        break;
                }
            }
            
            // UI„Çµ„Ç¶„É≥„Éâ„ÇíÂÜçÁîü
            if (this.audioManager) {
                this.audioManager.playUISound('tab_switch', { volume: 0.3 });
            }
            
        } catch (error) {
            this.errorHandler.handleError(error, 'UI_ERROR', {
                component: 'AudioSettingsUI',
                operation: 'showTab',
                tabKey: tabKey
            });
        }
    }
    
    /**
     * Èü≥Èáè„Çø„Éñ„ÇíÊèèÁîª
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     */
    renderVolumeTab(container) {
        // Èü≥ÈáèË®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥
        const volumeSection = document.createElement('div');
        volumeSection.className = 'settings-section';
        volumeSection.style.marginBottom = '30px';
        
        // „Éû„Çπ„Çø„ÉºÈü≥Èáè
        this.createVolumeSlider(volumeSection, {
            id: 'master-volume',
            label: 'audio.settings.volume.master',
            icon: 'üéµ',
            category: 'master',
            defaultValue: this.audioManager.getVolume('master'),
            previewSound: 'success'
        });
        
        // BGMÈü≥Èáè
        this.createVolumeSlider(volumeSection, {
            id: 'bgm-volume',
            label: 'audio.settings.volume.bgm',
            icon: 'üéº',
            category: 'bgm',
            defaultValue: this.audioManager.getVolume('bgm'),
            previewSound: null // BGM„Éó„É¨„Éì„É•„Éº„ÅØÁâπÂà•Âá¶ÁêÜ
        });
        
        // ÂäπÊûúÈü≥Èü≥Èáè
        this.createVolumeSlider(volumeSection, {
            id: 'sfx-volume',
            label: 'audio.settings.volume.sfx',
            icon: 'üîî',
            category: 'sfx',
            defaultValue: this.audioManager.getVolume('sfx'),
            previewSound: 'pop'
        });
        
        container.appendChild(volumeSection);
        
        // „Éü„É•„Éº„ÉàË®≠ÂÆö
        const muteSection = document.createElement('div');
        muteSection.className = 'settings-section';
        muteSection.style.marginTop = '30px';
        
        this.createToggleOption(muteSection, {
            id: 'mute-all',
            label: 'audio.settings.volume.muteAll',
            icon: 'üîá',
            defaultValue: this.audioManager.isMuted,
            onChange: (value) => {
                this.audioManager.setMuted(value);
                this.updateVolumeSliders(!value);
            }
        });
        
        container.appendChild(muteSection);
    }
    
    /**
     * ÂìÅË≥™„Çø„Éñ„ÇíÊèèÁîª
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     */
    renderQualityTab(container) {
        const qualitySection = document.createElement('div');
        qualitySection.className = 'settings-section';
        
        // Èü≥Ë≥™„Éó„É™„Çª„ÉÉ„Éà
        const presets = [
            { value: 'low', label: 'audio.settings.quality.low' },
            { value: 'medium', label: 'audio.settings.quality.medium' },
            { value: 'high', label: 'audio.settings.quality.high' },
            { value: 'ultra', label: 'audio.settings.quality.ultra' }
        ];
        
        this.createRadioGroup(qualitySection, {
            id: 'quality-preset',
            label: 'audio.settings.quality.preset',
            icon: 'üéöÔ∏è',
            options: presets,
            defaultValue: 'high',
            onChange: (value) => {
                this.applyQualityPreset(value);
            }
        });
        
        // Ë©≥Á¥∞Ë®≠ÂÆö
        const advancedSection = document.createElement('div');
        advancedSection.className = 'settings-subsection';
        advancedSection.style.marginTop = '30px';
        
        const advancedTitle = document.createElement('h3');
        advancedTitle.textContent = this.localizationManager.getText('audio.settings.quality.advanced');
        advancedTitle.style.cssText = `
            color: #00ffff;
            font-size: 18px;
            margin-bottom: 15px;
        `;
        advancedSection.appendChild(advancedTitle);
        
        // „Çµ„É≥„Éó„É´„É¨„Éº„Éà
        this.createDropdown(advancedSection, {
            id: 'sample-rate',
            label: 'audio.settings.quality.sampleRate',
            icon: 'üìä',
            options: [
                { value: 22050, label: '22.05 kHz' },
                { value: 44100, label: '44.1 kHz' },
                { value: 48000, label: '48 kHz' }
            ],
            defaultValue: 44100,
            onChange: (value) => {
                this.audioManager.updateQualitySettings({ sampleRate: parseInt(value) });
            }
        });
        
        // „Éê„ÉÉ„Éï„Ç°„Çµ„Ç§„Ç∫
        this.createDropdown(advancedSection, {
            id: 'buffer-size',
            label: 'audio.settings.quality.bufferSize',
            icon: 'üíæ',
            options: [
                { value: 256, label: '256 (‰ΩéÈÅÖÂª∂)' },
                { value: 512, label: '512 („Éê„É©„É≥„Çπ)' },
                { value: 1024, label: '1024 (È´òÂìÅË≥™)' },
                { value: 2048, label: '2048 (ÊúÄÈ´òÂìÅË≥™)' }
            ],
            defaultValue: 512,
            onChange: (value) => {
                this.audioManager.updateQualitySettings({ bufferSize: parseInt(value) });
            }
        });
        
        qualitySection.appendChild(advancedSection);
        container.appendChild(qualitySection);
    }
    
    /**
     * „Ç®„Éï„Çß„ÇØ„Éà„Çø„Éñ„ÇíÊèèÁîª
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     */
    renderEffectsTab(container) {
        const effectsSection = document.createElement('div');
        effectsSection.className = 'settings-section';
        
        // „É™„Éê„Éº„ÉñÂäπÊûú
        this.createToggleOption(effectsSection, {
            id: 'reverb-enabled',
            label: 'audio.settings.effects.reverb',
            icon: 'üåä',
            defaultValue: this.configManager.get('audio.effects.reverb'),
            onChange: (value) => {
                this.audioManager.setAudioEffect('reverb', value);
            }
        });
        
        // „Ç≥„É≥„Éó„É¨„ÉÉ„Çµ„Éº
        this.createToggleOption(effectsSection, {
            id: 'compression-enabled',
            label: 'audio.settings.effects.compression',
            icon: 'üéõÔ∏è',
            defaultValue: this.configManager.get('audio.effects.compression'),
            onChange: (value) => {
                this.audioManager.setAudioEffect('compression', value);
            }
        });
        
        // „Ç§„Ç≥„É©„Ç§„Ç∂„Éº
        if (this.audioManager.audioController && this.audioManager.audioController.equalizer) {
            const eqSection = document.createElement('div');
            eqSection.className = 'settings-subsection';
            eqSection.style.marginTop = '30px';
            
            const eqTitle = document.createElement('h3');
            eqTitle.textContent = this.localizationManager.getText('audio.settings.effects.equalizer');
            eqTitle.style.cssText = `
                color: #00ffff;
                font-size: 18px;
                margin-bottom: 15px;
            `;
            eqSection.appendChild(eqTitle);
            
            // „Ç§„Ç≥„É©„Ç§„Ç∂„Éº„Éê„É≥„Éâ
            const bands = [
                { id: 'eq-low', label: '‰ΩéÈü≥', frequency: 80, icon: 'üîä' },
                { id: 'eq-low-mid', label: '‰∏≠‰ΩéÈü≥', frequency: 250, icon: 'üîâ' },
                { id: 'eq-mid', label: '‰∏≠Èü≥', frequency: 1000, icon: 'üîà' },
                { id: 'eq-high-mid', label: '‰∏≠È´òÈü≥', frequency: 4000, icon: 'üîâ' },
                { id: 'eq-high', label: 'È´òÈü≥', frequency: 12000, icon: 'üîä' }
            ];
            
            bands.forEach(band => {
                this.createVerticalSlider(eqSection, {
                    id: band.id,
                    label: band.label,
                    icon: band.icon,
                    min: -12,
                    max: 12,
                    defaultValue: 0,
                    unit: 'dB',
                    onChange: (value) => {
                        if (this.audioManager.audioController) {
                            this.audioManager.audioController.setEqualizerBand(band.frequency, value);
                        }
                    }
                });
            });
            
            effectsSection.appendChild(eqSection);
        }
        
        // Áí∞Â¢ÉÈü≥
        this.createToggleOption(effectsSection, {
            id: 'environmental-audio',
            label: 'audio.settings.effects.environmental',
            icon: 'üåø',
            defaultValue: this.configManager.get('audio.effects.environmentalAudio'),
            onChange: (value) => {
                if (this.audioManager.audioController) {
                    this.audioManager.audioController.enableEnvironmentalAudio(value);
                }
            }
        });
        
        container.appendChild(effectsSection);
    }
    
    /**
     * „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„Çø„Éñ„ÇíÊèèÁîª
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     */
    renderAccessibilityTab(container) {
        const accessibilitySection = document.createElement('div');
        accessibilitySection.className = 'settings-section';
        
        // Ë¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
        this.createToggleOption(accessibilitySection, {
            id: 'visual-feedback',
            label: 'audio.settings.accessibility.visualFeedback',
            icon: 'üëÅÔ∏è',
            defaultValue: this.configManager.get('audio.accessibility.visualFeedback'),
            onChange: (value) => {
                this.configManager.set('audio.accessibility.visualFeedback', value);
            }
        });
        
        // Ëß¶Ë¶ö„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
        this.createToggleOption(accessibilitySection, {
            id: 'haptic-feedback',
            label: 'audio.settings.accessibility.hapticFeedback',
            icon: 'üì≥',
            defaultValue: this.configManager.get('audio.accessibility.hapticFeedback'),
            onChange: (value) => {
                this.configManager.set('audio.accessibility.hapticFeedback', value);
            }
        });
        
        // Â≠óÂπï
        this.createToggleOption(accessibilitySection, {
            id: 'captioning',
            label: 'audio.settings.accessibility.captioning',
            icon: 'üìù',
            defaultValue: this.configManager.get('audio.accessibility.captioning'),
            onChange: (value) => {
                this.configManager.set('audio.accessibility.captioning', value);
            }
        });
        
        // Èü≥ÈüøË™¨Êòé
        this.createToggleOption(accessibilitySection, {
            id: 'audio-descriptions',
            label: 'audio.settings.accessibility.audioDescriptions',
            icon: 'üó£Ô∏è',
            defaultValue: this.configManager.get('audio.accessibility.audioDescriptions'),
            onChange: (value) => {
                this.configManager.set('audio.accessibility.audioDescriptions', value);
            }
        });
        
        container.appendChild(accessibilitySection);
    }
    
    /**
     * „ÉÜ„Çπ„Éà„Çø„Éñ„ÇíÊèèÁîª
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     */
    renderTestTab(container) {
        // „ÉÜ„Çπ„Éà„Éë„Éç„É´„ÇíË°®Á§∫
        this.audioTestPanel.open(container);
        
        // „ÉÜ„Çπ„ÉàË™¨Êòé
        const description = document.createElement('div');
        description.className = 'test-description';
        description.style.cssText = `
            background-color: rgba(255, 255, 255, 0.05);
            border-left: 4px solid #00ffff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        `;
        
        const descTitle = document.createElement('h4');
        descTitle.textContent = this.localizationManager.getText('audio.test.description.title');
        descTitle.style.cssText = `
            color: #00ffff;
            font-size: 16px;
            margin-bottom: 10px;
        `;
        description.appendChild(descTitle);
        
        const descText = document.createElement('p');
        descText.textContent = this.localizationManager.getText('audio.test.description.text');
        descText.style.cssText = `
            color: #cccccc;
            font-size: 14px;
            line-height: 1.4;
            margin: 0;
        `;
        description.appendChild(descText);
        
        // „ÉÜ„Çπ„Éà„Éë„Éç„É´„ÅÆÂâç„Å´Ë™¨Êòé„ÇíÊåøÂÖ•
        container.insertBefore(description, container.firstChild);
    }
    
    /**
     * Èü≥Èáè„Çπ„É©„Ç§„ÉÄ„Éº„Çí‰ΩúÊàê
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     * @param {Object} options - „Ç™„Éó„Ç∑„Éß„É≥
     */
    createVolumeSlider(container, options) {
        const sliderGroup = document.createElement('div');
        sliderGroup.className = 'slider-group';
        sliderGroup.style.cssText = `
            margin-bottom: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        `;
        
        // „É©„Éô„É´
        const labelContainer = document.createElement('div');
        labelContainer.style.cssText = `
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        `;
        
        const label = document.createElement('label');
        label.htmlFor = options.id;
        label.innerHTML = `${options.icon} ${this.localizationManager.getText(options.label)}`;
        label.style.cssText = `
            color: #ffffff;
            font-size: 16px;
        `;
        labelContainer.appendChild(label);
        
        // ÂÄ§Ë°®Á§∫
        const valueDisplay = document.createElement('span');
        valueDisplay.id = `${options.id}-value`;
        valueDisplay.textContent = `${Math.round(options.defaultValue * 100)}%`;
        valueDisplay.style.cssText = `
            color: #00ffff;
            font-size: 16px;
            font-weight: bold;
        `;
        labelContainer.appendChild(valueDisplay);
        
        sliderGroup.appendChild(labelContainer);
        
        // „Çπ„É©„Ç§„ÉÄ„Éº„Ç≥„É≥„ÉÜ„Éä
        const sliderContainer = document.createElement('div');
        sliderContainer.style.cssText = `
            display: flex;
            align-items: center;
            gap: 15px;
        `;
        
        // „Çπ„É©„Ç§„ÉÄ„Éº
        const slider = document.createElement('input');
        slider.type = 'range';
        slider.id = options.id;
        slider.min = '0';
        slider.max = '100';
        slider.value = Math.round(options.defaultValue * 100);
        slider.style.cssText = `
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #00ffff 0%, #00ffff ${slider.value}%, #333333 ${slider.value}%, #333333 100%);
            border-radius: 4px;
            outline: none;
            cursor: pointer;
        `;
        
        // „Éó„É¨„Éì„É•„Éº„Éú„Çø„É≥
        const previewButton = document.createElement('button');
        previewButton.className = 'preview-button';
        previewButton.innerHTML = 'üîä';
        previewButton.style.cssText = `
            background-color: rgba(0, 255, 255, 0.2);
            border: 2px solid #00ffff;
            color: #00ffff;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        `;
        
        // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº
        slider.addEventListener('input', (e) => {
            const value = parseInt(e.target.value) / 100;
            valueDisplay.textContent = `${e.target.value}%`;
            slider.style.background = `linear-gradient(to right, #00ffff 0%, #00ffff ${e.target.value}%, #333333 ${e.target.value}%, #333333 100%)`;
            
            // Èü≥Èáè„ÇíË®≠ÂÆö
            this.audioManager.setVolume(options.category, value);
            
            // ‰øùÂ≠òÁä∂ÊÖã„ÇíË°®Á§∫
            this.showSaveStatus();
            
            // „Éó„É¨„Éì„É•„ÉºÈü≥„Çí‰∫àÁ¥Ñ
            this.schedulePreview(options);
        });
        
        previewButton.addEventListener('click', () => {
            this.playPreviewSound(options);
            
            // „Éú„Çø„É≥„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
            previewButton.style.transform = 'scale(0.95)';
            setTimeout(() => {
                previewButton.style.transform = 'scale(1)';
            }, 100);
        });
        
        sliderContainer.appendChild(slider);
        sliderContainer.appendChild(previewButton);
        sliderGroup.appendChild(sliderContainer);
        
        container.appendChild(sliderGroup);
        
        // „Çπ„É©„Ç§„ÉÄ„Éº„Çí‰øùÂ≠ò
        this.sliders.set(options.id, slider);
    }
    
    /**
     * „Éà„Ç∞„É´„Ç™„Éó„Ç∑„Éß„É≥„Çí‰ΩúÊàê
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     * @param {Object} options - „Ç™„Éó„Ç∑„Éß„É≥
     */
    createToggleOption(container, options) {
        const toggleGroup = document.createElement('div');
        toggleGroup.className = 'toggle-group';
        toggleGroup.style.cssText = `
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        `;
        
        // „É©„Éô„É´
        const label = document.createElement('label');
        label.htmlFor = options.id;
        label.innerHTML = `${options.icon} ${this.localizationManager.getText(options.label)}`;
        label.style.cssText = `
            color: #ffffff;
            font-size: 16px;
            cursor: pointer;
        `;
        
        // „Éà„Ç∞„É´„Çπ„Ç§„ÉÉ„ÉÅ
        const switchContainer = document.createElement('div');
        switchContainer.style.cssText = `
            position: relative;
            width: 60px;
            height: 30px;
        `;
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = options.id;
        checkbox.checked = options.defaultValue;
        checkbox.style.cssText = `
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        `;
        
        const switchLabel = document.createElement('label');
        switchLabel.htmlFor = options.id;
        switchLabel.style.cssText = `
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: ${checkbox.checked ? '#00ffff' : '#333333'};
            transition: all 0.3s ease;
            border-radius: 30px;
        `;
        
        const switchKnob = document.createElement('span');
        switchKnob.style.cssText = `
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: ${checkbox.checked ? '34px' : '4px'};
            bottom: 4px;
            background-color: white;
            transition: all 0.3s ease;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        `;
        switchLabel.appendChild(switchKnob);
        
        // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº
        checkbox.addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            switchLabel.style.backgroundColor = isChecked ? '#00ffff' : '#333333';
            switchKnob.style.left = isChecked ? '34px' : '4px';
            
            if (options.onChange) {
                options.onChange(isChecked);
            }
            
            // UI„Çµ„Ç¶„É≥„Éâ
            this.audioManager.playUISound('toggle', { volume: 0.3 });
            
            // ‰øùÂ≠òÁä∂ÊÖã„ÇíË°®Á§∫
            this.showSaveStatus();
        });
        
        toggleGroup.addEventListener('mouseenter', () => {
            toggleGroup.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
        });
        
        toggleGroup.addEventListener('mouseleave', () => {
            toggleGroup.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
        });
        
        toggleGroup.addEventListener('click', (e) => {
            if (e.target !== checkbox) {
                checkbox.checked = !checkbox.checked;
                checkbox.dispatchEvent(new Event('change'));
            }
        });
        
        switchContainer.appendChild(checkbox);
        switchContainer.appendChild(switchLabel);
        toggleGroup.appendChild(label);
        toggleGroup.appendChild(switchContainer);
        
        container.appendChild(toggleGroup);
    }
    
    /**
     * „É©„Ç∏„Ç™„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     * @param {Object} options - „Ç™„Éó„Ç∑„Éß„É≥
     */
    createRadioGroup(container, options) {
        const radioGroup = document.createElement('div');
        radioGroup.className = 'radio-group';
        radioGroup.style.cssText = `
            margin-bottom: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        `;
        
        // „É©„Éô„É´
        const groupLabel = document.createElement('h3');
        groupLabel.innerHTML = `${options.icon} ${this.localizationManager.getText(options.label)}`;
        groupLabel.style.cssText = `
            color: #00ffff;
            font-size: 18px;
            margin-bottom: 15px;
        `;
        radioGroup.appendChild(groupLabel);
        
        // „Ç™„Éó„Ç∑„Éß„É≥
        const optionsContainer = document.createElement('div');
        optionsContainer.style.cssText = `
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        `;
        
        options.options.forEach(option => {
            const optionLabel = document.createElement('label');
            optionLabel.style.cssText = `
                display: flex;
                align-items: center;
                padding: 10px;
                background-color: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
            `;
            
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = options.id;
            radio.value = option.value;
            radio.checked = option.value === options.defaultValue;
            radio.style.cssText = `
                margin-right: 8px;
                cursor: pointer;
            `;
            
            const text = document.createElement('span');
            text.textContent = this.localizationManager.getText(option.label);
            text.style.cssText = `
                color: #ffffff;
                font-size: 14px;
            `;
            
            radio.addEventListener('change', (e) => {
                if (e.target.checked && options.onChange) {
                    options.onChange(e.target.value);
                    this.audioManager.playUISound('select', { volume: 0.3 });
                    this.showSaveStatus();
                }
            });
            
            optionLabel.addEventListener('mouseenter', () => {
                optionLabel.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
            });
            
            optionLabel.addEventListener('mouseleave', () => {
                optionLabel.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
            });
            
            optionLabel.appendChild(radio);
            optionLabel.appendChild(text);
            optionsContainer.appendChild(optionLabel);
        });
        
        radioGroup.appendChild(optionsContainer);
        container.appendChild(radioGroup);
    }
    
    /**
     * „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„Çí‰ΩúÊàê
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     * @param {Object} options - „Ç™„Éó„Ç∑„Éß„É≥
     */
    createDropdown(container, options) {
        const dropdownGroup = document.createElement('div');
        dropdownGroup.className = 'dropdown-group';
        dropdownGroup.style.cssText = `
            margin-bottom: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        `;
        
        // „É©„Éô„É´
        const label = document.createElement('label');
        label.htmlFor = options.id;
        label.innerHTML = `${options.icon} ${this.localizationManager.getText(options.label)}`;
        label.style.cssText = `
            display: block;
            color: #ffffff;
            font-size: 16px;
            margin-bottom: 10px;
        `;
        dropdownGroup.appendChild(label);
        
        // „Çª„É¨„ÇØ„Éà
        const select = document.createElement('select');
        select.id = options.id;
        select.style.cssText = `
            width: 100%;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 2px solid #333333;
            border-radius: 8px;
            color: #ffffff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        `;
        
        options.options.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option.value;
            optionElement.textContent = option.label;
            optionElement.selected = option.value === options.defaultValue;
            select.appendChild(optionElement);
        });
        
        select.addEventListener('change', (e) => {
            if (options.onChange) {
                options.onChange(e.target.value);
                this.audioManager.playUISound('select', { volume: 0.3 });
                this.showSaveStatus();
            }
        });
        
        select.addEventListener('focus', () => {
            select.style.borderColor = '#00ffff';
        });
        
        select.addEventListener('blur', () => {
            select.style.borderColor = '#333333';
        });
        
        dropdownGroup.appendChild(select);
        container.appendChild(dropdownGroup);
    }
    
    /**
     * ÂûÇÁõ¥„Çπ„É©„Ç§„ÉÄ„Éº„Çí‰ΩúÊàêÔºà„Ç§„Ç≥„É©„Ç§„Ç∂„ÉºÁî®Ôºâ
     * @private
     * @param {HTMLElement} container - „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†
     * @param {Object} options - „Ç™„Éó„Ç∑„Éß„É≥
     */
    createVerticalSlider(container, options) {
        const sliderGroup = document.createElement('div');
        sliderGroup.className = 'vertical-slider-group';
        sliderGroup.style.cssText = `
            display: inline-block;
            text-align: center;
            margin: 0 15px;
            vertical-align: top;
        `;
        
        // ÂÄ§Ë°®Á§∫
        const valueDisplay = document.createElement('div');
        valueDisplay.id = `${options.id}-value`;
        valueDisplay.textContent = `${options.defaultValue >= 0 ? '+' : ''}${options.defaultValue}${options.unit}`;
        valueDisplay.style.cssText = `
            color: #00ffff;
            font-size: 14px;
            margin-bottom: 10px;
        `;
        sliderGroup.appendChild(valueDisplay);
        
        // „Çπ„É©„Ç§„ÉÄ„Éº„Ç≥„É≥„ÉÜ„Éä
        const sliderContainer = document.createElement('div');
        sliderContainer.style.cssText = `
            position: relative;
            width: 40px;
            height: 150px;
            margin: 0 auto;
        `;
        
        // „Çπ„É©„Ç§„ÉÄ„ÉºÔºàÂûÇÁõ¥Ôºâ
        const slider = document.createElement('input');
        slider.type = 'range';
        slider.id = options.id;
        slider.min = options.min;
        slider.max = options.max;
        slider.value = options.defaultValue;
        slider.style.cssText = `
            position: absolute;
            width: 150px;
            height: 40px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(-90deg);
            -webkit-appearance: none;
            background: linear-gradient(to right, #333333 0%, #333333 50%, #00ffff 50%, #00ffff 100%);
            border-radius: 4px;
            outline: none;
            cursor: pointer;
        `;
        
        // „Çπ„É©„Ç§„ÉÄ„Éº„Çπ„Çø„Ç§„É´ÔºàWebkitÔºâ
        const style = document.createElement('style');
        style.textContent = `
            #${options.id}::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 20px;
                height: 20px;
                background: #00ffff;
                cursor: pointer;
                border-radius: 50%;
                box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            }
            #${options.id}::-moz-range-thumb {
                width: 20px;
                height: 20px;
                background: #00ffff;
                cursor: pointer;
                border-radius: 50%;
                box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            }
        `;
        document.head.appendChild(style);
        
        slider.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            valueDisplay.textContent = `${value >= 0 ? '+' : ''}${value}${options.unit}`;
            
            // „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞
            const percentage = ((value - options.min) / (options.max - options.min)) * 100;
            slider.style.background = `linear-gradient(to right, #333333 0%, #333333 ${percentage}%, #00ffff ${percentage}%, #00ffff 100%)`;
            
            if (options.onChange) {
                options.onChange(value);
            }
        });
        
        sliderContainer.appendChild(slider);
        sliderGroup.appendChild(sliderContainer);
        
        // „É©„Éô„É´
        const label = document.createElement('div');
        label.innerHTML = `${options.icon}<br>${options.label}`;
        label.style.cssText = `
            color: #ffffff;
            font-size: 12px;
            margin-top: 10px;
        `;
        sliderGroup.appendChild(label);
        
        container.appendChild(sliderGroup);
    }
    
    /**
     * „Éó„É¨„Éì„É•„ÉºÈü≥„Çí‰∫àÁ¥Ñ
     * @private
     * @param {Object} options - „Ç™„Éó„Ç∑„Éß„É≥
     */
    schedulePreview(options) {
        // Êó¢Â≠ò„ÅÆ„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Çí„ÇØ„É™„Ç¢
        if (this.previewTimeouts.has(options.id)) {
            clearTimeout(this.previewTimeouts.get(options.id));
        }
        
        // Êñ∞„Åó„ÅÑ„Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÇíË®≠ÂÆö
        const timeout = setTimeout(() => {
            this.playPreviewSound(options);
            this.previewTimeouts.delete(options.id);
        }, 500); // 0.5ÁßíÂæå„Å´ÂÜçÁîü
        
        this.previewTimeouts.set(options.id, timeout);
    }
    
    /**
     * „Éó„É¨„Éì„É•„ÉºÈü≥„ÇíÂÜçÁîü
     * @private
     * @param {Object} options - „Ç™„Éó„Ç∑„Éß„É≥
     */
    playPreviewSound(options) {
        if (!options.previewSound || !this.audioManager) return;
        
        if (options.category === 'bgm') {
            // BGM„Éó„É¨„Éì„É•„ÉºÔºàÁü≠„ÅÑ„Éï„É¨„Éº„Ç∫„ÇíÂÜçÁîüÔºâ
            const currentBGM = this.audioManager.getCurrentBGMInfo();
            if (currentBGM && currentBGM.isPlaying) {
                // ‰∏ÄÊôÇÁöÑ„Å´Èü≥Èáè„Çí‰∏ä„Åí„Çã
                const originalVolume = this.audioManager.getVolume('bgm');
                this.audioManager.setBGMVolume(1.0, 0.2);
                setTimeout(() => {
                    this.audioManager.setBGMVolume(originalVolume, 0.2);
                }, 1000);
            } else {
                // BGM„ÅåÂÜçÁîü„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÁü≠„ÅÑ„É°„É≠„Éá„Ç£„ÇíÁîüÊàê
                this.audioManager.playSound('success', { volume: 0.5 });
            }
        } else {
            // ÈÄöÂ∏∏„ÅÆÂäπÊûúÈü≥
            this.audioManager.playSound(options.previewSound, { 
                volume: options.category === 'master' ? 0.5 : 1.0 
            });
        }
    }
    
    /**
     * ‰øùÂ≠òÁä∂ÊÖã„ÇíË°®Á§∫
     * @private
     */
    showSaveStatus() {
        const status = document.getElementById('audio-settings-save-status');
        if (status) {
            status.style.opacity = '1';
            setTimeout(() => {
                status.style.opacity = '0';
            }, 2000);
        }
    }
    
    /**
     * Èü≥Èáè„Çπ„É©„Ç§„ÉÄ„Éº„ÇíÊõ¥Êñ∞
     * @private
     * @param {boolean} enabled - ÊúâÂäπÁä∂ÊÖã
     */
    updateVolumeSliders(enabled) {
        this.sliders.forEach((slider, id) => {
            if (id !== 'mute-all') {
                slider.disabled = !enabled;
                slider.style.opacity = enabled ? '1' : '0.5';
            }
        });
    }
    
    /**
     * ÂìÅË≥™„Éó„É™„Çª„ÉÉ„Éà„ÇíÈÅ©Áî®
     * @private
     * @param {string} preset - „Éó„É™„Çª„ÉÉ„ÉàÂêç
     */
    applyQualityPreset(preset) {
        const presets = {
            low: { sampleRate: 22050, bufferSize: 1024 },
            medium: { sampleRate: 44100, bufferSize: 512 },
            high: { sampleRate: 44100, bufferSize: 256 },
            ultra: { sampleRate: 48000, bufferSize: 256 }
        };
        
        const settings = presets[preset];
        if (settings) {
            this.audioManager.updateQualitySettings(settings);
            
            // UI„ÇíÊõ¥Êñ∞
            const sampleRateSelect = document.getElementById('sample-rate');
            const bufferSizeSelect = document.getElementById('buffer-size');
            if (sampleRateSelect) sampleRateSelect.value = settings.sampleRate;
            if (bufferSizeSelect) bufferSizeSelect.value = settings.bufferSize;
        }
    }
    
    /**
     * Ë®≠ÂÆö„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà
     */
    async exportSettings() {
        try {
            // ÁèæÂú®„ÅÆÈü≥ÈüøË®≠ÂÆö„ÇíÂèéÈõÜ
            const settings = {
                version: '1.0',
                timestamp: new Date().toISOString(),
                volumes: {
                    master: this.audioManager.getVolume('master'),
                    bgm: this.audioManager.getVolume('bgm'),
                    sfx: this.audioManager.getVolume('sfx'),
                    muted: this.configManager.get('audio.volumes.muted')
                },
                quality: {
                    sampleRate: this.configManager.get('audio.quality.sampleRate'),
                    bufferSize: this.configManager.get('audio.quality.bufferSize'),
                    compression: this.configManager.get('audio.effects.compression')
                },
                effects: {
                    reverb: this.configManager.get('audio.effects.reverb'),
                    compression: this.configManager.get('audio.effects.compression'),
                    environmentalAudio: this.configManager.get('audio.effects.environmentalAudio')
                },
                equalizer: this.audioManager.audioController ? 
                    this.audioManager.audioController.getEqualizerSettings() : null,
                accessibility: {
                    visualFeedback: this.configManager.get('audio.accessibility.visualFeedback'),
                    hapticFeedback: this.configManager.get('audio.accessibility.hapticFeedback'),
                    captioning: this.configManager.get('audio.accessibility.captioning'),
                    audioDescriptions: this.configManager.get('audio.accessibility.audioDescriptions')
                }
            };
            
            // JSON„Éï„Ç°„Ç§„É´„Å®„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
            const json = JSON.stringify(settings, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `awaputi-audio-settings-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
            
            // ÊàêÂäüÈü≥„ÇíÂÜçÁîü
            this.audioManager.playSound('success', { volume: 0.5 });
            
            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
            this.showNotification(
                this.localizationManager.getText('audio.settings.export.success'),
                'success'
            );
            
            console.log('Audio settings exported successfully');
            
        } catch (error) {
            this.errorHandler.handleError(error, 'UI_ERROR', {
                component: 'AudioSettingsUI',
                operation: 'exportSettings'
            });
            
            this.audioManager.playSound('error', { volume: 0.5 });
            this.showNotification(
                this.localizationManager.getText('audio.settings.export.error'),
                'error'
            );
        }
    }
    
    /**
     * Ë®≠ÂÆö„Çí„Ç§„É≥„Éù„Éº„Éà
     */
    async importSettings() {
        try {
            // „Éï„Ç°„Ç§„É´ÈÅ∏Êäû„ÉÄ„Ç§„Ç¢„É≠„Ç∞„Çí‰ΩúÊàê
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.style.display = 'none';
            
            input.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const settings = JSON.parse(text);
                    
                    // Ë®≠ÂÆö„Éï„Ç°„Ç§„É´„ÇíÊ§úË®º
                    if (!this.validateSettingsFile(settings)) {
                        throw new Error('Invalid settings file format');
                    }
                    
                    // Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
                    const confirm = window.confirm(
                        this.localizationManager.getText('audio.settings.import.confirm')
                    );
                    if (!confirm) return;
                    
                    // Ë®≠ÂÆö„ÇíÈÅ©Áî®
                    await this.applyImportedSettings(settings);
                    
                    // UI„ÇíÊõ¥Êñ∞
                    this.showTab(this.activeTab);
                    
                    // ÊàêÂäüÈü≥„ÇíÂÜçÁîü
                    this.audioManager.playSound('success', { volume: 0.5 });
                    
                    // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
                    this.showNotification(
                        this.localizationManager.getText('audio.settings.import.success'),
                        'success'
                    );
                    
                    console.log('Audio settings imported successfully');
                    
                } catch (parseError) {
                    this.errorHandler.handleError(parseError, 'UI_ERROR', {
                        component: 'AudioSettingsUI',
                        operation: 'importSettings',
                        phase: 'parsing'
                    });
                    
                    this.audioManager.playSound('error', { volume: 0.5 });
                    this.showNotification(
                        this.localizationManager.getText('audio.settings.import.parseError'),
                        'error'
                    );
                }
                
                // ÂÖ•ÂäõË¶ÅÁ¥†„ÇíÂâäÈô§
                document.body.removeChild(input);
            });
            
            document.body.appendChild(input);
            input.click();
            
        } catch (error) {
            this.errorHandler.handleError(error, 'UI_ERROR', {
                component: 'AudioSettingsUI',
                operation: 'importSettings'
            });
        }
    }
    
    /**
     * Ë®≠ÂÆö„Éï„Ç°„Ç§„É´„ÇíÊ§úË®º
     * @private
     * @param {Object} settings - Ë®≠ÂÆö„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
     * @returns {boolean} ÊúâÂäπÊÄß
     */
    validateSettingsFile(settings) {
        try {
            // Âü∫Êú¨ÊßãÈÄ†„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            if (!settings || typeof settings !== 'object') {
                return false;
            }
            
            // ÂøÖÈ†à„Éï„Ç£„Éº„É´„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const requiredFields = ['version', 'volumes'];
            for (const field of requiredFields) {
                if (!(field in settings)) {
                    return false;
                }
            }
            
            // Èü≥ÈáèË®≠ÂÆö„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const volumes = settings.volumes;
            if (!volumes || typeof volumes !== 'object') {
                return false;
            }
            
            const volumeFields = ['master', 'bgm', 'sfx'];
            for (const field of volumeFields) {
                if (!(field in volumes) || 
                    typeof volumes[field] !== 'number' || 
                    volumes[field] < 0 || 
                    volumes[field] > 1) {
                    return false;
                }
            }
            
            return true;
        } catch (error) {
            return false;
        }
    }
    
    /**
     * „Ç§„É≥„Éù„Éº„Éà„Åó„ÅüË®≠ÂÆö„ÇíÈÅ©Áî®
     * @private
     * @param {Object} settings - Ë®≠ÂÆö„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
     */
    async applyImportedSettings(settings) {
        try {
            // Èü≥ÈáèË®≠ÂÆö„ÇíÈÅ©Áî®
            if (settings.volumes) {
                await this.configManager.set('audio.volumes.master', settings.volumes.master);
                await this.configManager.set('audio.volumes.bgm', settings.volumes.bgm);
                await this.configManager.set('audio.volumes.sfx', settings.volumes.sfx);
                if ('muted' in settings.volumes) {
                    await this.configManager.set('audio.volumes.muted', settings.volumes.muted);
                }
            }
            
            // ÂìÅË≥™Ë®≠ÂÆö„ÇíÈÅ©Áî®
            if (settings.quality) {
                if (settings.quality.sampleRate) {
                    await this.configManager.set('audio.quality.sampleRate', settings.quality.sampleRate);
                }
                if (settings.quality.bufferSize) {
                    await this.configManager.set('audio.quality.bufferSize', settings.quality.bufferSize);
                }
            }
            
            // „Ç®„Éï„Çß„ÇØ„ÉàË®≠ÂÆö„ÇíÈÅ©Áî®
            if (settings.effects) {
                if ('reverb' in settings.effects) {
                    await this.configManager.set('audio.effects.reverb', settings.effects.reverb);
                }
                if ('compression' in settings.effects) {
                    await this.configManager.set('audio.effects.compression', settings.effects.compression);
                }
                if ('environmentalAudio' in settings.effects) {
                    await this.configManager.set('audio.effects.environmentalAudio', settings.effects.environmentalAudio);
                }
            }
            
            // „Ç§„Ç≥„É©„Ç§„Ç∂„ÉºË®≠ÂÆö„ÇíÈÅ©Áî®
            if (settings.equalizer && this.audioManager.audioController) {
                this.audioManager.audioController.setEqualizerSettings(settings.equalizer);
            }
            
            // „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Ë®≠ÂÆö„ÇíÈÅ©Áî®
            if (settings.accessibility) {
                const accessibilitySettings = settings.accessibility;
                Object.keys(accessibilitySettings).forEach(async (key) => {
                    await this.configManager.set(`audio.accessibility.${key}`, accessibilitySettings[key]);
                });
            }
            
            // AudioManager„ÅÆË®≠ÂÆö„ÇíÂêåÊúü
            this.audioManager.syncWithConfig();
            
        } catch (error) {
            this.errorHandler.handleError(error, 'UI_ERROR', {
                component: 'AudioSettingsUI',
                operation: 'applyImportedSettings'
            });
            throw error;
        }
    }
    
    /**
     * ÈÄöÁü•„ÇíË°®Á§∫
     * @private
     * @param {string} message - „É°„ÉÉ„Çª„Éº„Ç∏
     * @param {string} type - „Çø„Ç§„Éó ('success', 'error', 'info')
     */
    showNotification(message, type = 'info') {
        // Êó¢Â≠ò„ÅÆÈÄöÁü•„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
        const existingNotification = document.querySelector('.audio-settings-notification');
        if (existingNotification) {
            existingNotification.remove();
        }
        
        const notification = document.createElement('div');
        notification.className = 'audio-settings-notification';
        notification.textContent = message;
        
        const colors = {
            success: { bg: 'rgba(0, 255, 0, 0.2)', border: '#00ff00', text: '#00ff00' },
            error: { bg: 'rgba(255, 0, 0, 0.2)', border: '#ff0000', text: '#ff0000' },
            info: { bg: 'rgba(0, 255, 255, 0.2)', border: '#00ffff', text: '#00ffff' }
        };
        
        const color = colors[type] || colors.info;
        
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: ${color.bg};
            border: 2px solid ${color.border};
            color: ${color.text};
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 10001;
            font-size: 14px;
            box-shadow: 0 0 20px ${color.bg};
            animation: slideInFromRight 0.3s ease-out;
        `;
        
        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆöÁæ©
        if (!document.querySelector('#audio-notification-styles')) {
            const style = document.createElement('style');
            style.id = 'audio-notification-styles';
            style.textContent = `
                @keyframes slideInFromRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                @keyframes slideOutToRight {
                    from {
                        transform: translateX(0);
                        opacity: 1;
                    }
                    to {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        document.body.appendChild(notification);
        
        // 3ÁßíÂæå„Å´Ëá™ÂãïÂâäÈô§
        setTimeout(() => {
            if (notification.parentNode) {
                notification.style.animation = 'slideOutToRight 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }
        }, 3000);
    }
    
    /**
     * Ë®≠ÂÆö„Çí„É™„Çª„ÉÉ„Éà
     */
    async resetSettings() {
        try {
            const confirm = window.confirm(this.localizationManager.getText('audio.settings.confirmReset'));
            if (!confirm) return;
            
            // „Éá„Éï„Ç©„É´„ÉàÂÄ§„Å´Êàª„Åô
            await this.configManager.set('audio.volumes.master', 1.0);
            await this.configManager.set('audio.volumes.bgm', 0.7);
            await this.configManager.set('audio.volumes.sfx', 0.8);
            await this.configManager.set('audio.volumes.muted', false);
            await this.configManager.set('audio.effects.reverb', true);
            await this.configManager.set('audio.effects.compression', true);
            
            // AudioManager„ÅÆË®≠ÂÆö„ÇíÂêåÊúü
            this.audioManager.syncWithConfig();
            
            // UI„ÇíÂÜçÊèèÁîª
            this.showTab(this.activeTab);
            
            // ÊàêÂäüÈü≥„ÇíÂÜçÁîü
            this.audioManager.playSound('success', { volume: 0.5 });
            
            console.log('Audio settings reset to defaults');
        } catch (error) {
            this.errorHandler.handleError(error, 'UI_ERROR', {
                component: 'AudioSettingsUI',
                operation: 'resetSettings'
            });
        }
    }
    
    /**
     * Ë®≠ÂÆöÂ§âÊõ¥„ÅÆÁõ£Ë¶ñ„ÇíË®≠ÂÆö
     * @private
     */
    setupConfigWatchers() {
        // Èü≥ÈáèÂ§âÊõ¥„ÅÆÁõ£Ë¶ñ
        const volumeWatchers = ['master', 'bgm', 'sfx'].map(type => {
            return this.configManager.watch('audio', `volumes.${type}`, (newValue) => {
                const slider = this.sliders.get(`${type}-volume`);
                if (slider && slider.value !== Math.round(newValue * 100)) {
                    slider.value = Math.round(newValue * 100);
                    slider.dispatchEvent(new Event('input'));
                }
            });
        });
        volumeWatchers.forEach(w => w && this.configWatchers.add(w));
        
        // „Éü„É•„Éº„ÉàÁä∂ÊÖã„ÅÆÁõ£Ë¶ñ
        const muteWatcher = this.configManager.watch('audio', 'volumes.muted', (newValue) => {
            const muteCheckbox = document.getElementById('mute-all');
            if (muteCheckbox && muteCheckbox.checked !== newValue) {
                muteCheckbox.checked = newValue;
                muteCheckbox.dispatchEvent(new Event('change'));
            }
        });
        if (muteWatcher) this.configWatchers.add(muteWatcher);
    }
    
    /**
     * Èü≥ÈüøË®≠ÂÆöUI„ÇíÈñã„Åè
     */
    open() {
        if (this.isOpen) return;
        
        this.container.style.display = 'block';
        this.isOpen = true;
        
        // Èñã„Åè„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
        this.container.style.opacity = '0';
        this.container.style.transform = 'translate(-50%, -50%) scale(0.9)';
        
        requestAnimationFrame(() => {
            this.container.style.transition = 'all 0.3s ease';
            this.container.style.opacity = '1';
            this.container.style.transform = 'translate(-50%, -50%) scale(1)';
        });
        
        // UI„Çµ„Ç¶„É≥„Éâ
        this.audioManager.playUISound('open', { volume: 0.3 });
        
        // „Ç®„Çπ„Ç±„Éº„Éó„Ç≠„Éº„ÅßÈñâ„Åò„Çã
        this.escapeHandler = (e) => {
            if (e.key === 'Escape') {
                this.close();
            }
        };
        document.addEventListener('keydown', this.escapeHandler);
    }
    
    /**
     * Èü≥ÈüøË®≠ÂÆöUI„ÇíÈñâ„Åò„Çã
     */
    close() {
        if (!this.isOpen) return;
        
        // Èñâ„Åò„Çã„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
        this.container.style.opacity = '0';
        this.container.style.transform = 'translate(-50%, -50%) scale(0.9)';
        
        setTimeout(() => {
            this.container.style.display = 'none';
            this.isOpen = false;
        }, 300);
        
        // UI„Çµ„Ç¶„É≥„Éâ
        this.audioManager.playUISound('close', { volume: 0.3 });
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
        if (this.escapeHandler) {
            document.removeEventListener('keydown', this.escapeHandler);
            this.escapeHandler = null;
        }
    }
    
    /**
     * Èü≥ÈüøË®≠ÂÆöUI„ÅÆË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
     */
    toggle() {
        if (this.isOpen) {
            this.close();
        } else {
            this.open();
        }
    }
    
    /**
     * „É™„ÇΩ„Éº„Çπ„ÅÆËß£Êîæ
     */
    dispose() {
        // „Çø„Ç§„É†„Ç¢„Ç¶„Éà„Çí„ÇØ„É™„Ç¢
        this.previewTimeouts.forEach(timeout => clearTimeout(timeout));
        this.previewTimeouts.clear();
        
        // Ë®≠ÂÆöÁõ£Ë¶ñ„ÇíËß£Èô§
        this.configWatchers.forEach(watchId => {
            this.configManager.unwatch(watchId);
        });
        this.configWatchers.clear();
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
        if (this.escapeHandler) {
            document.removeEventListener('keydown', this.escapeHandler);
        }
        
        // DOMË¶ÅÁ¥†„ÇíÂâäÈô§
        if (this.container && this.container.parentNode) {
            this.container.parentNode.removeChild(this.container);
        }
        
        // Èü≥Èüø„ÉÜ„Çπ„Éà„Éë„Éç„É´„ÇíÁ†¥Ê£Ñ
        if (this.audioTestPanel) {
            this.audioTestPanel.dispose();
            this.audioTestPanel = null;
        }
        
        this.container = null;
        this.sliders.clear();
        this.eventListeners.clear();
    }
}