/**
 * „ÉÅ„É£„É¨„É≥„Ç∏UI - „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£ÂØæÂøú (Task 23)
 * WCAG 2.1 AAÊ∫ñÊã†„ÅÆ„ÉÅ„É£„É¨„É≥„Ç∏Ë°®Á§∫„ÉªÁÆ°ÁêÜÊ©üËÉΩ
 */

import { ErrorHandler } from '../utils/ErrorHandler.js';

export class ChallengeUI {
    constructor(challengeSystem, options = {}) {
        this.challengeSystem = challengeSystem;
        
        // Ë®≠ÂÆö
        this.config = {
            // Ë°®Á§∫Ë®≠ÂÆö
            maxVisibleChallenges: options.maxVisibleChallenges || 5,
            autoRefresh: options.autoRefresh !== false,
            refreshInterval: options.refreshInterval || 60000, // 1ÂàÜ
            showProgress: options.showProgress !== false,
            showRewards: options.showRewards !== false,
            showDifficulty: options.showDifficulty !== false,
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ë®≠ÂÆö
            animations: {
                enabled: options.animations !== false,
                duration: options.animationDuration || 300,
                easing: options.animationEasing || 'ease-in-out'
            },
            
            // „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Ë®≠ÂÆö
            accessibility: {
                enabled: options.accessibility !== false,
                announcements: options.announcements !== false,
                keyboardNavigation: options.keyboardNavigation !== false,
                highContrast: options.highContrast === true,
                reducedMotion: options.reducedMotion === true,
                progressAnnouncements: options.progressAnnouncements !== false,
                rewardAnnouncements: options.rewardAnnouncements !== false,
                screenReaderOptimized: options.screenReaderOptimized !== false
            },
            
            // „Çπ„Çø„Ç§„É´Ë®≠ÂÆö
            styles: {
                backgroundColor: options.backgroundColor || '#FFFFFF',
                textColor: options.textColor || '#333333',
                accentColor: options.accentColor || '#007AFF',
                borderRadius: options.borderRadius || '8px',
                fontSize: options.fontSize || '14px',
                fontFamily: options.fontFamily || 'system-ui, -apple-system, sans-serif'
            }
        };
        
        // Áä∂ÊÖãÁÆ°ÁêÜ
        this.state = {
            visible: false,
            challenges: [],
            selectedChallenge: null,
            focusedIndex: 0,
            sortBy: 'priority', // priority, difficulty, progress, deadline
            filterBy: 'all', // all, daily, weekly, completed, active
            loading: false,
            error: null
        };
        
        // DOMË¶ÅÁ¥†
        this.elements = {
            container: null,
            header: null,
            filterControls: null,
            sortControls: null,
            challengeList: null,
            challengeItems: [],
            progressSection: null,
            footer: null,
            announcer: null,
            loadingIndicator: null,
            errorMessage: null
        };
        
        // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº
        this.handlers = {
            keydown: this.handleKeydown.bind(this),
            challengeClick: this.handleChallengeClick.bind(this),
            filterChange: this.handleFilterChange.bind(this),
            sortChange: this.handleSortChange.bind(this),
            refresh: this.handleRefresh.bind(this),
            resize: this.handleResize.bind(this)
        };
        
        // „Éï„Ç©„Éº„Ç´„ÇπÁÆ°ÁêÜ
        this.focusableElements = [];
        this.focusHistory = [];
        
        // „Çø„Ç§„Éû„Éº
        this.refreshTimer = null;
        
        // Áµ±Ë®à
        this.stats = {
            views: 0,
            challengeViews: 0,
            completions: 0,
            filterChanges: 0,
            sortChanges: 0,
            keyboardInteractions: 0,
            announcementsMade: 0
        };
        
        this.initialize();
        this.log('ChallengeUIÂàùÊúüÂåñÂÆå‰∫Ü');
    }
    
    /**
     * ÂàùÊúüÂåñ
     */
    initialize() {
        try {
            // DOMË¶ÅÁ¥†„ÅÆ‰ΩúÊàê
            this.createElements();
            
            // „Çπ„Çø„Ç§„É´„ÅÆÈÅ©Áî®
            this.applyStyles();
            
            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
            this.setupEventListeners();
            
            // „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„ÅÆË®≠ÂÆö
            if (this.config.accessibility.enabled) {
                this.setupAccessibility();
            }
            
            // Ëá™ÂãïÊõ¥Êñ∞„ÅÆË®≠ÂÆö
            if (this.config.autoRefresh) {
                this.startAutoRefresh();
            }
            
        } catch (error) {
            this.handleError('CHALLENGE_UI_INITIALIZATION_FAILED', error);
        }
    }
    
    /**
     * DOMË¶ÅÁ¥†„ÅÆ‰ΩúÊàê
     */
    createElements() {
        // „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä
        this.elements.container = document.createElement('div');
        this.elements.container.className = 'challenge-ui-container';
        this.elements.container.setAttribute('role', 'region');
        this.elements.container.setAttribute('aria-label', '„ÉÅ„É£„É¨„É≥„Ç∏‰∏ÄË¶ß');
        this.elements.container.id = 'challenge-ui-main';
        
        // „Éò„ÉÉ„ÉÄ„Éº
        this.elements.header = this.createHeader();
        
        // „Éï„Ç£„É´„Çø„Éº„Éª„ÇΩ„Éº„Éà„Ç≥„É≥„Éà„É≠„Éº„É´
        this.elements.filterControls = this.createFilterControls();
        this.elements.sortControls = this.createSortControls();
        
        // „ÉÅ„É£„É¨„É≥„Ç∏„É™„Çπ„Éà
        this.elements.challengeList = this.createChallengeList();
        
        // ÈÄ≤Êçó„Çª„ÇØ„Ç∑„Éß„É≥
        this.elements.progressSection = this.createProgressSection();
        
        // „Éï„ÉÉ„Çø„Éº
        this.elements.footer = this.createFooter();
        
        // „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº
        this.elements.loadingIndicator = this.createLoadingIndicator();
        
        // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏
        this.elements.errorMessage = this.createErrorMessage();
        
        // „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Ë¶ÅÁ¥†
        if (this.config.accessibility.enabled) {
            this.elements.announcer = this.createAnnouncer();
        }
        
        // Ë¶ÅÁ¥†„ÅÆÁµÑ„ÅøÁ´ã„Å¶
        this.elements.container.appendChild(this.elements.header);
        this.elements.container.appendChild(this.elements.filterControls);
        this.elements.container.appendChild(this.elements.sortControls);
        this.elements.container.appendChild(this.elements.loadingIndicator);
        this.elements.container.appendChild(this.elements.errorMessage);
        this.elements.container.appendChild(this.elements.challengeList);
        this.elements.container.appendChild(this.elements.progressSection);
        this.elements.container.appendChild(this.elements.footer);
        
        if (this.elements.announcer) {
            this.elements.container.appendChild(this.elements.announcer);
        }
    }
    
    /**
     * „Éò„ÉÉ„ÉÄ„Éº„ÅÆ‰ΩúÊàê
     */
    createHeader() {
        const header = document.createElement('div');
        header.className = 'challenge-ui-header';
        
        // „Çø„Ç§„Éà„É´
        const title = document.createElement('h2');
        title.className = 'challenge-ui-title';
        title.textContent = '„ÉÅ„É£„É¨„É≥„Ç∏';
        title.id = 'challenge-ui-title';
        
        // Êõ¥Êñ∞„Éú„Çø„É≥
        const refreshButton = document.createElement('button');
        refreshButton.className = 'challenge-ui-refresh';
        refreshButton.innerHTML = 'üîÑ';
        refreshButton.setAttribute('aria-label', '„ÉÅ„É£„É¨„É≥„Ç∏„ÇíÊõ¥Êñ∞');
        refreshButton.setAttribute('type', 'button');
        refreshButton.title = '„ÉÅ„É£„É¨„É≥„Ç∏„ÇíÊõ¥Êñ∞';
        
        header.appendChild(title);
        header.appendChild(refreshButton);
        
        return header;
    }
    
    /**
     * „Éï„Ç£„É´„Çø„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„ÅÆ‰ΩúÊàê
     */
    createFilterControls() {
        const container = document.createElement('div');
        container.className = 'challenge-ui-filters';
        container.setAttribute('role', 'group');
        container.setAttribute('aria-label', '„ÉÅ„É£„É¨„É≥„Ç∏„Éï„Ç£„É´„Çø„Éº');
        
        const label = document.createElement('label');
        label.className = 'challenge-ui-filter-label';
        label.textContent = '„Éï„Ç£„É´„Çø„Éº:';
        label.setAttribute('for', 'challenge-filter-select');
        
        const select = document.createElement('select');
        select.id = 'challenge-filter-select';
        select.className = 'challenge-ui-filter-select';
        select.setAttribute('aria-label', '„ÉÅ„É£„É¨„É≥„Ç∏„ÅÆÁ®ÆÈ°û„Åß„Éï„Ç£„É´„Çø„Éº');
        
        const options = [
            { value: 'all', text: '„Åô„Åπ„Å¶' },
            { value: 'daily', text: '„Éá„Ç§„É™„Éº' },
            { value: 'weekly', text: '„Ç¶„Ç£„Éº„ÇØ„É™„Éº' },
            { value: 'active', text: 'ÈÄ≤Ë°å‰∏≠' },
            { value: 'completed', text: 'ÂÆå‰∫ÜÊ∏à„Åø' }
        ];
        
        options.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option.value;
            optionElement.textContent = option.text;
            select.appendChild(optionElement);
        });
        
        container.appendChild(label);
        container.appendChild(select);
        
        return container;
    }
    
    /**
     * „ÇΩ„Éº„Éà„Ç≥„É≥„Éà„É≠„Éº„É´„ÅÆ‰ΩúÊàê
     */
    createSortControls() {
        const container = document.createElement('div');
        container.className = 'challenge-ui-sorts';
        container.setAttribute('role', 'group');
        container.setAttribute('aria-label', '„ÉÅ„É£„É¨„É≥„Ç∏„ÇΩ„Éº„Éà');
        
        const label = document.createElement('label');
        label.className = 'challenge-ui-sort-label';
        label.textContent = '‰∏¶„Å≥È†Ü:';
        label.setAttribute('for', 'challenge-sort-select');
        
        const select = document.createElement('select');
        select.id = 'challenge-sort-select';
        select.className = 'challenge-ui-sort-select';
        select.setAttribute('aria-label', '„ÉÅ„É£„É¨„É≥„Ç∏„ÅÆ‰∏¶„Å≥È†Ü');
        
        const options = [
            { value: 'priority', text: 'ÂÑ™ÂÖàÂ∫¶È†Ü' },
            { value: 'difficulty', text: 'Èõ£ÊòìÂ∫¶È†Ü' },
            { value: 'progress', text: 'ÈÄ≤ÊçóÈ†Ü' },
            { value: 'deadline', text: 'ÊúüÈôêÈ†Ü' }
        ];
        
        options.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option.value;
            optionElement.textContent = option.text;
            select.appendChild(optionElement);
        });
        
        container.appendChild(label);
        container.appendChild(select);
        
        return container;
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„É™„Çπ„Éà„ÅÆ‰ΩúÊàê
     */
    createChallengeList() {
        const list = document.createElement('div');
        list.className = 'challenge-ui-list';
        list.setAttribute('role', 'list');
        list.setAttribute('aria-label', '„ÉÅ„É£„É¨„É≥„Ç∏„Ç¢„Ç§„ÉÜ„É†');
        list.id = 'challenge-list-container';
        
        return list;
    }
    
    /**
     * ÈÄ≤Êçó„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ‰ΩúÊàê
     */
    createProgressSection() {
        const section = document.createElement('div');
        section.className = 'challenge-ui-progress';
        section.setAttribute('role', 'region');
        section.setAttribute('aria-label', 'ÂÖ®‰ΩìÈÄ≤Êçó');
        
        const title = document.createElement('h3');
        title.className = 'challenge-ui-progress-title';
        title.textContent = 'ÂÖ®‰ΩìÈÄ≤Êçó';
        
        const progressContainer = document.createElement('div');
        progressContainer.className = 'challenge-ui-progress-container';
        
        section.appendChild(title);
        section.appendChild(progressContainer);
        
        return section;
    }
    
    /**
     * „Éï„ÉÉ„Çø„Éº„ÅÆ‰ΩúÊàê
     */
    createFooter() {
        const footer = document.createElement('div');
        footer.className = 'challenge-ui-footer';
        
        const info = document.createElement('div');
        info.className = 'challenge-ui-info';
        info.textContent = 'ÊúÄÁµÇÊõ¥Êñ∞: Êú™ÂèñÂæó';
        
        footer.appendChild(info);
        
        return footer;
    }
    
    /**
     * „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÅÆ‰ΩúÊàê
     */
    createLoadingIndicator() {
        const loader = document.createElement('div');
        loader.className = 'challenge-ui-loading';
        loader.style.display = 'none';
        loader.setAttribute('role', 'status');
        loader.setAttribute('aria-label', '„ÉÅ„É£„É¨„É≥„Ç∏„ÇíË™≠„ÅøËæº„Åø‰∏≠');
        
        const spinner = document.createElement('div');
        spinner.className = 'challenge-ui-spinner';
        
        const text = document.createElement('span');
        text.className = 'challenge-ui-loading-text';
        text.textContent = 'Ë™≠„ÅøËæº„Åø‰∏≠...';
        
        loader.appendChild(spinner);
        loader.appendChild(text);
        
        return loader;
    }
    
    /**
     * „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆ‰ΩúÊàê
     */
    createErrorMessage() {
        const error = document.createElement('div');
        error.className = 'challenge-ui-error';
        error.style.display = 'none';
        error.setAttribute('role', 'alert');
        error.setAttribute('aria-live', 'assertive');
        
        return error;
    }
    
    /**
     * „Ç¢„Éä„Ç¶„É≥„Çµ„Éº„ÅÆ‰ΩúÊàê
     */
    createAnnouncer() {
        const announcer = document.createElement('div');
        announcer.className = 'challenge-ui-announcer sr-only';
        announcer.setAttribute('aria-live', 'polite');
        announcer.setAttribute('aria-atomic', 'true');
        announcer.style.cssText = `
            position: absolute !important;
            left: -10000px !important;
            width: 1px !important;
            height: 1px !important;
            overflow: hidden !important;
            clip: rect(1px, 1px, 1px, 1px) !important;
            clip-path: inset(50%) !important;
        `;
        
        return announcer;
    }
    
    /**
     * „Çπ„Çø„Ç§„É´„ÅÆÈÅ©Áî®
     */
    applyStyles() {
        const container = this.elements.container;
        const styles = this.config.styles;
        
        // „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä„ÅÆ„Çπ„Çø„Ç§„É´
        Object.assign(container.style, {
            backgroundColor: styles.backgroundColor,
            color: styles.textColor,
            borderRadius: styles.borderRadius,
            fontSize: styles.fontSize,
            fontFamily: styles.fontFamily,
            padding: '16px',
            border: '1px solid #E0E0E0',
            maxHeight: '600px',
            overflow: 'hidden',
            display: 'flex',
            flexDirection: 'column'
        });
        
        // „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„Çπ„Çø„Ç§„É´
        if (this.config.accessibility.enabled) {
            this.applyAccessibilityStyles();
        }
        
        // „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Çπ„Çø„Ç§„É´
        this.applyResponsiveStyles();
    }
    
    /**
     * „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„Çπ„Çø„Ç§„É´„ÅÆÈÅ©Áî®
     */
    applyAccessibilityStyles() {
        const style = document.createElement('style');
        style.textContent = `
            /* „Éï„Ç©„Éº„Ç´„Çπ„Çπ„Çø„Ç§„É´ */
            .challenge-ui-container button:focus,
            .challenge-ui-container select:focus,
            .challenge-item:focus {
                outline: 3px solid ${this.config.styles.accentColor} !important;
                outline-offset: 2px !important;
                box-shadow: 0 0 0 3px ${this.config.styles.accentColor}40 !important;
            }
            
            /* È´ò„Ç≥„É≥„Éà„É©„Çπ„Éà„É¢„Éº„Éâ */
            ${this.config.accessibility.highContrast ? `
                .challenge-ui-container {
                    background-color: #000000 !important;
                    color: #FFFFFF !important;
                    border: 3px solid #FFFFFF !important;
                }
                
                .challenge-item {
                    background-color: #111111 !important;
                    color: #FFFFFF !important;
                    border: 2px solid #FFFFFF !important;
                }
            ` : ''}
            
            /* Âãï„Åç„ÅÆËªΩÊ∏õ */
            ${this.config.accessibility.reducedMotion ? `
                .challenge-ui-container *,
                .challenge-item * {
                    animation-duration: 0.01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: 0.01ms !important;
                }
            ` : ''}
            
            /* „Çπ„ÇØ„É™„Éº„É≥„É™„Éº„ÉÄ„ÉºÊúÄÈÅ©Âåñ */
            ${this.config.accessibility.screenReaderOptimized ? `
                .challenge-item-progress::after {
                    content: "ÈÄ≤Êçó " attr(data-progress) " „Éë„Éº„Çª„É≥„Éà";
                    position: absolute;
                    left: -10000px;
                }
                
                .challenge-item-difficulty::after {
                    content: "Èõ£ÊòìÂ∫¶ " attr(data-difficulty);
                    position: absolute;
                    left: -10000px;
                }
            ` : ''}
        `;
        
        document.head.appendChild(style);
    }
    
    /**
     * „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Çπ„Çø„Ç§„É´„ÅÆÈÅ©Áî®
     */
    applyResponsiveStyles() {
        const mediaQuery = window.matchMedia('(max-width: 768px)');
        
        if (mediaQuery.matches) {
            Object.assign(this.elements.container.style, {
                padding: '12px',
                fontSize: '12px'
            });
        }
    }
    
    /**
     * „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
     */
    setupEventListeners() {
        // „Ç≠„Éº„Éú„Éº„Éâ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
        this.elements.container.addEventListener('keydown', this.handlers.keydown);
        
        // „Éï„Ç£„É´„Çø„ÉºÂ§âÊõ¥
        const filterSelect = this.elements.filterControls.querySelector('select');
        filterSelect.addEventListener('change', this.handlers.filterChange);
        
        // „ÇΩ„Éº„ÉàÂ§âÊõ¥
        const sortSelect = this.elements.sortControls.querySelector('select');
        sortSelect.addEventListener('change', this.handlers.sortChange);
        
        // Êõ¥Êñ∞„Éú„Çø„É≥
        const refreshButton = this.elements.header.querySelector('.challenge-ui-refresh');
        refreshButton.addEventListener('click', this.handlers.refresh);
        
        // „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫
        window.addEventListener('resize', this.handlers.resize);
    }
    
    /**
     * „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„ÅÆË®≠ÂÆö
     */
    setupAccessibility() {
        // „Éï„Ç©„Éº„Ç´„ÇπÂèØËÉΩË¶ÅÁ¥†„ÅÆÊõ¥Êñ∞
        this.updateFocusableElements();
        
        // „Ç≠„Éº„Éú„Éº„Éâ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÅÆË®≠ÂÆö
        if (this.config.accessibility.keyboardNavigation) {
            this.setupKeyboardNavigation();
        }
        
        // ÈÄ≤Êçó„Ç¢„Éä„Ç¶„É≥„Çπ„ÅÆË®≠ÂÆö
        if (this.config.accessibility.progressAnnouncements) {
            this.setupProgressAnnouncements();
        }
    }
    
    /**
     * „Éï„Ç©„Éº„Ç´„ÇπÂèØËÉΩË¶ÅÁ¥†„ÅÆÊõ¥Êñ∞
     */
    updateFocusableElements() {
        const selector = `
            button:not([disabled]),
            select:not([disabled]),
            .challenge-item[tabindex="0"]
        `;
        
        this.focusableElements = Array.from(
            this.elements.container.querySelectorAll(selector)
        );
    }
    
    /**
     * „Ç≠„Éº„Éú„Éº„Éâ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÅÆË®≠ÂÆö
     */
    setupKeyboardNavigation() {
        // ËøΩÂä†„ÅÆË®≠ÂÆö„ÅØ handleKeydown „ÅßÂÆüË£Ö
    }
    
    /**
     * ÈÄ≤Êçó„Ç¢„Éä„Ç¶„É≥„Çπ„ÅÆË®≠ÂÆö
     */
    setupProgressAnnouncements() {
        // „ÉÅ„É£„É¨„É≥„Ç∏ÈÄ≤Êçó„ÅÆÁõ£Ë¶ñ
        if (this.challengeSystem && typeof this.challengeSystem.onProgressUpdate === 'function') {
            this.challengeSystem.onProgressUpdate((challengeId, progress) => {
                this.announceProgressUpdate(challengeId, progress);
            });
        }
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„ÅÆË°®Á§∫
     */
    async show() {
        if (this.state.visible) return;
        
        try {
            this.state.visible = true;
            this.stats.views++;
            
            // „ÉÅ„É£„É¨„É≥„Ç∏„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
            await this.loadChallenges();
            
            // „Ç≥„É≥„ÉÜ„Éä„ÅÆË°®Á§∫
            this.elements.container.style.display = 'flex';
            
            // ÂàùÊúü„Éï„Ç©„Éº„Ç´„Çπ„ÅÆË®≠ÂÆö
            this.setInitialFocus();
            
            // „Ç¢„Éä„Ç¶„É≥„Çπ
            this.announce('„ÉÅ„É£„É¨„É≥„Ç∏‰∏ÄË¶ß„ÇíË°®Á§∫„Åó„Åæ„Åó„Åü');
            
            this.log('ChallengeUIË°®Á§∫');
            
        } catch (error) {
            this.handleError('CHALLENGE_UI_SHOW_FAILED', error);
        }
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„ÅÆÈùûË°®Á§∫
     */
    hide() {
        if (!this.state.visible) return;
        
        this.state.visible = false;
        this.elements.container.style.display = 'none';
        
        this.log('ChallengeUIÈùûË°®Á§∫');
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
     */
    async loadChallenges() {
        try {
            this.showLoading(true);
            this.state.loading = true;
            
            // „ÉÅ„É£„É¨„É≥„Ç∏„Ç∑„Çπ„ÉÜ„É†„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæó
            let challenges = [];
            if (this.challengeSystem && typeof this.challengeSystem.getChallenges === 'function') {
                challenges = await this.challengeSystem.getChallenges();
            } else {
                // „Éá„É¢„Éá„Éº„Çø
                challenges = this.generateDemoChallenges();
            }
            
            // „Éï„Ç£„É´„Çø„Éº„Éª„ÇΩ„Éº„Éà„ÅÆÈÅ©Áî®
            challenges = this.filterChallenges(challenges);
            challenges = this.sortChallenges(challenges);
            
            this.state.challenges = challenges;
            
            // UI „ÅÆÊõ¥Êñ∞
            this.renderChallenges();
            this.updateProgressSection();
            this.updateFooter();
            
            this.state.loading = false;
            this.showLoading(false);
            
            // „Ç¢„Éä„Ç¶„É≥„Çπ
            this.announce(`${challenges.length}‰ª∂„ÅÆ„ÉÅ„É£„É¨„É≥„Ç∏„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`);
            
        } catch (error) {
            this.state.loading = false;
            this.showLoading(false);
            this.showError('„ÉÅ„É£„É¨„É≥„Ç∏„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            this.handleError('CHALLENGE_LOAD_FAILED', error);
        }
    }
    
    /**
     * „Éá„É¢„ÉÅ„É£„É¨„É≥„Ç∏„ÅÆÁîüÊàê
     */
    generateDemoChallenges() {
        return [
            {
                id: 'daily-1',
                title: '10ÂÄã„ÅÆ„Éê„Éñ„É´„Çí„Éù„ÉÉ„Éó',
                description: '‰ªäÊó•‰∏≠„Å´10ÂÄã„ÅÆ„Éê„Éñ„É´„Çí„Éù„ÉÉ„Éó„Åó„Çà„ÅÜ',
                type: 'daily',
                difficulty: 'easy',
                progress: 7,
                target: 10,
                reward: { ap: 50 },
                deadline: new Date(Date.now() + 24 * 60 * 60 * 1000),
                priority: 1
            },
            {
                id: 'weekly-1',
                title: '500„Éù„Ç§„É≥„ÉàÁç≤Âæó',
                description: '‰ªäÈÄ±‰∏≠„Å´500„Éù„Ç§„É≥„Éà„ÇíÁç≤Âæó„Åó„Çà„ÅÜ',
                type: 'weekly',
                difficulty: 'medium',
                progress: 250,
                target: 500,
                reward: { ap: 200 },
                deadline: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
                priority: 2
            },
            {
                id: 'special-1',
                title: '„Ç≥„É≥„Éú10ÂõûÈÅîÊàê',
                description: '1Âõû„ÅÆ„Ç≤„Éº„É†„Åß10Âõû„Ç≥„É≥„Éú„ÇíÈÅîÊàê„Åó„Çà„ÅÜ',
                type: 'special',
                difficulty: 'hard',
                progress: 0,
                target: 1,
                reward: { ap: 300, title: '„Ç≥„É≥„Éú„Éû„Çπ„Çø„Éº' },
                deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
                priority: 3
            }
        ];
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
     */
    filterChallenges(challenges) {
        const filter = this.state.filterBy;
        
        switch (filter) {
            case 'daily':
                return challenges.filter(c => c.type === 'daily');
            case 'weekly':
                return challenges.filter(c => c.type === 'weekly');
            case 'active':
                return challenges.filter(c => c.progress < c.target);
            case 'completed':
                return challenges.filter(c => c.progress >= c.target);
            default:
                return challenges;
        }
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„ÅÆ„ÇΩ„Éº„Éà
     */
    sortChallenges(challenges) {
        const sortBy = this.state.sortBy;
        
        return challenges.sort((a, b) => {
            switch (sortBy) {
                case 'priority':
                    return a.priority - b.priority;
                case 'difficulty':
                    const difficultyOrder = { easy: 1, medium: 2, hard: 3 };
                    return difficultyOrder[a.difficulty] - difficultyOrder[b.difficulty];
                case 'progress':
                    const aProgress = a.progress / a.target;
                    const bProgress = b.progress / b.target;
                    return bProgress - aProgress;
                case 'deadline':
                    return new Date(a.deadline) - new Date(b.deadline);
                default:
                    return 0;
            }
        });
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
     */
    renderChallenges() {
        const list = this.elements.challengeList;
        list.innerHTML = '';
        this.elements.challengeItems = [];
        
        this.state.challenges.forEach((challenge, index) => {
            const item = this.createChallengeItem(challenge, index);
            this.elements.challengeItems.push(item);
            list.appendChild(item);
        });
        
        // „Éï„Ç©„Éº„Ç´„ÇπÂèØËÉΩË¶ÅÁ¥†„ÅÆÊõ¥Êñ∞
        this.updateFocusableElements();
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„Ç¢„Ç§„ÉÜ„É†„ÅÆ‰ΩúÊàê
     */
    createChallengeItem(challenge, index) {
        const item = document.createElement('div');
        item.className = `challenge-item challenge-item-${challenge.difficulty}`;
        item.setAttribute('role', 'listitem');
        item.setAttribute('tabindex', '0');
        item.setAttribute('data-challenge-id', challenge.id);
        item.setAttribute('data-index', index);
        
        // „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Â±ûÊÄß
        const progressPercent = Math.round((challenge.progress / challenge.target) * 100);
        const isCompleted = challenge.progress >= challenge.target;
        
        item.setAttribute('aria-label', 
            `„ÉÅ„É£„É¨„É≥„Ç∏: ${challenge.title}. ${challenge.description}. ` +
            `ÈÄ≤Êçó: ${progressPercent}„Éë„Éº„Çª„É≥„Éà. Èõ£ÊòìÂ∫¶: ${challenge.difficulty}. ` +
            `ÊúüÈôê: ${this.formatDeadline(challenge.deadline)}. ` +
            `${isCompleted ? 'ÂÆå‰∫ÜÊ∏à„Åø' : 'ÈÄ≤Ë°å‰∏≠'}`
        );
        
        // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆ‰ΩúÊàê
        const header = document.createElement('div');
        header.className = 'challenge-item-header';
        
        const title = document.createElement('h4');
        title.className = 'challenge-item-title';
        title.textContent = challenge.title;
        
        const difficulty = document.createElement('span');
        difficulty.className = `challenge-item-difficulty challenge-item-difficulty-${challenge.difficulty}`;
        difficulty.textContent = this.getDifficultyLabel(challenge.difficulty);
        difficulty.setAttribute('data-difficulty', challenge.difficulty);
        
        header.appendChild(title);
        header.appendChild(difficulty);
        
        const description = document.createElement('p');
        description.className = 'challenge-item-description';
        description.textContent = challenge.description;
        
        const progress = document.createElement('div');
        progress.className = 'challenge-item-progress';
        progress.setAttribute('data-progress', progressPercent);
        
        const progressBar = document.createElement('div');
        progressBar.className = 'challenge-item-progress-bar';
        progressBar.setAttribute('role', 'progressbar');
        progressBar.setAttribute('aria-valuenow', challenge.progress);
        progressBar.setAttribute('aria-valuemin', '0');
        progressBar.setAttribute('aria-valuemax', challenge.target);
        progressBar.setAttribute('aria-label', `ÈÄ≤Êçó: ${challenge.progress}/${challenge.target}`);
        
        const progressFill = document.createElement('div');
        progressFill.className = 'challenge-item-progress-fill';
        progressFill.style.width = `${progressPercent}%`;
        
        const progressText = document.createElement('span');
        progressText.className = 'challenge-item-progress-text';
        progressText.textContent = `${challenge.progress}/${challenge.target} (${progressPercent}%)`;
        
        progressBar.appendChild(progressFill);
        progress.appendChild(progressBar);
        progress.appendChild(progressText);
        
        const footer = document.createElement('div');
        footer.className = 'challenge-item-footer';
        
        const deadline = document.createElement('span');
        deadline.className = 'challenge-item-deadline';
        deadline.textContent = `ÊúüÈôê: ${this.formatDeadline(challenge.deadline)}`;
        
        const reward = document.createElement('span');
        reward.className = 'challenge-item-reward';
        reward.textContent = `Â†±ÈÖ¨: ${this.formatReward(challenge.reward)}`;
        
        footer.appendChild(deadline);
        footer.appendChild(reward);
        
        // Ë¶ÅÁ¥†„ÅÆÁµÑ„ÅøÁ´ã„Å¶
        item.appendChild(header);
        item.appendChild(description);
        item.appendChild(progress);
        item.appendChild(footer);
        
        // ÂÆå‰∫ÜÊ∏à„Åø„ÅÆÂ†¥Âêà
        if (isCompleted) {
            item.classList.add('challenge-item-completed');
            item.setAttribute('aria-label', item.getAttribute('aria-label') + '. ÂÆå‰∫ÜÊ∏à„Åø');
        }
        
        return item;
    }
    
    /**
     * Èõ£ÊòìÂ∫¶„É©„Éô„É´„ÅÆÂèñÂæó
     */
    getDifficultyLabel(difficulty) {
        const labels = {
            easy: 'Á∞°Âçò',
            medium: 'ÊôÆÈÄö',
            hard: 'Èõ£„Åó„ÅÑ'
        };
        return labels[difficulty] || difficulty;
    }
    
    /**
     * ÊúüÈôê„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà
     */
    formatDeadline(deadline) {
        const now = new Date();
        const diff = deadline - now;
        
        if (diff < 0) {
            return 'ÊúüÈôêÂàá„Çå';
        } else if (diff < 24 * 60 * 60 * 1000) {
            const hours = Math.floor(diff / (60 * 60 * 1000));
            return `„ÅÇ„Å®${hours}ÊôÇÈñì`;
        } else {
            const days = Math.floor(diff / (24 * 60 * 60 * 1000));
            return `„ÅÇ„Å®${days}Êó•`;
        }
    }
    
    /**
     * Â†±ÈÖ¨„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà
     */
    formatReward(reward) {
        const parts = [];
        if (reward.ap) {
            parts.push(`${reward.ap} AP`);
        }
        if (reward.title) {
            parts.push(`Áß∞Âè∑„Äå${reward.title}„Äç`);
        }
        return parts.join(', ');
    }
    
    /**
     * ÈÄ≤Êçó„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÊõ¥Êñ∞
     */
    updateProgressSection() {
        const container = this.elements.progressSection.querySelector('.challenge-ui-progress-container');
        container.innerHTML = '';
        
        const total = this.state.challenges.length;
        const completed = this.state.challenges.filter(c => c.progress >= c.target).length;
        const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;
        
        const progressBar = document.createElement('div');
        progressBar.className = 'challenge-ui-overall-progress';
        progressBar.setAttribute('role', 'progressbar');
        progressBar.setAttribute('aria-valuenow', completed);
        progressBar.setAttribute('aria-valuemin', '0');
        progressBar.setAttribute('aria-valuemax', total);
        progressBar.setAttribute('aria-label', `ÂÖ®‰ΩìÈÄ≤Êçó: ${completed}/${total}ÂÆå‰∫Ü`);
        
        const fill = document.createElement('div');
        fill.className = 'challenge-ui-overall-progress-fill';
        fill.style.width = `${completionRate}%`;
        
        const text = document.createElement('span');
        text.className = 'challenge-ui-overall-progress-text';
        text.textContent = `${completed}/${total} ÂÆå‰∫Ü (${completionRate}%)`;
        
        progressBar.appendChild(fill);
        container.appendChild(progressBar);
        container.appendChild(text);
    }
    
    /**
     * „Éï„ÉÉ„Çø„Éº„ÅÆÊõ¥Êñ∞
     */
    updateFooter() {
        const info = this.elements.footer.querySelector('.challenge-ui-info');
        info.textContent = `ÊúÄÁµÇÊõ¥Êñ∞: ${new Date().toLocaleTimeString('ja-JP')}`;
    }
    
    /**
     * „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫„ÅÆÂà∂Âæ°
     */
    showLoading(show) {
        this.elements.loadingIndicator.style.display = show ? 'block' : 'none';
        this.elements.challengeList.style.display = show ? 'none' : 'block';
        
        if (show && this.config.accessibility.announcements) {
            this.announce('„ÉÅ„É£„É¨„É≥„Ç∏„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô');
        }
    }
    
    /**
     * „Ç®„É©„ÉºË°®Á§∫
     */
    showError(message) {
        this.elements.errorMessage.textContent = message;
        this.elements.errorMessage.style.display = 'block';
        this.state.error = message;
        
        if (this.config.accessibility.announcements) {
            this.announce(`„Ç®„É©„Éº: ${message}`, 'assertive');
        }
        
        // 3ÁßíÂæå„Å´Ëá™Âãï„ÅßÈö†„Åô
        setTimeout(() => {
            this.elements.errorMessage.style.display = 'none';
            this.state.error = null;
        }, 3000);
    }
    
    /**
     * ÂàùÊúü„Éï„Ç©„Éº„Ç´„Çπ„ÅÆË®≠ÂÆö
     */
    setInitialFocus() {
        if (this.focusableElements.length > 0) {
            this.focusableElements[0].focus();
            this.state.focusedIndex = 0;
        }
    }
    
    /**
     * Ëá™ÂãïÊõ¥Êñ∞„ÅÆÈñãÂßã
     */
    startAutoRefresh() {
        if (this.refreshTimer) {
            clearInterval(this.refreshTimer);
        }
        
        this.refreshTimer = setInterval(() => {
            if (this.state.visible && !this.state.loading) {
                this.loadChallenges();
            }
        }, this.config.refreshInterval);
    }
    
    /**
     * Ëá™ÂãïÊõ¥Êñ∞„ÅÆÂÅúÊ≠¢
     */
    stopAutoRefresh() {
        if (this.refreshTimer) {
            clearInterval(this.refreshTimer);
            this.refreshTimer = null;
        }
    }
    
    /**
     * „Ç≠„Éº„Éú„Éº„Éâ„Éè„É≥„Éâ„É©„Éº
     */
    handleKeydown(event) {
        if (!this.config.accessibility.keyboardNavigation) return;
        
        this.stats.keyboardInteractions++;
        
        switch (event.key) {
            case 'ArrowUp':
                event.preventDefault();
                this.navigateUp();
                break;
            case 'ArrowDown':
                event.preventDefault();
                this.navigateDown();
                break;
            case 'Home':
                event.preventDefault();
                this.navigateToFirst();
                break;
            case 'End':
                event.preventDefault();
                this.navigateToLast();
                break;
            case 'Enter':
            case ' ':
                event.preventDefault();
                this.activateCurrentItem();
                break;
            case 'r':
                if (event.ctrlKey || event.metaKey) {
                    event.preventDefault();
                    this.handleRefresh();
                }
                break;
        }
    }
    
    /**
     * ‰∏äÊñπÂêë„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
     */
    navigateUp() {
        if (this.state.focusedIndex > 0) {
            this.state.focusedIndex--;
            this.focusableElements[this.state.focusedIndex].focus();
        }
    }
    
    /**
     * ‰∏ãÊñπÂêë„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
     */
    navigateDown() {
        if (this.state.focusedIndex < this.focusableElements.length - 1) {
            this.state.focusedIndex++;
            this.focusableElements[this.state.focusedIndex].focus();
        }
    }
    
    /**
     * ÊúÄÂàù„ÅÆË¶ÅÁ¥†„Å´„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
     */
    navigateToFirst() {
        if (this.focusableElements.length > 0) {
            this.state.focusedIndex = 0;
            this.focusableElements[0].focus();
        }
    }
    
    /**
     * ÊúÄÂæå„ÅÆË¶ÅÁ¥†„Å´„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
     */
    navigateToLast() {
        if (this.focusableElements.length > 0) {
            this.state.focusedIndex = this.focusableElements.length - 1;
            this.focusableElements[this.state.focusedIndex].focus();
        }
    }
    
    /**
     * ÁèæÂú®„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅÆÊúâÂäπÂåñ
     */
    activateCurrentItem() {
        const focusedElement = this.focusableElements[this.state.focusedIndex];
        if (focusedElement) {
            if (focusedElement.classList.contains('challenge-item')) {
                this.handleChallengeClick({ currentTarget: focusedElement });
            } else {
                focusedElement.click();
            }
        }
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„Éº
     */
    handleChallengeClick(event) {
        const item = event.currentTarget;
        const challengeId = item.getAttribute('data-challenge-id');
        const challenge = this.state.challenges.find(c => c.id === challengeId);
        
        if (challenge) {
            this.state.selectedChallenge = challenge;
            this.stats.challengeViews++;
            
            // Ë©≥Á¥∞ÊÉÖÂ†±„ÅÆ„Ç¢„Éä„Ç¶„É≥„Çπ
            this.announceChallenge(challenge);
            
            this.log('„ÉÅ„É£„É¨„É≥„Ç∏ÈÅ∏Êäû', { challengeId });
        }
    }
    
    /**
     * „Éï„Ç£„É´„Çø„ÉºÂ§âÊõ¥„Éè„É≥„Éâ„É©„Éº
     */
    async handleFilterChange(event) {
        const newFilter = event.target.value;
        if (newFilter !== this.state.filterBy) {
            this.state.filterBy = newFilter;
            this.stats.filterChanges++;
            
            await this.loadChallenges();
            
            this.announce(`„Éï„Ç£„É´„Çø„Éº„Çí„Äå${event.target.selectedOptions[0].text}„Äç„Å´Â§âÊõ¥„Åó„Åæ„Åó„Åü`);
        }
    }
    
    /**
     * „ÇΩ„Éº„ÉàÂ§âÊõ¥„Éè„É≥„Éâ„É©„Éº
     */
    async handleSortChange(event) {
        const newSort = event.target.value;
        if (newSort !== this.state.sortBy) {
            this.state.sortBy = newSort;
            this.stats.sortChanges++;
            
            await this.loadChallenges();
            
            this.announce(`‰∏¶„Å≥È†Ü„Çí„Äå${event.target.selectedOptions[0].text}„Äç„Å´Â§âÊõ¥„Åó„Åæ„Åó„Åü`);
        }
    }
    
    /**
     * Êõ¥Êñ∞„Éè„É≥„Éâ„É©„Éº
     */
    async handleRefresh() {
        await this.loadChallenges();
        this.announce('„ÉÅ„É£„É¨„É≥„Ç∏„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü');
    }
    
    /**
     * „É™„Çµ„Ç§„Ç∫„Éè„É≥„Éâ„É©„Éº
     */
    handleResize() {
        this.applyResponsiveStyles();
    }
    
    /**
     * „Ç¢„Éä„Ç¶„É≥„Çπ
     */
    announce(message, priority = 'polite') {
        if (!this.config.accessibility.announcements || !this.elements.announcer) return;
        
        this.stats.announcementsMade++;
        
        // ‰∏ÄÂ∫¶„ÇØ„É™„Ç¢„Åó„Å¶„Åã„ÇâÊñ∞„Åó„ÅÑ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË®≠ÂÆö
        this.elements.announcer.textContent = '';
        setTimeout(() => {
            this.elements.announcer.textContent = message;
        }, 100);
        
        this.log('„Ç¢„Éä„Ç¶„É≥„Çπ', { message, priority });
    }
    
    /**
     * „ÉÅ„É£„É¨„É≥„Ç∏„ÅÆË©≥Á¥∞„Ç¢„Éä„Ç¶„É≥„Çπ
     */
    announceChallenge(challenge) {
        const progressPercent = Math.round((challenge.progress / challenge.target) * 100);
        const message = `ÈÅ∏Êäû‰∏≠: ${challenge.title}. ÈÄ≤Êçó ${progressPercent}„Éë„Éº„Çª„É≥„Éà. ` +
                       `Èõ£ÊòìÂ∫¶ ${this.getDifficultyLabel(challenge.difficulty)}. ` +
                       `ÊúüÈôê ${this.formatDeadline(challenge.deadline)}`;
        
        this.announce(message);
    }
    
    /**
     * ÈÄ≤ÊçóÊõ¥Êñ∞„ÅÆ„Ç¢„Éä„Ç¶„É≥„Çπ
     */
    announceProgressUpdate(challengeId, progress) {
        if (!this.config.accessibility.progressAnnouncements) return;
        
        const challenge = this.state.challenges.find(c => c.id === challengeId);
        if (challenge) {
            const progressPercent = Math.round((progress / challenge.target) * 100);
            const message = `„Äå${challenge.title}„Äç„ÅÆÈÄ≤Êçó„Åå ${progressPercent}„Éë„Éº„Çª„É≥„Éà „Å´„Å™„Çä„Åæ„Åó„Åü`;
            
            this.announce(message, 'assertive');
        }
    }
    
    /**
     * Ë®≠ÂÆö„ÅÆÊõ¥Êñ∞
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        
        // „Çπ„Çø„Ç§„É´„ÅÆÂÜçÈÅ©Áî®
        this.applyStyles();
        
        // Ëá™ÂãïÊõ¥Êñ∞„ÅÆÂÜçË®≠ÂÆö
        if (this.config.autoRefresh) {
            this.startAutoRefresh();
        } else {
            this.stopAutoRefresh();
        }
        
        this.log('ChallengeUIË®≠ÂÆöÊõ¥Êñ∞', newConfig);
    }
    
    /**
     * Áµ±Ë®à„ÅÆÂèñÂæó
     */
    getStats() {
        return { ...this.stats };
    }
    
    /**
     * „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
     */
    destroy() {
        // Ëá™ÂãïÊõ¥Êñ∞„ÅÆÂÅúÊ≠¢
        this.stopAutoRefresh();
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆÂâäÈô§
        window.removeEventListener('resize', this.handlers.resize);
        
        // DOMË¶ÅÁ¥†„ÅÆÂâäÈô§
        if (this.elements.container && this.elements.container.parentNode) {
            this.elements.container.parentNode.removeChild(this.elements.container);
        }
        
        this.log('ChallengeUIÁ†¥Ê£ÑÂÆå‰∫Ü');
    }
    
    /**
     * „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
     */
    handleError(type, error, context = {}) {
        const errorInfo = {
            type,
            error: error.message || error,
            context,
            timestamp: Date.now()
        };
        
        if (ErrorHandler) {
            ErrorHandler.handleError(error, 'ChallengeUI', context);
        }
        
        this.log('„Ç®„É©„ÉºÁô∫Áîü', errorInfo, 'error');
    }
    
    /**
     * „É≠„Ç∞Ë®òÈå≤
     */
    log(message, data = null, level = 'info') {
        const logEntry = {
            timestamp: Date.now(),
            level,
            message,
            data
        };
        
        const consoleMethod = level === 'error' ? 'error' : 
                            level === 'warn' ? 'warn' : 'log';
        console[consoleMethod](`[ChallengeUI] ${message}`, data || '');
    }
}