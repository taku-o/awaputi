<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ - BubblePop</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .language-switcher {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .language-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .language-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid transparent;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .language-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .language-btn.active {
            background: rgba(255, 255, 255, 0.4);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .game-canvas {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .status-info {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: left;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-family: monospace;
        }

        .status-row:last-child {
            margin-bottom: 0;
        }

        .key {
            color: #ffeb3b;
        }

        .value {
            color: #4caf50;
        }

        .log-container {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
        }

        .log-entry {
            font-family: monospace;
            font-size: 12px;
            margin-bottom: 5px;
            color: #e0e0e0;
        }

        .log-entry.success {
            color: #4caf50;
        }

        .log-entry.error {
            color: #f44336;
        }

        .log-entry.info {
            color: #2196f3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸŒ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="language-switcher">
            <h3 id="languageSwitcherTitle">è¨€èªé¸æŠ</h3>
            <div class="language-buttons">
                <button class="language-btn active" data-lang="ja" id="btnJa">æ—¥æœ¬èª</button>
                <button class="language-btn" data-lang="en" id="btnEn">English</button>
            </div>
        </div>

        <canvas id="gameCanvas" class="game-canvas" width="800" height="600"></canvas>

        <div class="status-info">
            <div class="status-row">
                <span class="key" id="statusCurrentLang">ç¾åœ¨ã®è¨€èª:</span>
                <span class="value" id="currentLang">ja</span>
            </div>
            <div class="status-row">
                <span class="key" id="statusAvailableLangs">åˆ©ç”¨å¯èƒ½è¨€èª:</span>
                <span class="value" id="availableLangs">-</span>
            </div>
            <div class="status-row">
                <span class="key" id="statusTranslationCount">ç¿»è¨³æ•°:</span>
                <span class="value" id="translationCount">-</span>
            </div>
            <div class="status-row">
                <span class="key" id="statusGameScene">ç¾åœ¨ã®ã‚·ãƒ¼ãƒ³:</span>
                <span class="value" id="currentScene">-</span>
            </div>
        </div>

        <div class="log-container">
            <div class="log-entry info">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆé–‹å§‹...</div>
            <div id="logContainer"></div>
        </div>
    </div>

    <script type="module">
        import { GameEngine } from './src/core/GameEngine.js';

        let gameEngine;
        let logContainer;

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStatus() {
            if (!gameEngine || !gameEngine.localizationManager) return;

            try {
                const lm = gameEngine.localizationManager;
                
                // ç¾åœ¨ã®è¨€èª
                document.getElementById('currentLang').textContent = lm.getCurrentLanguage();
                
                // åˆ©ç”¨å¯èƒ½è¨€èª
                const availableLangs = lm.getAvailableLanguages();
                document.getElementById('availableLangs').textContent = availableLangs.join(', ');
                
                // ç¿»è¨³çµ±è¨ˆ
                const stats = lm.getStats();
                const totalTranslations = Object.values(stats.translationCounts).reduce((sum, count) => sum + count, 0);
                document.getElementById('translationCount').textContent = totalTranslations;
                
                // ç¾åœ¨ã®ã‚·ãƒ¼ãƒ³
                const currentScene = gameEngine.sceneManager?.getCurrentSceneName() || 'unknown';
                document.getElementById('currentScene').textContent = currentScene;
                
                // ç¿»è¨³ã§UIè¦ç´ ã‚’æ›´æ–°
                updateUILabels();
                
                addLog(`Status updated - Language: ${lm.getCurrentLanguage()}, Translations: ${totalTranslations}`, 'success');
            } catch (error) {
                addLog(`Status update error: ${error.message}`, 'error');
            }
        }

        function updateUILabels() {
            if (!gameEngine || !gameEngine.localizationManager) return;

            const t = gameEngine.localizationManager.t.bind(gameEngine.localizationManager);
            
            try {
                // UIè¦ç´ ã‚’ç¿»è¨³ã§æ›´æ–°
                document.getElementById('languageSwitcherTitle').textContent = t('settings.language');
                document.getElementById('statusCurrentLang').textContent = t('settings.language') + ':';
                document.getElementById('statusAvailableLangs').textContent = 'åˆ©ç”¨å¯èƒ½è¨€èª:'; // ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼ˆç¿»è¨³ã‚­ãƒ¼ãŒãªã„ãŸã‚ï¼‰
                document.getElementById('statusTranslationCount').textContent = 'ç¿»è¨³æ•°:'; // ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
                document.getElementById('statusGameScene').textContent = 'ç¾åœ¨ã®ã‚·ãƒ¼ãƒ³:'; // ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
                
                // è¨€èªãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«æ›´æ–°
                document.getElementById('btnJa').textContent = 'æ—¥æœ¬èª';
                document.getElementById('btnEn').textContent = 'English';
                
            } catch (error) {
                addLog(`UI label update error: ${error.message}`, 'error');
            }
        }

        async function switchLanguage(language) {
            if (!gameEngine || !gameEngine.localizationManager) return;

            try {
                addLog(`Switching to language: ${language}`, 'info');
                
                const success = await gameEngine.localizationManager.setLanguage(language);
                
                if (success) {
                    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœã‚¿ãƒ³ã®æ›´æ–°
                    document.querySelectorAll('.language-btn').forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.lang === language);
                    });
                    
                    // çµ±è¨ˆæ›´æ–°
                    updateStatus();
                    
                    addLog(`Successfully switched to ${language}`, 'success');
                } else {
                    addLog(`Failed to switch to ${language}`, 'error');
                }
            } catch (error) {
                addLog(`Language switch error: ${error.message}`, 'error');
            }
        }

        async function initializeTest() {
            try {
                logContainer = document.getElementById('logContainer');
                addLog('Initializing BubblePop game engine...', 'info');
                
                const canvas = document.getElementById('gameCanvas');
                gameEngine = new GameEngine(canvas);
                
                // è¨€èªå¤‰æ›´ãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
                gameEngine.localizationManager.addLanguageChangeListener((newLang, oldLang) => {
                    addLog(`Language changed: ${oldLang} â†’ ${newLang}`, 'success');
                    document.documentElement.lang = newLang;
                    updateStatus();
                });
                
                // è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                document.querySelectorAll('.language-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const language = btn.dataset.lang;
                        switchLanguage(language);
                    });
                });
                
                // ã‚²ãƒ¼ãƒ é–‹å§‹
                gameEngine.start();
                
                // åˆæœŸçµ±è¨ˆæ›´æ–°
                setTimeout(() => {
                    updateStatus();
                    addLog('Real-time language switching test ready!', 'success');
                }, 1000);
                
            } catch (error) {
                addLog(`Initialization error: ${error.message}`, 'error');
                console.error('Test initialization failed:', error);
            }
        }

        // ãƒ†ã‚¹ãƒˆé–‹å§‹
        window.addEventListener('load', initializeTest);
    </script>
</body>
</html>