<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConfigurationManagerä¿®æ­£ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status {
            padding: 8px 15px;
            border-radius: 5px;
            margin: 5px 0;
            font-weight: bold;
        }
        .success { background: rgba(76, 175, 80, 0.3); color: #4caf50; }
        .error { background: rgba(244, 67, 54, 0.3); color: #f44336; }
        .warning { background: rgba(255, 152, 0, 0.3); color: #ff9800; }
        .info { background: rgba(33, 150, 243, 0.3); color: #2196f3; }
        
        .test-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .bubble-test {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .bubble-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            text-transform: capitalize;
        }
        .config-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 3px 5px;
            border-radius: 3px;
        }
        .config-item.found { background: rgba(76, 175, 80, 0.2); }
        .config-item.missing { background: rgba(244, 67, 54, 0.2); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ConfigurationManagerä¿®æ­£ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="section">
            <h2>ä¿®æ­£å†…å®¹</h2>
            <div class="status success">âœ… _getDirectValue()ãƒ¡ã‚½ãƒƒãƒ‰ä¿®æ­£å®Œäº†</div>
            <div class="status success">âœ… defaultValueså„ªå…ˆã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…</div>
            <div class="status success">âœ… ãƒãƒ–ãƒ«è¨­å®š20ç¨®é¡ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½</div>
        </div>
        
        <div class="section">
            <h2>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
            <div class="grid">
                <button onclick="testBubbleConfigsFix()">ãƒãƒ–ãƒ«è¨­å®šã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testPerformanceConfig()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testWarningReduction()">è­¦å‘Šãƒ­ã‚°å‰Šæ¸›ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
            </div>
        </div>
        
        <div class="section">
            <h2>ãƒ†ã‚¹ãƒˆçµæœ</h2>
            <div id="results" class="log">ConfigurationManagerä¿®æ­£ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†
å„ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä¿®æ­£çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>
        </div>
        
        <div class="section">
            <h2>ãƒãƒ–ãƒ«è¨­å®šè©³ç´°çµæœ</h2>
            <div id="bubbleResults" class="test-results">
                <!-- ãƒãƒ–ãƒ«è¨­å®šãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>
        
    </div>

    <script type="module">
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const typeEmoji = {
                'success': 'âœ…',
                'error': 'âŒ', 
                'warning': 'âš ï¸',
                'info': 'â„¹ï¸'
            };
            results.textContent += `[${timestamp}] ${typeEmoji[type] || 'â„¹ï¸'} ${message}\n`;
            results.scrollTop = results.scrollHeight;
        }

        // ãƒãƒ–ãƒ«è¨­å®šä¿®æ­£ãƒ†ã‚¹ãƒˆ
        async function testBubbleConfigsFix() {
            log('=== ãƒãƒ–ãƒ«è¨­å®šä¿®æ­£ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            try {
                // ConfigurationManagerã‚’å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                const configModule = await import('./src/core/ConfigurationManager.js');
                const configManager = configModule.getConfigurationManager();
                
                log('âœ“ ConfigurationManagerèª­ã¿è¾¼ã¿æˆåŠŸ', 'success');
                
                // ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒãƒ–ãƒ«ç¨®é¡ï¼ˆ20ç¨®é¡å…¨ã¦ï¼‰
                const bubbleTypes = [
                    'normal', 'stone', 'iron', 'diamond', 'boss',
                    'pink', 'poison', 'spiky', 'rainbow', 'clock', 
                    'score', 'electric', 'escaping', 'cracked',
                    'golden', 'frozen', 'magnetic', 'explosive',
                    'phantom', 'multiplier'
                ];
                
                const configKeys = ['health', 'score', 'color', 'size', 'maxAge'];
                
                let totalSuccess = 0;
                let totalTests = bubbleTypes.length * configKeys.length;
                let bubbleResults = [];
                
                log(`${bubbleTypes.length}ç¨®é¡ã®ãƒãƒ–ãƒ«è¨­å®šã‚’ãƒ†ã‚¹ãƒˆä¸­...`);
                
                for (const bubbleType of bubbleTypes) {
                    let bubbleSuccess = 0;
                    let bubbleConfigs = {};
                    
                    for (const configKey of configKeys) {
                        const fullKey = \`bubbles.\${bubbleType}.\${configKey}\`;
                        
                        try {
                            const value = configManager.get('game', fullKey);
                            
                            if (value !== null && value !== undefined) {
                                totalSuccess++;
                                bubbleSuccess++;
                                bubbleConfigs[configKey] = { value, found: true };
                                log(\`  âœ“ \${fullKey}: \${value}\`, 'success');
                            } else {
                                bubbleConfigs[configKey] = { value: 'undefined', found: false };
                                log(\`  âš ï¸ \${fullKey}: null/undefined\`, 'warning');
                            }
                        } catch (error) {
                            bubbleConfigs[configKey] = { value: \`ERROR: \${error.message}\`, found: false };
                            log(\`  âŒ \${fullKey}: ã‚¨ãƒ©ãƒ¼ - \${error.message}\`, 'error');
                        }
                    }
                    
                    bubbleResults.push({
                        type: bubbleType,
                        success: bubbleSuccess,
                        total: configKeys.length,
                        configs: bubbleConfigs
                    });
                    
                    if (bubbleSuccess === configKeys.length) {
                        log(\`ğŸ‰ \${bubbleType}ãƒãƒ–ãƒ«: å®Œå…¨æˆåŠŸ (\${bubbleSuccess}/\${configKeys.length})\`, 'success');
                    } else if (bubbleSuccess > 0) {
                        log(\`âš ï¸ \${bubbleType}ãƒãƒ–ãƒ«: éƒ¨åˆ†æˆåŠŸ (\${bubbleSuccess}/\${configKeys.length})\`, 'warning');
                    } else {
                        log(\`âŒ \${bubbleType}ãƒãƒ–ãƒ«: å¤±æ•— (\${bubbleSuccess}/\${configKeys.length})\`, 'error');
                    }
                }
                
                // è©³ç´°çµæœã‚’è¡¨ç¤º
                displayBubbleResults(bubbleResults);
                
                const successRate = Math.round((totalSuccess / totalTests) * 100);
                
                if (successRate === 100) {
                    log(\`ğŸŠ ä¿®æ­£æˆåŠŸï¼å…¨ãƒãƒ–ãƒ«è¨­å®šã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½: \${totalSuccess}/\${totalTests} (\${successRate}%)\`, 'success');
                } else if (successRate >= 90) {
                    log(\`âœ… ä¿®æ­£ã»ã¼æˆåŠŸ: \${totalSuccess}/\${totalTests} (\${successRate}%)\`, 'success');
                } else if (successRate >= 50) {
                    log(\`âš ï¸ ä¿®æ­£éƒ¨åˆ†æˆåŠŸ: \${totalSuccess}/\${totalTests} (\${successRate}%)\`, 'warning');
                } else {
                    log(\`âŒ ä¿®æ­£å¤±æ•—: \${totalSuccess}/\${totalTests} (\${successRate}%)\`, 'error');
                }
                
            } catch (error) {
                log(\`âŒ ãƒãƒ–ãƒ«è¨­å®šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: \${error.message}\`, 'error');
                console.error('è©³ç´°ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ãƒãƒ–ãƒ«è¨­å®šè©³ç´°çµæœã‚’è¡¨ç¤º
        function displayBubbleResults(bubbleResults) {
            const container = document.getElementById('bubbleResults');
            container.innerHTML = '';
            
            bubbleResults.forEach(result => {
                const bubbleDiv = document.createElement('div');
                bubbleDiv.className = 'bubble-test';
                
                let statusIcon = result.success === result.total ? 'ğŸ‰' : 
                               result.success > 0 ? 'âš ï¸' : 'âŒ';
                
                bubbleDiv.innerHTML = \`
                    <div class="bubble-name">\${statusIcon} \${result.type} (\${result.success}/\${result.total})</div>
                    \${Object.entries(result.configs).map(([key, config]) => 
                        \`<div class="config-item \${config.found ? 'found' : 'missing'}">
                            <span>\${key}</span>
                            <span>\${config.value}</span>
                        </div>\`
                    ).join('')}
                \`;
                
                container.appendChild(bubbleDiv);
            });
        }

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šãƒ†ã‚¹ãƒˆ
        async function testPerformanceConfig() {
            log('=== ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            try {
                const configModule = await import('./src/core/ConfigurationManager.js');
                const configManager = configModule.getConfigurationManager();
                
                const performanceKeys = [
                    'targetFPS', 'adaptiveMode', 'performanceLevel',
                    'maxBubbles', 'maxParticles'
                ];
                
                let successCount = 0;
                
                for (const key of performanceKeys) {
                    try {
                        const value = configManager.get('performance', key);
                        if (value !== null && value !== undefined) {
                            log(\`  âœ“ performance.\${key}: \${value}\`, 'success');
                            successCount++;
                        } else {
                            log(\`  âš ï¸ performance.\${key}: null/undefined\`, 'warning');
                        }
                    } catch (error) {
                        log(\`  âŒ performance.\${key}: ã‚¨ãƒ©ãƒ¼ - \${error.message}\`, 'error');
                    }
                }
                
                log(\`ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šçµæœ: \${successCount}/\${performanceKeys.length}\`, 
                    successCount === performanceKeys.length ? 'success' : 'warning');
                
            } catch (error) {
                log(\`âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: \${error.message}\`, 'error');
            }
        }

        // è­¦å‘Šãƒ­ã‚°å‰Šæ¸›ãƒ†ã‚¹ãƒˆ
        async function testWarningReduction() {
            log('=== è­¦å‘Šãƒ­ã‚°å‰Šæ¸›ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            try {
                const configModule = await import('./src/core/ConfigurationManager.js');
                const configManager = configModule.getConfigurationManager();
                
                log('å­˜åœ¨ã—ãªã„ãƒãƒ–ãƒ«è¨­å®šã‚’5å›é€£ç¶šã‚¢ã‚¯ã‚»ã‚¹...');
                
                let warningCount = 0;
                const originalWarn = console.warn;
                console.warn = function(...args) {
                    if (args[0] && args[0].includes('[ConfigurationManager]')) {
                        warningCount++;
                    }
                    originalWarn.apply(console, args);
                };
                
                // å­˜åœ¨ã—ãªã„è¨­å®šã«é€£ç¶šã‚¢ã‚¯ã‚»ã‚¹
                for (let i = 0; i < 5; i++) {
                    configManager.get('game', 'bubbles.nonexistent.test');
                }
                
                console.warn = originalWarn;
                
                if (warningCount <= 1) {
                    log(\`âœ… è­¦å‘Šãƒ­ã‚°å‰Šæ¸›æˆåŠŸ: 5å›ã‚¢ã‚¯ã‚»ã‚¹ â†’ \${warningCount}å›è­¦å‘Š\`, 'success');
                } else {
                    log(\`âš ï¸ è­¦å‘Šãƒ­ã‚°å‰Šæ¸›ä¸å®Œå…¨: 5å›ã‚¢ã‚¯ã‚»ã‚¹ â†’ \${warningCount}å›è­¦å‘Š\`, 'warning');
                }
                
                // å®Ÿåœ¨ã™ã‚‹ãƒãƒ–ãƒ«è¨­å®šã§æ­£å¸¸ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ
                log('æ­£å¸¸ãƒãƒ–ãƒ«è¨­å®šã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ...');
                const normalScore = configManager.get('game', 'bubbles.normal.score');
                log(\`âœ“ bubbles.normal.score: \${normalScore}\`, 'success');
                
            } catch (error) {
                log(\`âŒ è­¦å‘Šãƒ­ã‚°å‰Šæ¸›ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: \${error.message}\`, 'error');
            }
        }

        // çµæœã‚¯ãƒªã‚¢
        function clearResults() {
            document.getElementById('results').textContent = 'ConfigurationManagerä¿®æ­£ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†\nå„ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä¿®æ­£çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„\n';
            document.getElementById('bubbleResults').innerHTML = '';
            log('ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
        window.testBubbleConfigsFix = testBubbleConfigsFix;
        window.testPerformanceConfig = testPerformanceConfig; 
        window.testWarningReduction = testWarningReduction;
        window.clearResults = clearResults;
        
        // åˆæœŸåŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        log('ConfigurationManagerä¿®æ­£ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
        log('å„ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä¿®æ­£çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„');
    </script>
</body>
</html>