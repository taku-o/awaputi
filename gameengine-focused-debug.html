<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>GameEngine Focused Debug - Issue #113</title>
    <style>
        body {
            margin: 20px;
            font-family: monospace;
            background: #f0f0f0;
        }
        
        #container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
        }
        
        .filter-controls {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .filter-controls label {
            margin-right: 15px;
            font-weight: bold;
        }
        
        .filter-controls input[type="checkbox"] {
            margin-right: 5px;
        }
        
        #log {
            margin-top: 20px;
            background: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            max-height: 600px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-info { color: #0066cc; }
        .log-error { color: #cc0000; font-weight: bold; }
        .log-success { color: #006600; }
        .log-warning { color: #cc6600; }
        .log-critical { color: #800080; font-weight: bold; background: #fff0ff; padding: 2px; }
    </style>
</head>
<body>
    <div id="container">
        <h1>ğŸ¯ GameEngine Focused Debug</h1>
        <p>é‡è¦ãªãƒ­ã‚°ã®ã¿è¡¨ç¤ºã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ä»˜ããƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</p>
        
        <canvas id="gameCanvas" width="400" height="300" style="border: 2px solid #333; background: #e8f4f8;"></canvas>
        
        <div>
            <button onclick="debugGameEngineConstructor()">ğŸ” GameEngine DEBUGå®Ÿè¡Œ</button>
            <button onclick="clearLog()">ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>
        
        <div class="filter-controls">
            <label><input type="checkbox" id="showErrors" checked> ã‚¨ãƒ©ãƒ¼è¡¨ç¤º</label>
            <label><input type="checkbox" id="showWarnings" checked> è­¦å‘Šè¡¨ç¤º</label>
            <label><input type="checkbox" id="showCritical" checked> é‡è¦DEBUGè¡¨ç¤º</label>
            <label><input type="checkbox" id="showInitializer" checked> Initializeré–¢é€£è¡¨ç¤º</label>
            <label><input type="checkbox" id="showLoadMethods" checked> loadãƒ¡ã‚½ãƒƒãƒ‰è¡¨ç¤º</label>
            <label><input type="checkbox" id="showSuccessOnly"> æˆåŠŸãƒ­ã‚°ã®ã¿è¡¨ç¤º</label>
        </div>
        
        <div id="log"></div>
    </div>

    <script type="module">
        // ===== ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ =====
        let allLogs = [];
        
        function log(message, type = 'info', category = 'general') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                timestamp,
                message,
                type,
                category,
                raw: `[${timestamp}] ${message}`
            };
            
            allLogs.push(logEntry);
            updateLogDisplay();
            
            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚å‡ºåŠ›ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãªã—ï¼‰
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function updateLogDisplay() {
            const logElement = document.getElementById('log');
            const filters = {
                showErrors: document.getElementById('showErrors').checked,
                showWarnings: document.getElementById('showWarnings').checked,
                showCritical: document.getElementById('showCritical').checked,
                showInitializer: document.getElementById('showInitializer').checked,
                showLoadMethods: document.getElementById('showLoadMethods').checked,
                showSuccessOnly: document.getElementById('showSuccessOnly').checked
            };
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const filteredLogs = allLogs.filter(entry => {
                if (filters.showSuccessOnly && entry.type !== 'success' && entry.type !== 'critical') {
                    return false;
                }
                
                if (entry.type === 'error' && !filters.showErrors) return false;
                if (entry.type === 'warning' && !filters.showWarnings) return false;
                if (entry.type === 'critical' && !filters.showCritical) return false;
                
                if (entry.message.includes('Initializer') && !filters.showInitializer) return false;
                if (entry.message.includes('load') && !filters.showLoadMethods) return false;
                
                return true;
            });
            
            // ãƒ­ã‚°ã‚’è¡¨ç¤º
            logElement.innerHTML = '';
            filteredLogs.forEach(entry => {
                const div = document.createElement('div');
                div.className = `log-${entry.type}`;
                div.innerHTML = `<strong>[${entry.timestamp}]</strong> ${entry.message}`;
                logElement.appendChild(div);
            });
            
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´æ™‚ã®å†æç”»
        document.querySelectorAll('.filter-controls input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateLogDisplay);
        });
        
        window.clearLog = function() {
            allLogs = [];
            updateLogDisplay();
        };
        
        window.debugGameEngineConstructor = async function() {
            allLogs = [];
            log('=== GameEngineé‡è¦ãƒ­ã‚°ã®ã¿ãƒ‡ãƒãƒƒã‚°é–‹å§‹ ===', 'critical', 'debug');
            
            // é‡è¦ãƒ­ã‚°ã®ã¿ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ä»˜ããƒ­ã‚°ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
            const originalConsoleLog = console.log;
            const originalConsoleError = console.error;
            const originalConsoleWarn = console.warn;
            
            console.log = function(...args) {
                const message = args.join(' ');
                originalConsoleLog.apply(console, args);
                
                // é‡è¦ãªDEBUGãƒ­ã‚°ã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                if (message.includes('[DEBUG]')) {
                    if (message.includes('GameEngine:') || 
                        message.includes('GameEngineInitializer:') ||
                        message.includes('load') ||
                        message.includes('ã‚¨ãƒ©ãƒ¼') ||
                        message.includes('å¤±æ•—') ||
                        message.includes('null') ||
                        message.includes('undefined')) {
                        
                        let category = 'debug';
                        if (message.includes('load')) category = 'load';
                        if (message.includes('Initializer')) category = 'initializer';
                        
                        log(`ğŸ” ${message}`, 'critical', category);
                    }
                }
            };
            
            console.error = function(...args) {
                const message = args.join(' ');
                originalConsoleError.apply(console, args);
                log(`ğŸ’¥ ${message}`, 'error', 'error');
            };
            
            console.warn = function(...args) {
                const message = args.join(' ');
                originalConsoleWarn.apply(console, args);
                log(`âš ï¸ ${message}`, 'warning', 'warning');
            };
            
            try {
                log('GameEngineã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...', 'info');
                const { GameEngine } = await import('./src/core/GameEngine.js');
                log('âœ… GameEngineã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ', 'success');
                
                log('GameEngineã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼å‘¼ã³å‡ºã—é–‹å§‹...', 'critical', 'debug');
                const canvas = document.getElementById('gameCanvas');
                
                // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼å®Ÿè¡Œ
                const gameEngine = new GameEngine(canvas);
                
                log('âœ… GameEngineã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼å®Œäº†', 'success');
                
                // é‡è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã¿ãƒã‚§ãƒƒã‚¯
                const criticalComponents = [
                    { name: 'playerData', obj: gameEngine.playerData, hasLoad: gameEngine.playerData && typeof gameEngine.playerData.load === 'function' },
                    { name: 'achievementManager', obj: gameEngine.achievementManager, hasLoad: gameEngine.achievementManager && typeof gameEngine.achievementManager.load === 'function' },
                    { name: 'statisticsManager', obj: gameEngine.statisticsManager, hasLoad: gameEngine.statisticsManager && typeof gameEngine.statisticsManager.load === 'function' },
                    { name: 'eventStageManager', obj: gameEngine.eventStageManager, hasLoad: gameEngine.eventStageManager && typeof gameEngine.eventStageManager.load === 'function' }
                ];
                
                log('=== é‡è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ & loadãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª ===', 'critical', 'load');
                criticalComponents.forEach(comp => {
                    const status = comp.obj ? 'âœ… å­˜åœ¨' : 'âŒ NULL';
                    const loadStatus = comp.hasLoad ? 'âœ… load()æœ‰' : 'âŒ load()ç„¡';
                    log(`${comp.name}: ${status} | ${loadStatus}`, comp.obj && comp.hasLoad ? 'success' : 'error', 'load');
                });
                
                // initializeScenes() å®Ÿè¡Œã®ç›£è¦–
                log('=== initializeScenes() å®Ÿè¡Œç›£è¦–ä¸­ ===', 'critical', 'initializer');
                log('ã“ã®å¾Œã€éåŒæœŸã§Initializerã®[DEBUG]ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™', 'info', 'initializer');
                log('ç‰¹ã«ã€Œloadé–‹å§‹ã€ã€Œloadå®Œäº†ã€ã€Œloadå¤±æ•—ã€ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'warning', 'load');
                
            } catch (error) {
                log(`ğŸ’¥ GameEngineã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error', 'error');
                log(`ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯: ${error.stack}`, 'error', 'error');
            } finally {
                // ãƒ­ã‚°æ©Ÿèƒ½ã‚’å¾©å…ƒï¼ˆ2ç§’å¾Œï¼‰
                setTimeout(() => {
                    console.log = originalConsoleLog;
                    console.error = originalConsoleError;
                    console.warn = originalConsoleWarn;
                    
                    log('=== ãƒ­ã‚°ã‚­ãƒ£ãƒ—ãƒãƒ£å®Œäº† ===', 'info');
                    log('ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’èª¿æ•´ã—ã¦é‡è¦ãƒ­ã‚°ã®ã¿ç¢ºèªã—ã¦ãã ã•ã„', 'warning');
                }, 5000); // 5ç§’é–“ã‚­ãƒ£ãƒ—ãƒãƒ£
            }
        };
        
        // ===== åˆæœŸåŒ– =====
        log('GameEngineé‡è¦ãƒ­ã‚°ãƒ‡ãƒãƒƒã‚°æº–å‚™å®Œäº†', 'info');
        log('ğŸ“‹ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½:', 'info');
        log('  â€¢ ã‚¨ãƒ©ãƒ¼/è­¦å‘Š: èµ¤è‰²ãƒ»ã‚ªãƒ¬ãƒ³ã‚¸è‰²', 'info');
        log('  â€¢ é‡è¦DEBUG: ç´«è‰²ãƒã‚¤ãƒ©ã‚¤ãƒˆ', 'info');
        log('  â€¢ loadãƒ¡ã‚½ãƒƒãƒ‰é–¢é€£: å°‚ç”¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼', 'info');
        log('  â€¢ Initializeré–¢é€£: å°‚ç”¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼', 'info');
    </script>
</body>
</html>